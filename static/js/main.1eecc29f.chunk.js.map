{"version":3,"sources":["components/layout/MainNavigation.tsx","components/layout/Layout.tsx","pages/NotFound.tsx","assets/homepage-banner.png","assets/erc-logo.png","assets/eu-logo.png","assets/pipeline-image.7310f65e.png","components/layout/HomeNavigation.tsx","pages/Home.tsx","assets/ucl-logo.png","components/shared/LoadingSpinner.tsx","components/utils/ASSETS_URL.ts","components/shared/Backdrop.tsx","components/shared/Modal.tsx","components/shared/Button.tsx","components/shared/ErrorModal.tsx","components/utils/calculateMriImageCoords.ts","components/utils/getMatrix.ts","components/utils/matrixMultiplier.ts","components/utils/calculateHistologyImageCoords.ts","components/utils/calculateAdjustedMriCoords.ts","components/utils/npzParser.ts","components/utils/histologyLabelParser.ts","components/utils/convertHistologyMouseCoords.ts","components/shared/MousePointer.tsx","components/atlas/atlasImages/MriImage.tsx","components/utils/getMouseCoords.ts","components/atlas/atlasImages/MriImages.tsx","components/atlas/atlasImages/HistologyLowResImage.tsx","components/atlas/atlasImages/HistologyLabelsImage.tsx","components/atlas/atlasImages/HistologyHiResImage.tsx","components/atlas/atlasImages/HistologyImages.tsx","components/atlas/scrollbars/HistologyScrollbar.tsx","components/atlas/scrollbars/Scrollbars.tsx","components/atlas/atlasImages/AtlasImages.tsx","components/atlas/atlasOptions/PatientSelect.tsx","components/atlas/atlasOptions/AtlasNavigation.tsx","components/atlas/atlasOptions/ShowLabelsBtn.tsx","components/atlas/atlasOptions/TransparencySlider.tsx","components/atlas/atlasOptions/Label.tsx","components/atlas/atlasOptions/ImageChannelSelect.tsx","components/atlas/atlasOptions/ShowHiResBtn.tsx","components/atlas/atlasOptions/AtlasOptions.tsx","pages/Atlas.tsx","App.tsx","index.tsx"],"names":["MainNavigation","className","to","navData","isActive","Layout","props","children","NotFound","HomeNavigation","scroll","el","scrollIntoView","window","scrollBy","Atlas","id","src","banner","alt","href","width","height","title","pipelineImage","target","rel","ercLogo","euLogo","LoadingSpinner","asOverlay","message","ASSETS_URL","Backdrop","ReactDOM","createPortal","onClick","document","getElementById","ModalOverlay","content","style","headerClass","header","onSubmit","event","preventDefault","contentClass","footerClass","footer","Modal","show","onCancel","CSSTransition","in","mountOnEnter","unmountOnExit","timeout","classNames","Button","size","inverse","danger","type","disabled","ErrorModal","onClear","error","calculateMriImageCoords","currentMriPlane","currentMriSlice","currentMriMouseX","currentMriMouseY","adjustedMriSlice","adjustedMriMouseX","adjustedMriMouseY","newMriCoords","sagittal","slice","mouseX","mouseY","coronal","axial","undefined","getMatrix","currentBlock","patientId","a","paddedBlock","toString","padStart","fileUrl","fetch","file","text","txtFile","parseMatrixTxt","matrix","removedLineBreaks","replace","txtToArray","split","pop","arrayAsNumbers","map","element","Number","multiplyMatrixAndPoint","point","c0r0","c1r0","c2r0","c3r0","c0r1","c1r1","c2r1","c3r1","c0r2","c1r2","c2r2","c3r2","c0r3","c1r3","c2r3","c3r3","x","y","z","w","resultX","resultY","resultZ","resultW","calculateHistologyImageCoords","currentMriCoords","atlasImagesDimensionsKey","getCurrentBlock","matrixLowRes","matrixHiRes","histologyImageCoordsLowRes","getHistologyImageCoords","histologyImageCoordsHiRes","currentHistologyOrientation","histologyLowResDimensions","orientation","coordsLowRes","coords","coordsHiRes","currentHistologySlice","currentHistologyBlock","matrixMultiplier","validateCoords","toFixed","n","npyjs","paddedSlice","npyFile","e","console","log","load","npyArray","ndArray","ndarray","data","shape","transpose","get","mriDimensions","slices","calculateAdjustedMriCoords","npzParser","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsArrayBuffer","arrayBuffer","zip","JSZip","npzUint8Array","Uint8Array","loadAsync","loadedZip","fileName","Object","entries","files","async","unzippedArrayBuffer","headerData","hcontents","TextDecoder","decode","JSON","parse","toLowerCase","npyData","Uint16Array","filename","self","this","then","fetchedFile","ok","blob","blobData","readFileAsync","parseNpz","catch","err","histologyLabelParser","histologyImageCoords","showHiRes","require","labelsFile","getCurrentLabelNumber","currentLabelNumber","currentLabel","coordsProp","histologyFolder","npzFile","convertHistologyMouseCoords","currentHistologyMouseX","currentHistologyMouseY","lowResMouseX","histologyHiResDimensions","lowResMouseY","hiResMouseX","hiResMouseY","MousePointer","top","left","position","zIndex","MriImage","useState","setError","isLoading","setIsLoading","mriImage","setMriImage","currentSlice","setCurrentSlice","plane","mriImageCoords","computeMriImagesHandler","useEffect","getMriImage","mriImageUrl","response","imageBlob","imageObjectURL","URL","createObjectURL","getMouseCoords","offsetX","nativeEvent","offsetY","MriImages","setShowHiRes","updateMriAndHistologyImages","determineMouseBoundariesMri","HistologyLowResImage","histologyImage","updateHistologyCoordsHandler","onImageLoad","onLoad","HistologyLabelsImage","labelsImage","labelsTransparency","opacity","HistologyHiResImage","showLabels","scaledHistologyMouseCoords","wheel","panning","velocityDisabled","limitToBounds","onPanningStart","ref","maxScale","zoomIn","zoomOut","resetTransform","HistologyImages","setHistologyImage","setLabelsImage","imageDimensions","setImageDimensions","setScaledHistologyMouseCoords","channel","histologyToMri","fetchHistologyImage","histologySlice","histologyFileExtension","labelsFileExtension","histologyImageUrl","labelsImageUrl","histologyImageResponse","histologyImageBlob","histologyImageObjectURL","labelsImageResponse","labelsImageBlob","labelsImageObjectURL","calculateScaledHistologyMousePos","naturalHeight","naturalWidth","scaledHeight","scaledWidth","scaledHistologyMouseX","scaledHistologyMouseY","naturalCoordinateX","naturalCoordinateY","getImageDimensions","getHistologyMousePos","calculateNaturalMouseCoordinates","HistologyScrollbar","scrollbarRef","useRef","scrollbarPos","setScrollbarPos","adjustHistologyCoordsFromScrollbar","currentHistologySliceNumber","slicesInBlock","newHistologyScrollbarPos","current","clientHeight","incrementHistologyScrollbarPos","increment","newHistologySliceNumber","checkScrollbarBoundaries","updateHistologyScrollbarPos","Scrollbars","AtlasImages","setMriImageCoords","setHistologyImageCoords","setCurrentLabel","navPanelCoords","updateAtlas","setCurrentLabelHandler","updateMriImagesHandler","updateHistologyImagesHandler","singleMriCoord","newHistologyCoords","newSliceNumber","PatientSelect","setPatientId","setInitializeAtlas","setShowLabels","setChannel","name","value","onChange","setPatientIdHandler","AtlasNavigation","atlasNavigationData","setAtlasNavigationData","setNavPanelCoords","getAtlasNavigationData","dataUrl","json","parsedFile","updateNavPanelCoordsHandler","blockNumber","xh","yh","zh","currentNode","selectedNodes","currentNodeData","keepTreeOnSearch","keepOpenOnSelect","mode","inlineSearchInput","texts","placeholder","memo","ShowLabelsBtn","TransparencySlider","setLabelsTransparency","min","max","step","Label","labelName","backgroundColor","r","g","b","marginBottom","ImageChannelSelect","ShowHiResBtn","AtlasOptions","initializeAtlas","setAtlasImagesDimensionsKey","getAtlasImageDimensionsFiles","useCallback","mriDimensionsKeyUrl","histologyLowResDimensionsKeyUrl","histologyHiResDimensionsKeyUrl","mriDimensionsKeyFile","histologyLowResDimensionsKeyFile","histologyHiResDimensionsKeyFile","App","path","createRoot","render","StrictMode"],"mappings":"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","file":"static/js/main.1eecc29f.chunk.js","sourcesContent":["import { NavLink } from \"react-router-dom\";\n\nimport \"./MainNavigation.css\";\n\nconst MainNavigation = () => {\n\treturn (\n\t\t<header className=\"header\">\n\t\t\t<div className=\"logo\">NextBrain</div>\n\t\t\t<nav className=\"nav\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<NavLink\n\t\t\t\t\t\t\tto=\"/home\"\n\t\t\t\t\t\t\tclassName={(navData) => (navData.isActive ? \" active\" : \"\")}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tHome\n\t\t\t\t\t\t</NavLink>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<NavLink\n\t\t\t\t\t\t\tto=\"/atlas\"\n\t\t\t\t\t\t\tclassName={(navData) => (navData.isActive ? \" active\" : \"\")}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tData explorer\n\t\t\t\t\t\t</NavLink>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</nav>\n\t\t</header>\n\t);\n};\n\nexport default MainNavigation;\n","import MainNavigation from \"./MainNavigation\";\n\nimport \"./Layout.css\";\n\nconst Layout: React.FC = (props) => {\n\treturn (\n\t\t<>\n\t\t\t<MainNavigation />\n\t\t\t<main className=\"main\">{props.children}</main>\n\t\t</>\n\t);\n};\n\nexport default Layout;\n","import { FC } from \"react\";\n\nconst NotFound: FC = () => {\n\treturn <main>Page not found!</main>;\n};\n\nexport default NotFound;\n","export default __webpack_public_path__ + \"static/media/homepage-banner.66523cf7.png\";","export default __webpack_public_path__ + \"static/media/erc-logo.a80f7f04.png\";","export default __webpack_public_path__ + \"static/media/eu-logo.1a7bc00a.png\";","export default __webpack_public_path__ + \"static/media/pipeline-image.7310f65e.d3dc7784.png\";","import { NavLink } from \"react-router-dom\";\nimport { HashLink as Link } from 'react-router-hash-link';\n\nimport \"./HomeNavigation.css\";\n\nconst HomeNavigation = () => {\n\treturn (\n\t\t<header className=\"hheader\">\n\t\t\t<nav className=\"hnav\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#nextbrain\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> NextBrain </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#videos\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Videos </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#pipeline\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Pipeline </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#publications\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Other publications </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#data\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Code and data </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#authors\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Authors </Link>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Link\n                        to=\"/home#credits\"\n                        scroll={el => { el.scrollIntoView(true); window.scrollBy(0, -100) }}> Credits </Link>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</nav>\n\t\t</header>\n\t);\n};\n\nexport default HomeNavigation;\n","import { FC } from \"react\";\nimport { NavLink } from \"react-router-dom\";\n\nimport banner from \"../assets/homepage-banner.png\";\nimport uclLogo from \"../assets/ucl-logo.png\";\nimport ercLogo from \"../assets/erc-logo.png\";\nimport euLogo from \"../assets/eu-logo.png\";\nimport pipelineImage from \"../assets/pipeline-image.7310f65e.png\";\n\nimport HomeNavigation from \"../components/layout/HomeNavigation\"\nimport \"./Home.css\";\n\n\nconst Atlas: FC = () => {\n\treturn (\n        <>\n\t\t    <HomeNavigation />\n            <main className=\"homepage-container\">\n\t\t\t<div className=\"homepage-header\" id=\"nextbrain\">\n\t\t\t\t<img className=\"header-banner\" src={banner} alt=\"logo\"></img>\n\n\t\t\t\t<h1 className=\"homepage-title\">\n\t\t\t\t\tNextBrain: a next-generation, histological atlas of the human brain for high-resolution neuroimaging studies.\n\t\t\t\t</h1>\n\t\t\t</div>\n\n\t\t\t<div className=\"homepage-body\">\n\t\t\t\t<p>\n\n\t\t\t\t    We present a next-generation probabilistic atlas   of the human brain using\n\t\t\t\t    histological sections of five full human hemispheres with manual annotations\n\t\t\t\t    for 333 regions of interest. This website enables the interactive inspection\n\t\t\t\t    of these five cases using a &nbsp;\n\t\t\t\t    <NavLink to=\"/atlas\" className={(navData) => (navData.isActive ? \" active\" : \"\")}>\n\t\t\t\t        3D navigation interface\n\t\t\t\t\t</NavLink>\n\t\t\t\t    &nbsp; and search functionality.\n\t\t\t\t</p>\n\n\t\t\t\t<p>\n\t\t\t\t\tA comprehensive description of the 3D probabilistic atlas and its application\n\t\t\t\t\tto brain Bayesian segmentation can be found in the following publication:\n\t\t\t\t</p>\n                    <p className=\"tab\">\n                        <b>A next-generation, histological atlas of the human brain\n                        and its application to automated brain MRI segmentation </b> <br />\n\n                        A. Casamitjana, M. Mancini, E. Robinson, L. Peter,  Ro. Annunziata, J. Althonayan,\n                        S. Crampsie, E. Blackburn,  <br />\n                        B. Billot, A. Atzeni, O. Puonti, Y.Balbastre,  P. Schmidt,\n                        J. Hughes, J.C. Augustinack, B.L. Edlow, L. Zöllei,  <br />\n                        D.L. Thomas, D. Kliemann, M. Bocchetta, C. Strand, J.L. Holton, Z. Jaunmuktane, J.E. Iglesias <br />\n                        Submitted (2024) <br />\n\n                        <cite>\n                            <a href=\"https://www.biorxiv.org/content/10.1101/2024.02.05.579016v2\">[pre-print]</a> &nbsp;&nbsp;\n                        </cite>\n\n                    </p>\n\n                    <br />\n                <section id=\"videos\">\n                    <h2>Videos</h2>\n                    <p>\n                        Some visualization material showing the 3D histology reconstruction of LFB, H&E and high\n                        resolution labels\n                        as well as its alignment to brain ex vivo MRI of case 5 (left) and the probabilistic atlas\n                        construction\n                        using all 5 cases (center) and a tutorial for the Data Explorer functionality (right)\n                    </p>\n\n                        <iframe width=\"500\" height=\"315\" src=\"https://www.youtube.com/embed/uRbUyC-KChk\"\n                                title=\"YouTube video player\"> AA\n                        </iframe>\n                        &nbsp;&nbsp;\n                        <iframe width=\"500\" height=\"315\" src=\"https://www.youtube.com/embed/bgpbX_2Hm74\"\n                                title=\"YouTube video player\"> AA\n                        </iframe>\n                        &nbsp;&nbsp;\n                        <iframe width=\"500\" height=\"315\" src=\"https://www.youtube.com/embed/pVOfximndPE\"\n                                title=\"YouTube video player\"> AA\n                        </iframe>\n\n                    <br/><br/><br/><br/>\n\n                    <p>\n                        The NextBrain data release includes a 200um isotropic labeling of the right hemisphere of the\n                        ex vivo scan publicly released by Edlow et al. in <em>“7 Tesla MRI of the ex vivo human brain at\n                        100 micron resolution”</em>, Scientific data 6, 244 (2019). The following two videos fly over the\n                        coronal and axial slices of the dataset (download links for the imaging volumes can be found\n                        under “Code and Data” below):\n\n                    </p>\n\n\n                        <iframe width=\"500\" height=\"315\" src=\"https://www.youtube.com/embed/bH09BVNjLek\"\n                                title=\"YouTube video player\"> AA\n                        </iframe>\n                        &nbsp;&nbsp;\n                        <iframe width=\"500\" height=\"315\" src=\"https://www.youtube.com/embed/SkX0GRm3p4c\"\n                                title=\"YouTube video player\"> AA\n                        </iframe>\n                </section>\n\n\n                <br/>\n                <br/>\n                <br/>\n                <br/>\n                <section id=\"pipeline\">\n                    <h2>Pipeline</h2>\n                    <p>\n                        The different steps of the pipeline from the fresh tissue donation to the joint multimodal 3D\n                        registration\n                        of LFB and HE stains, labels and MRI are summarized in the following figure:\n                    </p>\n                        <img className=\"pipeline-banner\" src={pipelineImage} alt=\"3D reconstruction pipeline\"></img>\n                </section>\n\n                <br/>\n                <br/>\n                <section id=\"publications\">\n                    <h2>Other publications</h2>\n                    <ul>\n                        <li>\n                            <p>\n                                The data acquisition and tissue processing pipeline are described in the\n                                following publication:\n                            </p>\n                                <b>A multimodal computational  pipeline for 3D histology of the human brain. </b> <br />\n                                M. Mancini, A. Casamitjana, L. Peter, E. Robinson,\n                                S. Crampsie, D.L. Thomas, J.L. Holton, Z. Jaunmuktane, J.E. Iglesias <br />\n                                Scientific Reports 10, 13839 (2020) <br />\n                                <cite>\n                                    <a href=\"https://www.nature.com/articles/s41598-020-69163-z\" target=\"_blank\">[article]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://www.biorxiv.org/content/10.1101/2020.02.10.941948.abstract\" target=\"_blank\">[arxiv]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://drive.google.com/uc?export=download&id=1QW3ouXj6y_oZ8Buu7FGSsrU9_DJQ3rIU\" target=\"_blank\">[citation]</a>\n                                </cite>\n                        </li>\n\n                        <li>\n                            <p>\n                                The histological sections are registered to the coordinate space of the\n                                ex vivo MRI using the pipeline described in the following publication:\n                            </p>\n\n                                <b>Robust joint registration of multiple\n                                stains and MRI for multimodal 3D histology reconstruction: Application\n                                to the Allen human brain atlas. </b> <br />\n                                A. Casamitjana, M. Lorenzi, S. Ferraris, L. Peter, M. Modat, A. Stevens, B. Fischl,\n                                T. Vercauteren, J.E. Iglesias <br />\n                                Medical image analysis 75 (2022) <br />\n                                <cite>\n                                    <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521003108\" target=\"_blank\">[article]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://arxiv.org/pdf/2104.14873.pdf\" target=\"_blank\">[arxiv]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://drive.google.com/uc?export=download&id=1QW3ouXj6y_oZ8Buu7FGSsrU9_DJQ3rIU\" target=\"_blank\">[citation]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://github.com/acasamitjana/3dhirest\" target=\"_blank\">[code]</a>\n                                </cite>\n                        </li>\n                        <li>\n                            <p>\n                                The histological sections are registered to the coordinate space of the\n                                ex vivo MRI using the pipeline described in the following publication:\n                            </p>\n\n                                <b> Synth-by-Reg (SbR): Contrastive learning for synthesis-based registration of paired\n                                images </b> <br />\n                                A. Casamitjana, M. Mancini, J.E. Iglesias <br />\n                                Simulation and Synthesis in Medical Imaging Workshop (SASHIMI, 2021) <br />\n                                <cite>\n                                    <a href=\"https://link.springer.com/chapter/10.1007/978-3-030-87592-3_5\" target=\"_blank\">[article]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://arxiv.org/pdf/2107.14449.pdf\" target=\"_blank\">[arxiv]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://drive.google.com/uc?export=download&id=1QW3ouXj6y_oZ8Buu7FGSsrU9_DJQ3rIU\" target=\"_blank\">[citation]</a> &nbsp;&nbsp;\n                                </cite>\n\n                                <cite>\n                                    <a href=\"https://github.com/acasamitjana/SynthByReg\" target=\"_blank\">[code]</a>\n                                </cite>\n                        </li>\n\n                    </ul>\n                </section>\n\n\t\t\t\t<br />\n\t\t\t\t<br />\n\t\t\t\t<section id=\"data\">\n                    <h2>Code and data</h2>\n                    <ul>\n                        <li>\n                            <p>\n                                The raw data of the project can be found here:\n                            </p>\n                            <b>Registered histology, MRI, and manual annotations of over 300 brain regions in 5 human\n                                hemispheres (data from ERC Starting Grant 677697 \"BUNGEE-TOOLS\") </b> <br/>\n                            J.E Iglesias Gonzalez, A. Casamitjana, A. Atzeni, B. Billot, D. Thomas, E. Blackburn, J.\n                            Hughes,\n                            J. Althonayan, L. Peter, M. Mancini, N. Robinson, P. Schmidt, S. Crampsie <br/>\n                            <cite>\n                                <a href=\"https://doi.org/10.5522/04/24243835.v1\" target=\"_blank\">[data repository]</a> &nbsp;&nbsp;\n                            </cite>\n                            <cite>\n                                <a href=\"https://drive.google.com/uc?export=download&id=1QW3ouXj6y_oZ8Buu7FGSsrU9_DJQ3rIU\" target=\"_blank\">[citation]</a>\n                            </cite>\n                        </li>\n                        <li>\n                            <p>\n                                Code used for the 3D histology reconstruction\n                            </p>\n                            <cite>\n                                <a href=\"https://github.com/acasamitjana/ERC_reconstruction\" target=\"_blank\">[github]</a> &nbsp;&nbsp;\n                            </cite>\n                        </li>\n                        <li>\n                            <p>\n                                Bayesian segmentation using NextBrain probabilistic atlas\n                            </p>\n                            <cite>\n                                <a href=\"https://surfer.nmr.mgh.harvard.edu/fswiki/HistoAtlasSegmentation\" target=\"_blank\">[ready-to-use\n                                    tool in FreeSurfer]</a> &nbsp;&nbsp;\n                            </cite>\n                            <cite>\n                                <a href=\"https://github.com/freesurfer/freesurfer/tree/dev/mri_histo_util\" target=\"_blank\">[github]</a> &nbsp;&nbsp;\n                            </cite>\n                        </li>\n\n                        <li>\n                            <p>\n                                200um isotropic labeling of the right hemisphere of the ex vivo scan publicly released\n                                by Edlow et al., (2019).\n                                <br/>\n                                We include the original scan, the manual segmentation and the look-up-table (LUT) in\n                                freeview format for label visualization.\n                            </p>\n                            <cite>\n                                    <a href=\"https://openneuro.org/datasets/ds005422\"\n                                       target=\"_blank\">[data repository]</a> &nbsp;&nbsp;\n                                </cite>\n                            <cite>\n                            <a href=\"https://openneuro.org/crn/datasets/ds005422/files/sub-001:ses-01:anat:sub-001_ses-01_T2w.nii.gz\"\n                               target=\"_blank\">[original scan]</a> &nbsp;&nbsp;\n                            </cite>\n                            <cite>\n                                <a href=\"https://openneuro.org/crn/datasets/ds005422/files/derivatives:manual_segmentation:sub-001:ses-01:sub-001_ses-01_desc-manual_dseg.nii.gz\"\n                                   target=\"_blank\">[manual segmentation]</a> &nbsp;&nbsp;\n                            </cite>\n                            <cite>\n                                <a href=\"https://openneuro.org/crn/datasets/ds005422/files/derivatives:manual_segmentation:sub-001:sub-001_lut.txt\"\n                                   target=\"_blank\">[LUT]</a> &nbsp;&nbsp;\n                            </cite>\n\n                            <p>\n                                You can open these files in Freeview with the command:\n                            </p>\n                            <p>\n                                <em> freeview -v sub-001_ses-01_T2w.nii.gz\n                                    sub-001_ses-01_desc-manual_dseg.nii.gz:colormap=lut:lut=sub-001_lut.txt </em>\n                            </p>\n\n                        </li>\n\n\n                    </ul>\n                </section>\n\n\n                <br/>\n                <br/>\n                <section id=\"authors\">\n                    <h2>Authors</h2>\n                    <ul>\n                        <li><p><b>James Hughes</b><br/>\n                            [<a title=\"\" href=\"https://github.com/jhughes982\" target=\"_blank\" rel=\"noopener\">Github</a>]\n                        </p>\n                        </li>\n\n                        <li><p><b> Peter Schmidt</b><br/>\n                            [<a title=\"\" href=\"https://github.com/pweschmidt\" target=\"_blank\" rel=\"noopener\">Github</a>]\n                        </p>\n                        </li>\n\n                        <li><p><b>Adria Casamitjana</b><br />\n                        a.casamitjana [at] ub.edu<br />\n                        [<a title=\"\" href=\"https://twitter.com/therelaxationt1\" target=\"_blank\" rel=\"noopener\">Twitter</a>  |  \n                        <a title=\"\" href=\"https://scholar.google.com/citations?user=phHLLH0AAAAJ&hl=ca&oi=ao\" target=\"_blank\" rel=\"noopener\">Scholar</a>]</p>\n                        </li>\n\n                        <li><p><b>Juan Eugenio Iglesias</b><br />\n                        jiglesiasgonzalez [at] mgh.harvard.edu<br />\n                        [<a title=\"\" href=\"https://twitter.com/JuanEugenioIgl1\" target=\"_blank\" rel=\"noopener\">Twitter</a>  |  \n                        <a title=\"\" href=\"https://www.linkedin.com/in/juan-eugenio-iglesias-820565127/\" target=\"_blank\" rel=\"noopener\">Linkedin</a>  |  \n                        <a title=\"\" href=\"https://scholar.google.com/citations?user=_f2iSSQAAAAJ\" target=\"_blank\" rel=\"noopener\">Scholar</a>]</p>\n                        </li>\n                    </ul>\n                </section>\n\n\t\t\t\t<br />\n\t\t\t\t<br />\n\t\t\t\t<h2  id=\"credits\">Credits</h2>\n                    <p>\n                    This research is primarily funded by the European Research Council{\" \"}\n                    </p>\n\n\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://cordis.europa.eu/project/id/677697\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\tclassName=\"reference\"\n\t\t\t\t\t>\n\t\t\t\t\t\t(Starting Grant 677696, project \"BUNGEE-TOOLS\")\n\t\t\t\t\t</a>\n\t\t\t\t\t.\n\n\t\t\t</div>\n\n\t\t\t<div className=\"homepage-footer\">\n\t\t\t\t<img className=\"footer-logo\" src={uclLogo} alt=\"logo\"></img>\n\t\t\t\t<img className=\"footer-logo\" src={ercLogo} alt=\"logo\"></img>\n\t\t\t\t<img className=\"footer-logo\" src={euLogo} alt=\"logo\"></img>\n\t\t\t</div>\n\n\n\n\n\t\t</main>\n        </>\n\t);\n};\n\nexport default Atlas;\n","export default \"data:image/png;base64,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\"","import { FC } from \"react\";\n\nimport \"./LoadingSpinner.css\";\n\ninterface Props {\n\tasOverlay: boolean;\n\tmessage: string;\n}\n\nconst LoadingSpinner: FC<Props> = (props) => {\n\treturn (\n\t\t<div className={`${props.asOverlay && \"loading-spinner__overlay\"}`}>\n\t\t\t<div className=\"lds-dual-ring\"></div>\n\t\t\t<div>{props.message}</div>\n\t\t</div>\n\t);\n};\n\nexport default LoadingSpinner;\n","export const ASSETS_URL = \"https://raw.githubusercontent.com/UCL/\";\n","import { FC } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport \"./Backdrop.css\";\n\ninterface Props {\n\tonClick: () => void;\n}\n\n// is ! appropriate here?\nconst Backdrop: FC<Props> = (props) => {\n\treturn ReactDOM.createPortal(\n\t\t<div className=\"backdrop\" onClick={props.onClick}></div>,\n\t\tdocument.getElementById(\"backdrop-hook\")!\n\t);\n};\n\nexport default Backdrop;\n","import React, { CSSProperties, FC, ReactElement } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { CSSTransition } from \"react-transition-group\";\n\nimport Backdrop from \"./Backdrop\";\nimport \"./Modal.css\";\n\ninterface ModalOverlayProps {\n\tclassName?: string;\n\tstyle?: CSSProperties | null | undefined; // is this a good solution?\n\theaderClass?: string;\n\theader?: string;\n\tonSubmit?: () => void | undefined;\n\tcontentClass?: string;\n\tfooterClass?: string;\n\tfooter?: ReactElement;\n}\n\ninterface ModalProps extends ModalOverlayProps {\n\tshow: boolean;\n\tonCancel: () => void;\n}\n\nconst ModalOverlay: FC<ModalOverlayProps> = (props) => {\n\tconst content = (\n\t\t<div className={`modal ${props.className}`} style={props.style!}>\n\t\t\t<header className={`modal__header ${props.headerClass}`}>\n\t\t\t\t<h2>{props.header}</h2>\n\t\t\t</header>\n\t\t\t<form\n\t\t\t\tonSubmit={\n\t\t\t\t\tprops.onSubmit ? props.onSubmit : (event) => event.preventDefault()\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t<div className={`modal__content ${props.contentClass}`}>\n\t\t\t\t\t{props.children}\n\t\t\t\t</div>\n\t\t\t\t<footer className={`modal__footer ${props.footerClass}`}>\n\t\t\t\t\t{props.footer}\n\t\t\t\t</footer>\n\t\t\t</form>\n\t\t</div>\n\t);\n\treturn ReactDOM.createPortal(content, document.getElementById(\"modal-hook\")!);\n};\n\nconst Modal: FC<ModalProps> = (props) => {\n\treturn (\n\t\t<>\n\t\t\t{props.show && <Backdrop onClick={props.onCancel} />}\n\t\t\t<CSSTransition\n\t\t\t\tin={props.show}\n\t\t\t\tmountOnEnter\n\t\t\t\tunmountOnExit\n\t\t\t\ttimeout={200}\n\t\t\t\tclassNames=\"modal\"\n\t\t\t>\n\t\t\t\t<ModalOverlay {...props} />\n\t\t\t</CSSTransition>\n\t\t</>\n\t);\n};\n\nexport default Modal;\n","import { FC } from \"react\";\n\nimport \"./Button.css\";\n\ninterface ButtonProps extends React.ComponentProps<\"button\"> {\n\thref?: string;\n\tinverse?: boolean;\n\tdanger?: boolean;\n\tsize?: string;\n\tonClick?: () => void;\n}\n\nconst Button: FC<ButtonProps> = (props) => {\n\tif (props.href) {\n\t\treturn (\n\t\t\t<a\n\t\t\t\tclassName={`button button--${props.size || \"default\"} ${\n\t\t\t\t\tprops.inverse && \"button--inverse\"\n\t\t\t\t} ${props.danger && \"button--danger\"}`}\n\t\t\t\thref={props.href}\n\t\t\t>\n\t\t\t\t{props.children}\n\t\t\t</a>\n\t\t);\n\t}\n\n\treturn (\n\t\t<button\n\t\t\tclassName={`button button--${props.size || \"default\"} ${\n\t\t\t\tprops.inverse && \"button--inverse\"\n\t\t\t} ${props.danger && \"button--danger\"}`}\n\t\t\ttype={props.type}\n\t\t\tonClick={props.onClick}\n\t\t\tdisabled={props.disabled}\n\t\t>\n\t\t\t{props.children}\n\t\t</button>\n\t);\n};\n\nexport default Button;\n","import { FC } from \"react\";\n\nimport Modal from \"./Modal\";\nimport Button from \"./Button\";\n\ninterface Props {\n\tonClear: () => void;\n\terror: string | null;\n}\n\nconst ErrorModal: FC<Props> = (props) => {\n\treturn (\n\t\t<Modal\n\t\t\tonCancel={props.onClear}\n\t\t\theader=\"Oops!\"\n\t\t\tshow={!!props.error}\n\t\t\tfooter={<Button onClick={props.onClear}>Okay</Button>}\n\t\t>\n\t\t\t<p>{props.error}</p>\n\t\t</Modal>\n\t);\n};\n\nexport default ErrorModal;\n","// coordinates are calculated specifically for each plane\n// refer to the top level readme for guidance on how the coordinates are calculated\n// adjusted coords are used to account for coordinate space differences between the web app and ITKSnap\n\nconst calculateMriImageCoords = (\n\tcurrentMriPlane: string,\n\tcurrentMriSlice: number,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tadjustedMriSlice: number,\n\tadjustedMriMouseX: number,\n\tadjustedMriMouseY: number\n) => {\n\tlet newMriCoords;\n\n\tswitch (currentMriPlane) {\n\t\tcase \"sagittal\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: currentMriMouseX,\n\t\t\t\t\tmouseX: adjustedMriSlice,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: adjustedMriSlice,\n\t\t\t\t\tmouseY: adjustedMriMouseX,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tcase \"coronal\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: adjustedMriMouseX,\n\t\t\t\t\tmouseX: currentMriSlice,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tcase \"axial\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: adjustedMriMouseX,\n\t\t\t\t\tmouseX: adjustedMriMouseY,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnewMriCoords = undefined;\n\t}\n\n\treturn newMriCoords;\n};\n\nexport default calculateMriImageCoords;\n","// a helper function that loads in a matrix txt file\n// we multiply the matrix by a vector point (i.e. our image coords) to get a new set of coords\n\nimport { ASSETS_URL } from \"./ASSETS_URL\";\n\nconst getMatrix = async (\n\tcurrentBlock: number,\n\ttype: string,\n\tpatientId: string\n) => {\n\tconst paddedBlock = currentBlock.toString().padStart(2, \"0\");\n\n\tlet fileUrl = \"\";\n\tlet txtFile;\n\n\t// fetch the txt file from remote server\n\tif (type === \"mri\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/mri_rotated/matrices/block_${paddedBlock}.txt`;\n\t}\n\n\tif (type === \"mri_hr\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/mri_rotated/matrices_hr/block_${paddedBlock}.txt`;\n\t}\n\n\tif (type === \"histology\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/histology/${paddedBlock}/matrix.txt`;\n\t}\n\n\tif (type === \"histology_hr\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/histology_hr/${paddedBlock}/matrix.txt`;\n\t}\n\n\tconst file = await fetch(fileUrl);\n\n\ttxtFile = await file.text();\n\n\tconst matrix = await parseMatrixTxt(txtFile);\n\n\treturn matrix;\n};\n\n// custom parser to transform matrix txt data into an array\nconst parseMatrixTxt = async (file: string) => {\n\tlet removedLineBreaks = file.replace(/\\n/g, \" \");\n\n\tvar txtToArray = removedLineBreaks.split(\" \");\n\ttxtToArray.pop();\n\n\t// convert the array of strings to numbers\n\tconst arrayAsNumbers = txtToArray.map((element) => {\n\t\treturn Number(element);\n\t});\n\n\treturn arrayAsNumbers;\n};\n\nexport default getMatrix;\n","// multiplies a 4x4 matrix by a vector point\n// for a worked example of matrix multiplication see https://matrix.reshish.com/multCalculation.php\n\nconst multiplyMatrixAndPoint = (matrix: number[], point: number[]) => {\n\t// Give a variable name to each part of the matrix, a column and row number\n\tlet c0r0 = matrix[0],\n\t\tc1r0 = matrix[1],\n\t\tc2r0 = matrix[2],\n\t\tc3r0 = matrix[3];\n\tlet c0r1 = matrix[4],\n\t\tc1r1 = matrix[5],\n\t\tc2r1 = matrix[6],\n\t\tc3r1 = matrix[7];\n\tlet c0r2 = matrix[8],\n\t\tc1r2 = matrix[9],\n\t\tc2r2 = matrix[10],\n\t\tc3r2 = matrix[11];\n\tlet c0r3 = matrix[12],\n\t\tc1r3 = matrix[13],\n\t\tc2r3 = matrix[14],\n\t\tc3r3 = matrix[15];\n\n\t// set some names for the point\n\tlet x = point[0];\n\tlet y = point[1];\n\tlet z = point[2];\n\tlet w = point[3];\n\n\t// perform matrix multiplication operations\n\tlet resultX = x * c0r0 + y * c1r0 + z * c2r0 + w * c3r0;\n\tlet resultY = x * c0r1 + y * c1r1 + z * c2r1 + w * c3r1;\n\tlet resultZ = x * c0r2 + y * c1r2 + z * c2r2 + w * c3r2;\n\tlet resultW = x * c0r3 + y * c1r3 + z * c2r3 + w * c3r3;\n\n\t// resultW is not used but is necessary to perform the multiplication\n\tconst matrixResult = { resultX, resultY, resultZ, resultW };\n\n\treturn matrixResult;\n};\n\nexport default multiplyMatrixAndPoint;\n","import npyjs from \"npyjs\";\nimport ndarray from \"ndarray\";\n\nimport getMatrix from \"./getMatrix\";\nimport matrixMultiplier from \"./matrixMultiplier\";\nimport { ASSETS_URL } from \"./ASSETS_URL\";\n\nimport { MriCoords } from \"../../models/mriCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../models/atlasImagesDimensionsKey.model\";\n\nconst calculateHistologyImageCoords = async (\n\tcurrentMriPlane: string,\n\tcurrentMriCoords: MriCoords,\n\tpatientId: string,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\tconst currentMriMouseX = currentMriCoords[currentMriPlane][\"mouseX\"];\n\tconst currentMriMouseY = currentMriCoords[currentMriPlane][\"mouseY\"];\n\tconst currentMriSlice = currentMriCoords[currentMriPlane][\"slice\"];\n\n\tconst currentBlock = await getCurrentBlock(\n\t\tcurrentMriPlane,\n\t\tcurrentMriMouseX,\n\t\tcurrentMriMouseY,\n\t\tcurrentMriSlice,\n\t\tpatientId,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tprocess.env.NODE_ENV === \"development\" &&\n\t\tconsole.log(\"current block: \" + currentBlock);\n\n\tif (currentBlock === 0 || currentBlock === undefined) return \"no block found\";\n\n\tconst matrixLowRes = await getMatrix(currentBlock, \"mri\", patientId);\n\tconst matrixHiRes = await getMatrix(currentBlock, \"mri_hr\", patientId);\n\n\tif (matrixLowRes === undefined || matrixHiRes === undefined)\n\t\treturn \"no matrix found\";\n\n\tconst histologyImageCoordsLowRes = getHistologyImageCoords(\n\t\tcurrentMriCoords,\n\t\tmatrixLowRes,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconst histologyImageCoordsHiRes = getHistologyImageCoords(\n\t\tcurrentMriCoords,\n\t\tmatrixHiRes,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconst currentHistologyOrientation =\n\t\tatlasImagesDimensionsKey!.histologyLowResDimensions[\n\t\t\tcurrentBlock\n\t\t].orientation.toString();\n\n\treturn {\n\t\tcoordsLowRes: histologyImageCoordsLowRes.coords,\n\t\tcoordsHiRes: histologyImageCoordsHiRes.coords,\n\t\tcurrentHistologySlice: histologyImageCoordsLowRes.slice, // slice is the same for both hi and low res\n\t\tcurrentHistologyBlock: currentBlock, // block is the same for both hi and low res\n\t\tcurrentHistologyOrientation: currentHistologyOrientation, // orientation is the same for both hi and low res\n\t};\n};\n\nconst getHistologyImageCoords = (\n\tcurrentMriCoords: MriCoords,\n\tmatrix: number[],\n\tcurrentBlock: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\tconst coords = matrixMultiplier(matrix, [\n\t\tcurrentMriCoords.sagittal.slice,\n\t\tcurrentMriCoords.coronal.slice,\n\t\tcurrentMriCoords.axial.slice,\n\t\t1,\n\t]);\n\n\tlet { resultX, resultY, resultZ } = validateCoords(\n\t\tcoords,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconst histologyImageCoords = {\n\t\tmouseX: +resultY.toFixed(0),\n\t\tmouseY: +resultX.toFixed(0),\n\t};\n\n\tconst histologySlice = +resultZ.toFixed(0);\n\n\treturn { coords: histologyImageCoords, slice: histologySlice };\n};\n\nconst getCurrentBlock = async (\n\tcurrentMriPlane: string,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tcurrentMriSlice: number,\n\tpatientId: string,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\tlet currentBlock;\n\tlet n = new npyjs();\n\n\tprocess.env.NODE_ENV === \"development\" &&\n\t\tconsole.log(\"current slice: \" + currentMriSlice);\n\n\tconst paddedSlice = currentMriSlice.toFixed(0).padStart(3, \"0\");\n\n\tlet npyFile;\n\ttry {\n\t\tnpyFile = `${ASSETS_URL}${patientId}/mri_rotated/indices_${currentMriPlane}/slice_${paddedSlice}.npy`;\n\t} catch (e) {\n\t\tconsole.log(e);\n\t}\n\n\t// parse the raw npy file as a readable npy array\n\tconst npyArray = await n.load(npyFile);\n\n\tlet ndArray = ndarray(npyArray.data, npyArray.shape);\n\n\t// the numpy arrays in the data are the opposite of the image dimensions, so a transposition is needed\n\tndArray = await ndArray.transpose(1, 0);\n\n\tif (currentMriPlane === \"sagittal\") {\n\t\t// sagittal has an additional horizontal flip, so we need to account for that here\n\t\t// since its been flipped, we dont need to take the adjustedMriMouseX... we just take the normal currentMriMouseX\n\t\tcurrentBlock = ndArray.get(\n\t\t\tcurrentMriMouseX,\n\t\t\tndArray.shape[1] -\n\t\t\t\t(+atlasImagesDimensionsKey!.mriDimensions.sagittal.height -\n\t\t\t\t\tcurrentMriMouseY)\n\t\t);\n\t}\n\n\tif (currentMriPlane === \"coronal\" || currentMriPlane === \"axial\") {\n\t\tcurrentBlock = ndArray.get(currentMriMouseX, currentMriMouseY);\n\t}\n\n\treturn currentBlock;\n};\n\nconst validateCoords = (\n\tcoords: { resultX: number; resultY: number; resultZ: number },\n\tcurrentBlock: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\t// we need to convert negative numbers to zero to avoid errors and load the right slice\n\tlet resultX = coords.resultX < 0 ? 0 : coords.resultX;\n\tlet resultY = coords.resultY < 0 ? 0 : coords.resultY;\n\tlet resultZ = coords.resultZ < 0 ? 0 : coords.resultZ;\n\n\t// if returned slice exceeds the number of slices in the block (within +2 slices) then return the maximum slice number\n\t// we make an adjustment to account for the fact that slices start at 0 within a block\n\t// if returned slice exceeds maximum number of slices +2 then its a calcultion bug\n\tif (\n\t\tresultZ >\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices -\n\t\t\t\t1 &&\n\t\tresultZ <\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices +\n\t\t\t\t1\n\t) {\n\t\tresultZ =\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices - 1;\n\t}\n\n\treturn { resultX, resultY, resultZ };\n};\n\nexport default calculateHistologyImageCoords;\n","import { AtlasImagesDimensionsKey } from \"../../models/atlasImagesDimensionsKey.model\";\n\nconst calculateAdjustedMriCoords = (\n\tcurrentMriPlane: string,\n\tcurrentMriSlice: number,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\t// adjusting coordinates to account for images not being in the correct orientations\n\t// in other words, I have to account for orientation differences between the web application and ITKSnap\n\t// specifically, ITKSnap has the 0,0 coordinate at the bottom right, whereas the web application has 0,0 at the top left\n\n\tlet adjustedMriSlice;\n\tlet adjustedMriMouseX;\n\tlet adjustedMriMouseY;\n\n\tif (currentMriPlane === \"sagittal\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.slices -\n\t\t\tcurrentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.width -\n\t\t\tcurrentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.height -\n\t\t\tcurrentMriMouseY;\n\t}\n\n\tif (currentMriPlane === \"coronal\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.slices - currentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.width - currentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.height -\n\t\t\tcurrentMriMouseY;\n\t}\n\n\tif (currentMriPlane === \"axial\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.slices - currentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width - currentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height - currentMriMouseY;\n\t}\n\n\treturn { adjustedMriSlice, adjustedMriMouseX, adjustedMriMouseY };\n};\n\nexport default calculateAdjustedMriCoords;\n","import JSZip from \"jszip\";\n\nexport default class npzParser {\n\tasync readFileAsync(file: Blob) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet reader = new FileReader();\n\n\t\t\treader.onload = () => {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\n\t\t\treader.onerror = reject;\n\n\t\t\treader.readAsArrayBuffer(file);\n\t\t});\n\t}\n\n\t// uncompresses and parses a raw .npz file\n\tasync parseNpz(arrayBuffer: ArrayBuffer) {\n\t\tlet zip = new JSZip();\n\n\t\tconst npzUint8Array = new Uint8Array(arrayBuffer); // parse the arrayBuffer as a uint8Array\n\n\t\tconst loadedZip = await zip.loadAsync(npzUint8Array); // get all files in the zip\n\n\t\tconst fileName = Object.entries(loadedZip.files)[0][0]; // the name of the file inside the zip file\n\n\t\t// parse the loaded zip as an arrayBuffer\n\t\tconst unzippedArrayBuffer = await loadedZip\n\t\t\t.file(fileName)!\n\t\t\t.async(\"arraybuffer\");\n\n\t\t// we need to parse both the uint8array data and the uint16 array data from the zip\n\t\t// we get the header info from the unit8 data\n\t\t// and we get the npy array data from the uint16 data (because the data is encoded as int16)\n\n\t\t// create the header data from the uint8Array data\n\t\tconst headerData = new Uint8Array(unzippedArrayBuffer);\n\t\tconst hcontents = new TextDecoder(\"utf-8\").decode(\n\t\t\tnew Uint8Array(headerData.slice(10, 10 + 118))\n\t\t);\n\n\t\tconst header = JSON.parse(\n\t\t\thcontents\n\t\t\t\t.toLowerCase() // True -> true\n\t\t\t\t.replace(/'/g, '\"')\n\t\t\t\t.replace(\"(\", \"[\")\n\t\t\t\t.replace(/,*\\),*/g, \"]\")\n\t\t);\n\n\t\t// get the npy array data from the uint16array\n\t\tconst npyData = {\n\t\t\tdata: new Uint16Array(unzippedArrayBuffer.slice(128)),\n\t\t\theader: header,\n\t\t};\n\n\t\treturn npyData;\n\t}\n\n\tasync load(filename: RequestInfo) {\n\t\t// Loads an array from a stream of bytes.\n\t\tconst self = this;\n\t\treturn fetch(filename)\n\t\t\t.then((fetchedFile) => {\n\t\t\t\tif (fetchedFile.ok) {\n\t\t\t\t\treturn fetchedFile\n\t\t\t\t\t\t.blob()\n\t\t\t\t\t\t.then((blobData) => {\n\t\t\t\t\t\t\treturn self.readFileAsync(blobData).then((arrayBuffer) => {\n\t\t\t\t\t\t\t\treturn self.parseNpz(arrayBuffer as ArrayBuffer);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => console.error(err));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n}\n","import ndarray from \"ndarray\";\n\nimport npzParser from \"./npzParser\";\nimport { ASSETS_URL } from \"./ASSETS_URL\";\n\nimport { HistologyCoords } from \"../../models/histologyCoords.model\";\n\nconst histologyLabelParser = async (\n\thistologyImageCoords: HistologyCoords,\n\tshowHiRes: boolean,\n\tpatientId: string\n) => {\n\tconst labelsFile = await require(`../../assets/WholeHemisphereFS.json`);\n\n\tconst currentLabelNumber = await getCurrentLabelNumber(\n\t\thistologyImageCoords,\n\t\tshowHiRes,\n\t\tpatientId\n\t);\n\n\tconst currentLabel = labelsFile[currentLabelNumber];\n\n\treturn currentLabel;\n};\n\nconst getCurrentLabelNumber = async (\n\thistologyImageCoords: HistologyCoords,\n\tshowHiRes: boolean,\n\tpatientId: string\n) => {\n\t// label numbers are extracted from multi dimensional numpy arrays (extracted from compressed npz files)\n\t// the numpy array takes in x and y mouse coordinates to point to an index\n\t// the index returns the label number\n\n\tconst n = new npzParser(); // uncompresses and parses an npz file\n\tconst coordsProp = showHiRes ? \"coordsHiRes\" : \"coordsLowRes\";\n\tconst histologyFolder = showHiRes ? \"histology_hr\" : \"histology\";\n\n\tconst paddedBlock = histologyImageCoords.currentHistologyBlock\n\t\t.toString()\n\t\t.padStart(2, \"0\");\n\n\tconst paddedSlice = histologyImageCoords.currentHistologySlice\n\t\t.toString()\n\t\t.padStart(2, \"0\");\n\n\tconst npzFile = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_labels_npz/slice_${paddedSlice}.npz`;\n\n\t// add error catching here?\n\tconst npyData = await n.load(npzFile); // returns uncompressed raw contents of an npz file\n\n\tlet ndArray = ndarray(npyData!.data, npyData!.header.shape);\n\n\tndArray = await ndArray.transpose(1, 0);\n\n\tconst currentLabelNumber = ndArray.get(\n\t\thistologyImageCoords[coordsProp].mouseX.toFixed(0),\n\t\thistologyImageCoords[coordsProp].mouseY.toFixed(0)\n\t);\n\n\treturn currentLabelNumber;\n};\n\nexport default histologyLabelParser;\n","// converts between hi-res and low-res versions of histology mouse coords\n\nimport { AtlasImagesDimensionsKey } from \"../../models/atlasImagesDimensionsKey.model\";\n\nconst convertHistologyMouseCoords = (\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null,\n\tcurrentHistologyMouseX: number,\n\tcurrentHistologyMouseY: number,\n\tcurrentHistologyBlock: number,\n\tshowHiRes: boolean\n) => {\n\tif (showHiRes) {\n\t\t// returns low res versions of mouseX and mouseY given hi-res versions\n\t\tconst lowResMouseX =\n\t\t\t(+atlasImagesDimensionsKey!.histologyLowResDimensions[\n\t\t\t\tcurrentHistologyBlock\n\t\t\t].width /\n\t\t\t\t+atlasImagesDimensionsKey!.histologyHiResDimensions[\n\t\t\t\t\tcurrentHistologyBlock\n\t\t\t\t].width) *\n\t\t\tcurrentHistologyMouseX;\n\n\t\tconst lowResMouseY =\n\t\t\t(+atlasImagesDimensionsKey!.histologyLowResDimensions[\n\t\t\t\tcurrentHistologyBlock\n\t\t\t].height /\n\t\t\t\t+atlasImagesDimensionsKey!.histologyHiResDimensions[\n\t\t\t\t\tcurrentHistologyBlock\n\t\t\t\t].height) *\n\t\t\tcurrentHistologyMouseY;\n\n\t\treturn { lowResMouseX, lowResMouseY };\n\t}\n\n\tif (!showHiRes) {\n\t\t// returns hi res versions of mouseX and mouseY given low-res versions\n\t\tconst hiResMouseX =\n\t\t\t(+atlasImagesDimensionsKey!.histologyHiResDimensions[\n\t\t\t\tcurrentHistologyBlock\n\t\t\t].width /\n\t\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[\n\t\t\t\t\tcurrentHistologyBlock\n\t\t\t\t].width) *\n\t\t\tcurrentHistologyMouseX;\n\n\t\tconst hiResMouseY =\n\t\t\t(+atlasImagesDimensionsKey!.histologyHiResDimensions[\n\t\t\t\tcurrentHistologyBlock\n\t\t\t].height /\n\t\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[\n\t\t\t\t\tcurrentHistologyBlock\n\t\t\t\t].height) *\n\t\t\tcurrentHistologyMouseY;\n\n\t\treturn { hiResMouseX, hiResMouseY };\n\t}\n\n\t// fallback coordinates to produce error\n\treturn { mouseX: -1, mouseY: -1 };\n};\n\nexport default convertHistologyMouseCoords;\n","import { FC } from \"react\";\n\nimport \"./MousePointer.css\";\n\ninterface Props {\n\tmouseY: number;\n\tmouseX: number;\n\tshowHiRes?: boolean;\n}\n\nconst MousePointer: FC<Props> = (props) => {\n\tconst { mouseY, mouseX, showHiRes } = props;\n\n\tif (mouseX != null && mouseY != null) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={`mouse-pointer ${showHiRes && \"mouse-hi-res\"}`}\n\t\t\t\tstyle={{\n\t\t\t\t\ttop: mouseY,\n\t\t\t\t\tleft: mouseX,\n\t\t\t\t}}\n\t\t\t></div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tstyle={{\n\t\t\t\tposition: \"relative\",\n\t\t\t\ttop: 50,\n\t\t\t\tleft: 50,\n\t\t\t\tzIndex: 1,\n\t\t\t}}\n\t\t>\n\t\t\terror: no mouse coords found\n\t\t</div>\n\t);\n};\n\nexport default MousePointer;\n","import { FC, useEffect, useState } from \"react\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport MousePointer from \"../../shared/MousePointer\";\n\nimport { MriCoords } from \"../../../models/mriCoords.model\";\n\nimport \"./MriImage.css\";\n\ninterface Props {\n\tpatientId: string;\n\tplane: string;\n\tmriImageCoords: MriCoords | null;\n\tcomputeMriImagesHandler: (\n\t\te: React.MouseEvent<Element, MouseEvent>,\n\t\tplane: string\n\t) => void;\n}\n\nconst MriImage: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [mriImage, setMriImage] = useState(\"\");\n\tconst [currentSlice, setCurrentSlice] = useState(\"\");\n\n\tconst { patientId, plane, mriImageCoords, computeMriImagesHandler } = props;\n\n\tuseEffect(() => {\n\t\t// determine the correct mri image based on computed coordinates\n\n\t\tconst paddedSlice = mriImageCoords!\n\t\t\t[plane]!.slice.toFixed(0)\n\t\t\t.padStart(3, \"0\");\n\n\t\tsetCurrentSlice(paddedSlice);\n\n\t\tconst getMriImage = async () => {\n\t\t\ttry {\n\t\t\t\tsetIsLoading(true);\n\t\t\t\tconst mriImageUrl = `${ASSETS_URL}${patientId}/mri_rotated/slices_${plane}/slice_${paddedSlice}.png`;\n\n\t\t\t\tconst response = await fetch(mriImageUrl);\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tconst imageBlob = await response.blob();\n\n\t\t\t\t\tconst imageObjectURL = URL.createObjectURL(imageBlob);\n\n\t\t\t\t\tsetMriImage(imageObjectURL);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsetError(\"Error, could not load mri image\");\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tgetMriImage();\n\t}, [mriImageCoords, plane, patientId]);\n\n\tif (mriImage == null || mriImage === \"\" || currentSlice == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{/* <ErrorModal error={error} onClear={() => setError(null)} /> */}\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<LoadingSpinner asOverlay={false} message={\"Loading...\"} />\n\t\t\t\t)}\n\t\t\t\t{!isLoading && <div>Failed to load mri image</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t<div className={`mri-img ${plane}`}>\n\t\t\t\t<div className={`mri-img-container ${plane}`}>\n\t\t\t\t\t<MousePointer\n\t\t\t\t\t\tmouseY={mriImageCoords![plane].mouseY}\n\t\t\t\t\t\tmouseX={mriImageCoords![plane].mouseX}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<img\n\t\t\t\t\t\tonClick={(e) => computeMriImagesHandler(e, plane)}\n\t\t\t\t\t\tclassName={`${plane}-img`}\n\t\t\t\t\t\tsrc={mriImage}\n\t\t\t\t\t\talt={`${plane}-slice${currentSlice}`}\n\t\t\t\t\t></img>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default MriImage;\n","// the returned mouse coords are relative to the scale of its parent container\n// for instance if the parent container image is 1000 x 1000 but has been scaled with css (e.g. max-height: 500px)\n// then the returned mouse coords will be relative to this new scale\n// for this reason, some components also run additional functions to calculate the natural x and y coords\n\n// not sure why this union type isnt working\n// type MouseCoords = React.MouseEvent | MouseEvent;\n\nconst getMouseCoords = (e: any, showHiRes: boolean) => {\n\tconst mouseX = !showHiRes ? e.nativeEvent.offsetX : e.offsetX;\n\tconst mouseY = !showHiRes ? e.nativeEvent.offsetY : e.offsetY;\n\n\treturn { mouseX, mouseY };\n};\n\nexport default getMouseCoords;\n","import { FC } from \"react\";\n\nimport MriImage from \"./MriImage\";\nimport getMouseCoords from \"../../utils/getMouseCoords\";\n\nimport { MriCoords } from \"../../../models/mriCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\ninterface Props {\n\tpatientId: string;\n\tmriImageCoords: MriCoords | null;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tupdateMriAndHistologyImages: (\n\t\tplane: string,\n\t\tcurrentSlice: number,\n\t\tmouseX: number,\n\t\tmouseY: number,\n\t\tpatientId: string\n\t) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst MriImages: FC<Props> = (props) => {\n\tconst {\n\t\tpatientId,\n\t\tmriImageCoords,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tupdateMriAndHistologyImages,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\tconst computeMriImagesHandler = (\n\t\te: React.MouseEvent<Element, MouseEvent>,\n\t\tplane: string\n\t) => {\n\t\tif (showHiRes) setShowHiRes(false);\n\n\t\tconst tempShowHiRes = false; // avoid errors with application not catching up to latest state\n\n\t\tconst { mouseX, mouseY } = getMouseCoords(e, tempShowHiRes);\n\n\t\tconst mouseIsWithinBounds = determineMouseBoundariesMri(\n\t\t\tmouseX,\n\t\t\tmouseY,\n\t\t\tplane\n\t\t);\n\n\t\tif (!mouseIsWithinBounds) return;\n\n\t\tupdateMriAndHistologyImages(\n\t\t\tplane,\n\t\t\t+mriImageCoords![plane][\"slice\"],\n\t\t\tmouseX,\n\t\t\tmouseY,\n\t\t\tpatientId\n\t\t);\n\t};\n\n\tconst determineMouseBoundariesMri = (\n\t\tmouseX: number,\n\t\tmouseY: number,\n\t\tplane: string\n\t) => {\n\t\tif (mouseX < 0 || mouseY < 0) return false;\n\n\t\tif (plane === \"sagittal\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.sagittal.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.sagittal.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (plane === \"coronal\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.coronal.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.coronal.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (plane === \"axial\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.axial.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.axial.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tif (mriImageCoords == null) {\n\t\treturn <div> Could not find mri image coordinates</div>;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{/* too much repetition here, use map to loop through components? */}\n\t\t\t<MriImage\n\t\t\t\tplane=\"sagittal\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\n\t\t\t<MriImage\n\t\t\t\tplane=\"coronal\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\n\t\t\t<MriImage\n\t\t\t\tplane=\"axial\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\t\t</>\n\t);\n};\n\nexport default MriImages;\n","import { FC, SyntheticEvent } from \"react\";\n\ninterface Props {\n\thistologyImage: string;\n\tupdateHistologyCoordsHandler: (e: SyntheticEvent | Event) => void;\n\tonImageLoad: (e: SyntheticEvent) => void;\n}\n\nconst HistologyLowResImage: FC<Props> = (props) => {\n\tconst { histologyImage, updateHistologyCoordsHandler, onImageLoad } = props;\n\n\treturn (\n\t\t<img\n\t\t\tonClick={(e) => {\n\t\t\t\tupdateHistologyCoordsHandler(e);\n\t\t\t}}\n\t\t\tclassName=\"histology-img\"\n\t\t\tsrc={histologyImage}\n\t\t\talt=\"histology\"\n\t\t\tonLoad={(e) => onImageLoad(e)}\n\t\t></img>\n\t);\n};\n\nexport default HistologyLowResImage;\n","import { FC } from \"react\";\n\ninterface Props {\n\tlabelsImage: string;\n\tlabelsTransparency: string;\n}\n\nconst HistologyLabelsImage: FC<Props> = (props) => {\n\tconst { labelsImage, labelsTransparency } = props;\n\n\treturn (\n\t\t<img\n\t\t\tclassName=\"histology-img-labels\"\n\t\t\tsrc={labelsImage}\n\t\t\talt=\"histology-labels\"\n\t\t\t//onLoad={(e) => onImageLoad(e, \"lowRes\")}\n\t\t\tstyle={{ opacity: `${labelsTransparency}` }}\n\t\t></img>\n\t);\n};\n\nexport default HistologyLabelsImage;\n","import { FC, SyntheticEvent } from \"react\";\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\n\nimport MousePointer from \"../../shared/MousePointer\";\n\ninterface Props {\n\thistologyImage: string;\n\tlabelsImage: string;\n\tlabelsTransparency: string;\n\tshowHiRes: boolean;\n\tshowLabels: boolean;\n\tupdateHistologyCoordsHandler: (e: SyntheticEvent | Event) => void;\n\tonImageLoad: (e: SyntheticEvent) => void;\n\tscaledHistologyMouseCoords: {\n\t\t[key: string]: number;\n\t} | null;\n}\n\n// to allow the zooming feature, the hi-res image needs access to both the mouse pointer and labels image\nconst HistologyHiResImage: FC<Props> = (props) => {\n\tconst {\n\t\thistologyImage,\n\t\tlabelsImage,\n\t\tlabelsTransparency,\n\t\tshowHiRes,\n\t\tshowLabels,\n\t\tupdateHistologyCoordsHandler,\n\t\tonImageLoad,\n\t\tscaledHistologyMouseCoords,\n\t} = props;\n\n\tconst onPan = (ref: any, e: Event) => {\n\t\tupdateHistologyCoordsHandler(e);\n\t};\n\n\treturn (\n\t\t<TransformWrapper\n\t\t\twheel={{ disabled: false }}\n\t\t\tpanning={{ velocityDisabled: true }}\n\t\t\tlimitToBounds={true}\n\t\t\tonPanningStart={onPan}\n\t\t\tmaxScale={12}\n\t\t>\n\t\t\t{({ zoomIn, zoomOut, resetTransform, ...rest }) => (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"tools\">\n\t\t\t\t\t\t<button onClick={() => zoomIn()}>+</button>\n\t\t\t\t\t\t<button onClick={() => zoomOut()}>-</button>\n\t\t\t\t\t\t<button onClick={() => resetTransform()}>x</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<TransformComponent>\n\t\t\t\t\t\t{scaledHistologyMouseCoords && (\n\t\t\t\t\t\t\t<MousePointer\n\t\t\t\t\t\t\t\tmouseY={scaledHistologyMouseCoords.mouseY}\n\t\t\t\t\t\t\t\tmouseX={scaledHistologyMouseCoords.mouseX}\n\t\t\t\t\t\t\t\tshowHiRes={true}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{showLabels && (\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName=\"histology-img-labels\"\n\t\t\t\t\t\t\t\tsrc={labelsImage}\n\t\t\t\t\t\t\t\talt=\"histology-labels\"\n\t\t\t\t\t\t\t\tstyle={{ opacity: `${labelsTransparency}` }}\n\t\t\t\t\t\t\t></img>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclassName={`histology-img ${showHiRes && \"hi-res\"}`}\n\t\t\t\t\t\t\tsrc={histologyImage}\n\t\t\t\t\t\t\talt=\"histology\"\n\t\t\t\t\t\t\tonLoad={(e) => onImageLoad(e)}\n\t\t\t\t\t\t></img>\n\t\t\t\t\t</TransformComponent>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</TransformWrapper>\n\t);\n};\n\nexport default HistologyHiResImage;\n","import { FC, useState, useEffect, SyntheticEvent } from \"react\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport MousePointer from \"../../shared/MousePointer\";\nimport getMouseCoords from \"../../utils/getMouseCoords\";\nimport HistologyLowResImage from \"./HistologyLowResImage\";\nimport HistologyLabelsImage from \"./HistologyLabelsImage\";\nimport HistologyHiResImage from \"./HistologyHiResImage\";\n\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\n\nimport \"./HistologyImages.css\";\n\ninterface Props {\n\tpatientId: string;\n\thistologyImageCoords: HistologyCoords | null;\n\tshowHiRes: boolean;\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tchannel: string;\n\thistologyToMri: (mouseX: number, mouseY: number) => void;\n}\n\nconst HistologyImages: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [histologyImage, setHistologyImage] = useState(\"\");\n\tconst [labelsImage, setLabelsImage] = useState(\"\");\n\tconst [imageDimensions, setImageDimensions] = useState<{\n\t\t[key: string]: number;\n\t} | null>(null);\n\tconst [scaledHistologyMouseCoords, setScaledHistologyMouseCoords] = useState<{\n\t\t[key: string]: number;\n\t} | null>(null);\n\n\tconst {\n\t\tpatientId,\n\t\thistologyImageCoords,\n\t\tshowHiRes,\n\t\tshowLabels,\n\t\tlabelsTransparency,\n\t\tchannel,\n\t\thistologyToMri,\n\t} = props;\n\n\tuseEffect(() => {\n\t\tconst fetchHistologyImage = async () => {\n\t\t\t// determine the correct histology image based on computed coordinates\n\t\t\tif (histologyImageCoords !== null && histologyImageCoords !== undefined) {\n\t\t\t\tconst paddedBlock = histologyImageCoords[\"currentHistologyBlock\"]\n\t\t\t\t\t.toString()\n\t\t\t\t\t.padStart(2, \"0\");\n\n\t\t\t\tconst histologySlice = histologyImageCoords[\"currentHistologySlice\"];\n\t\t\t\tconst paddedSlice = histologySlice.toString().padStart(2, \"0\");\n\n\t\t\t\tconst histologyFolder = showHiRes ? \"histology_hr\" : \"histology\";\n\t\t\t\tconst histologyFileExtension = showHiRes ? \"webp\" : \"jpg\";\n\t\t\t\tconst labelsFileExtension = showHiRes ? \"webp\" : \"png\";\n\n\t\t\t\ttry {\n\t\t\t\t\tsetIsLoading(true);\n\n\t\t\t\t\tconst histologyImageUrl = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_${channel}/slice_${paddedSlice}.${histologyFileExtension}`;\n\t\t\t\t\tconst labelsImageUrl = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_labels/slice_${paddedSlice}.${labelsFileExtension}`;\n\n\t\t\t\t\tconst histologyImageResponse = await fetch(histologyImageUrl);\n\t\t\t\t\tif (histologyImageResponse.ok) {\n\t\t\t\t\t\tconst histologyImageBlob = await histologyImageResponse.blob();\n\t\t\t\t\t\tconst histologyImageObjectURL =\n\t\t\t\t\t\t\tURL.createObjectURL(histologyImageBlob);\n\n\t\t\t\t\t\tsetHistologyImage(histologyImageObjectURL);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst labelsImageResponse = await fetch(labelsImageUrl);\n\t\t\t\t\tif (labelsImageResponse.ok) {\n\t\t\t\t\t\tconst labelsImageBlob = await labelsImageResponse.blob();\n\t\t\t\t\t\tconst labelsImageObjectURL = URL.createObjectURL(labelsImageBlob);\n\n\t\t\t\t\t\tsetLabelsImage(labelsImageObjectURL);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tsetError(\"Error, could not load histology image\");\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t};\n\n\t\tfetchHistologyImage();\n\t}, [histologyImageCoords, showHiRes, channel, patientId]);\n\n\t// take the current histology coords and calculate scaled mouseX and mouseY\n\t// this is to account for the fact that we scale the histology image with css using the max-height property\n\tuseEffect(() => {\n\t\tif (imageDimensions !== null) {\n\t\t\tlet currentHistologyMouseX = !showHiRes\n\t\t\t\t? histologyImageCoords!.coordsLowRes.mouseX\n\t\t\t\t: histologyImageCoords!.coordsHiRes.mouseX;\n\n\t\t\tlet currentHistologyMouseY = !showHiRes\n\t\t\t\t? histologyImageCoords!.coordsLowRes.mouseY\n\t\t\t\t: histologyImageCoords!.coordsHiRes.mouseY;\n\n\t\t\tconst { scaledHistologyMouseX, scaledHistologyMouseY } =\n\t\t\t\tcalculateScaledHistologyMousePos(\n\t\t\t\t\tcurrentHistologyMouseX,\n\t\t\t\t\tcurrentHistologyMouseY,\n\t\t\t\t\timageDimensions.naturalHeight,\n\t\t\t\t\timageDimensions.naturalWidth,\n\t\t\t\t\timageDimensions.scaledHeight,\n\t\t\t\t\timageDimensions.scaledWidth\n\t\t\t\t);\n\n\t\t\tsetScaledHistologyMouseCoords({\n\t\t\t\tmouseX: scaledHistologyMouseX,\n\t\t\t\tmouseY: scaledHistologyMouseY,\n\t\t\t});\n\t\t}\n\t}, [histologyImageCoords, imageDimensions, showHiRes]);\n\n\tconst calculateScaledHistologyMousePos = (\n\t\tnaturalCoordinateX: number,\n\t\tnaturalCoordinateY: number,\n\t\tnaturalHeight: number,\n\t\tnaturalWidth: number,\n\t\tscaledHeight: number,\n\t\tscaledWidth: number\n\t) => {\n\t\tconst scaledHistologyMouseX =\n\t\t\t(scaledWidth / naturalWidth) * naturalCoordinateX;\n\n\t\tconst scaledHistologyMouseY =\n\t\t\t(scaledHeight / naturalHeight) * naturalCoordinateY;\n\n\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\tconsole.log(\n\t\t\t\t`scaled coord x: ${scaledHistologyMouseX}, scaled coord y: ${scaledHistologyMouseY}`\n\t\t\t);\n\n\t\treturn { scaledHistologyMouseX, scaledHistologyMouseY };\n\t};\n\n\t// we need to store the image dimensions so that we can correctly calculate the mouse coordinates for scaled images\n\t// we store the image dimensions every time a new image gets loaded\n\tconst onImageLoad = (e: SyntheticEvent) => {\n\t\tsetIsLoading(false);\n\n\t\tconst { naturalHeight, naturalWidth, scaledHeight, scaledWidth } =\n\t\t\tgetImageDimensions(e);\n\n\t\tsetImageDimensions({\n\t\t\tnaturalHeight,\n\t\t\tnaturalWidth,\n\t\t\tscaledHeight,\n\t\t\tscaledWidth,\n\t\t});\n\t};\n\n\t// called when user clicks on a lowRes or hiRes histology image\n\tconst updateHistologyCoordsHandler = (e: SyntheticEvent | Event) => {\n\t\tconst { naturalCoordinateX, naturalCoordinateY } = getHistologyMousePos(e);\n\n\t\t// update the atlas based on new histology coords\n\t\thistologyToMri(naturalCoordinateX, naturalCoordinateY);\n\t};\n\n\tconst getHistologyMousePos = (e: SyntheticEvent | Event) => {\n\t\tconst { mouseX, mouseY } = getMouseCoords(e, showHiRes);\n\n\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\tconsole.log(\"offsetX: \" + mouseX, \"offsetY: \" + mouseY);\n\n\t\tconst { naturalCoordinateX, naturalCoordinateY } =\n\t\t\tcalculateNaturalMouseCoordinates(mouseX, mouseY);\n\n\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\tconsole.log(\n\t\t\t\t\"naturalX: \" + naturalCoordinateX,\n\t\t\t\t\"naturalY: \" + naturalCoordinateY\n\t\t\t);\n\n\t\treturn { naturalCoordinateX, naturalCoordinateY };\n\t};\n\n\tconst getImageDimensions = (e: any) => {\n\t\tconst naturalWidth = e.target.naturalWidth; // the original size of the image\n\t\tconst naturalHeight = e.target.naturalHeight;\n\t\tconst scaledWidth = e.target.width; // the scaled size of the image\n\t\tconst scaledHeight = e.target.height;\n\n\t\treturn {\n\t\t\tnaturalHeight,\n\t\t\tnaturalWidth,\n\t\t\tscaledHeight,\n\t\t\tscaledWidth,\n\t\t};\n\t};\n\n\t// this function allows us to extract the natural x an y mouse coordinates\n\t// accounts for the fact that we set max-height css property on the histology image\n\tconst calculateNaturalMouseCoordinates = (\n\t\toffsetX: number,\n\t\toffsetY: number\n\t) => {\n\t\tconst naturalCoordinateX =\n\t\t\t(imageDimensions!.naturalWidth / imageDimensions!.scaledWidth) * offsetX;\n\n\t\tconst naturalCoordinateY =\n\t\t\t(imageDimensions!.naturalHeight / imageDimensions!.scaledHeight) *\n\t\t\toffsetY;\n\n\t\treturn {\n\t\t\tnaturalCoordinateX: naturalCoordinateX,\n\t\t\tnaturalCoordinateY: naturalCoordinateY,\n\t\t};\n\t};\n\n\tif (histologyImageCoords == null) {\n\t\treturn <div>Could not find histology image coords</div>;\n\t}\n\n\tif (histologyImage == null || histologyImage === \"\") {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<LoadingSpinner asOverlay={false} message={\"Loading...\"} />\n\t\t\t\t)}\n\t\t\t\t{!isLoading && <div>Failed to load histology image</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\tif (labelsImage == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<LoadingSpinner asOverlay={false} message={\"Loading...\"} />\n\t\t\t\t)}\n\t\t\t\t{!isLoading && <div>Failed to load labels</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"histology-container\">\n\t\t\t\t<div className=\"histology-orientation-text\">\n\t\t\t\t\tOrientation: {histologyImageCoords.currentHistologyOrientation}\n\t\t\t\t</div>\n\n\t\t\t\t<div className={`histology-img-container`}>\n\t\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t\t{isLoading && <LoadingSpinner asOverlay message={\"Loading...\"} />}\n\n\t\t\t\t\t{!showHiRes && scaledHistologyMouseCoords && (\n\t\t\t\t\t\t<MousePointer\n\t\t\t\t\t\t\tmouseY={scaledHistologyMouseCoords.mouseY}\n\t\t\t\t\t\t\tmouseX={scaledHistologyMouseCoords.mouseX}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{!showHiRes && showLabels && (\n\t\t\t\t\t\t<HistologyLabelsImage\n\t\t\t\t\t\t\tlabelsImage={labelsImage}\n\t\t\t\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{!showHiRes && (\n\t\t\t\t\t\t<HistologyLowResImage\n\t\t\t\t\t\t\thistologyImage={histologyImage}\n\t\t\t\t\t\t\tupdateHistologyCoordsHandler={updateHistologyCoordsHandler}\n\t\t\t\t\t\t\tonImageLoad={onImageLoad}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{showHiRes && (\n\t\t\t\t\t\t<HistologyHiResImage\n\t\t\t\t\t\t\thistologyImage={histologyImage}\n\t\t\t\t\t\t\tlabelsImage={labelsImage}\n\t\t\t\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\t\t\t\tshowLabels={showLabels}\n\t\t\t\t\t\t\tupdateHistologyCoordsHandler={updateHistologyCoordsHandler}\n\t\t\t\t\t\t\tonImageLoad={onImageLoad}\n\t\t\t\t\t\t\tscaledHistologyMouseCoords={scaledHistologyMouseCoords}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default HistologyImages;\n","import { FC, useEffect, useState, useRef } from \"react\";\n\nimport getMouseCoords from \"../../utils/getMouseCoords\";\n\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./HistologyScrollbar.css\";\n\ninterface Props {\n\thistologyImageCoords: HistologyCoords | null;\n\tadjustHistologyCoordsFromScrollbar: (newSliceNumber: number) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst HistologyScrollbar: FC<Props> = (props) => {\n\tconst scrollbarRef = useRef<HTMLDivElement>(null);\n\tconst [scrollbarPos, setScrollbarPos] = useState(0);\n\n\tconst {\n\t\thistologyImageCoords,\n\t\tadjustHistologyCoordsFromScrollbar,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\tconst currentBlock = histologyImageCoords!.currentHistologyBlock;\n\n\tconst currentHistologySliceNumber =\n\t\thistologyImageCoords!.currentHistologySlice;\n\n\tconst slicesInBlock =\n\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock][\n\t\t\t\"slices\"\n\t\t] - 1; // -1 because slices start at 0\n\n\t// determine the scrollbar position for the current histology slice\n\tuseEffect(() => {\n\t\tconst scrollbarLength = scrollbarRef.current!.clientHeight;\n\n\t\tconst currentSliceAsProportion =\n\t\t\tcurrentHistologySliceNumber / slicesInBlock;\n\n\t\tconst newHistologyScrollbarPos = +(\n\t\t\tscrollbarLength * currentSliceAsProportion\n\t\t).toFixed(0);\n\n\t\tsetScrollbarPos(newHistologyScrollbarPos);\n\t}, [\n\t\thistologyImageCoords,\n\t\tatlasImagesDimensionsKey,\n\t\tcurrentHistologySliceNumber,\n\t\tslicesInBlock,\n\t]);\n\n\tconst updateHistologyScrollbarPos = (e: React.MouseEvent) => {\n\t\tconst mouseY = e.nativeEvent.offsetY;\n\n\t\tconst scrollbarLength = scrollbarRef.current!.clientHeight;\n\n\t\t// method for positioning the scrollbar based on the max number of slices in a histology block\n\t\tconst newHistologySliceNumber = (mouseY / scrollbarLength) * slicesInBlock;\n\n\t\tconst scrollbarIsWithinBounds = checkScrollbarBoundaries(\n\t\t\tnewHistologySliceNumber\n\t\t);\n\n\t\tif (!scrollbarIsWithinBounds) {\n\t\t\tconsole.log(\"cannot increment histology slice\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tadjustHistologyCoordsFromScrollbar(newHistologySliceNumber);\n\t\t} catch {\n\t\t\tconsole.log(\"error found when adjusting histology scrollbar\");\n\t\t}\n\t};\n\n\tconst incrementHistologyScrollbarPos = (increment: number) => {\n\t\tconst newHistologySliceNumber = currentHistologySliceNumber + increment;\n\n\t\tconst scrollbarIsWithinBounds = checkScrollbarBoundaries(\n\t\t\tnewHistologySliceNumber\n\t\t);\n\n\t\tif (!scrollbarIsWithinBounds) {\n\t\t\tconsole.log(\"cannot increment histology slice\");\n\t\t\treturn;\n\t\t}\n\n\t\tadjustHistologyCoordsFromScrollbar(newHistologySliceNumber);\n\t};\n\n\tconst checkScrollbarBoundaries = (newHistologySliceNumber: number) => {\n\t\tif (\n\t\t\tnewHistologySliceNumber < 0 ||\n\t\t\tnewHistologySliceNumber > slicesInBlock\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\treturn (\n\t\t<div className=\"histology-scrollbar-container\">\n\t\t\t<div\n\t\t\t\tclassName=\"histology-scrollbar-increment-btn up\"\n\t\t\t\tonClick={() => incrementHistologyScrollbarPos(-1)}\n\t\t\t></div>\n\n\t\t\t<div\n\t\t\t\tclassName=\"scrollbar histology-scrollbar\"\n\t\t\t\tonClick={(e) => updateHistologyScrollbarPos(e)}\n\t\t\t\tref={scrollbarRef}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\tclassName=\"histology-scrollbar-widget\"\n\t\t\t\t\tstyle={{ top: `${scrollbarPos}px` }}\n\t\t\t\t></svg>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclassName=\"histology-scrollbar-increment-btn down\"\n\t\t\t\tonClick={() => incrementHistologyScrollbarPos(1)}\n\t\t\t></div>\n\t\t</div>\n\t);\n};\n\nexport default HistologyScrollbar;\n","import { FC } from \"react\";\n\nimport HistologyScrollbar from \"./HistologyScrollbar\";\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./Scrollbars.css\";\n\ninterface Props {\n\thistologyImageCoords: HistologyCoords | null;\n\tadjustHistologyCoordsFromScrollbar: (newSliceNumber: number) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst Scrollbars: FC<Props> = (props) => {\n\tconst {\n\t\thistologyImageCoords,\n\t\tadjustHistologyCoordsFromScrollbar,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\treturn (\n\t\t<HistologyScrollbar\n\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\tadjustHistologyCoordsFromScrollbar={adjustHistologyCoordsFromScrollbar}\n\t\t\tshowHiRes={showHiRes}\n\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t/>\n\t);\n};\n\nexport default Scrollbars;\n","import { FC, useState, useEffect } from \"react\";\n\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport calculateMriImageCoords from \"../../utils/calculateMriImageCoords\";\nimport calculateHistologyImageCoords from \"../../utils/calculateHistologyImageCoords\";\nimport calculateAdjustedMriCoords from \"../../utils/calculateAdjustedMriCoords\";\nimport logMriCoordsForDebugging from \"../../utils/logMriCoordsForDebugging\";\nimport matrixMultiplier from \"../../utils/matrixMultiplier\";\nimport histologyLabelParser from \"../../utils/histologyLabelParser\";\nimport getMatrix from \"../../utils/getMatrix\";\nimport convertHistologyMouseCoords from \"../../utils/convertHistologyMouseCoords\";\n\nimport MriImages from \"./MriImages\";\nimport HistologyImages from \"./HistologyImages\";\nimport Scrollbars from \"../scrollbars/Scrollbars\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\nimport { MriCoords } from \"../../../models/mriCoords.model\";\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./AtlasImages.css\";\n\ninterface Props {\n\tpatientId: string;\n\tchannel: string;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tsetCurrentLabel: (currentLabel: CurrentLabel | null) => void;\n\tnavPanelCoords: NavPanelCoords | null;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst AtlasImages: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [mriImageCoords, setMriImageCoords] = useState<MriCoords | null>(null);\n\tconst [histologyImageCoords, setHistologyImageCoords] =\n\t\tuseState<HistologyCoords | null>(null);\n\n\tconst {\n\t\tpatientId,\n\t\tchannel,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tshowLabels,\n\t\tlabelsTransparency,\n\t\tsetCurrentLabel,\n\t\tnavPanelCoords,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\t// initialize atlas images based on an arbitrary starting point\n\tuseEffect(() => {\n\t\tconst updateAtlas = async () => {\n\t\t\tsetIsLoading(true);\n\n\t\t\ttry {\n\t\t\t\t// args: plane, slice, currentMriMouseX, currentMriMouseY\n\t\t\t\t// I should pass the argument as an object to make it more clear\n\t\t\t\tupdateMriAndHistologyImages(\"axial\", 124, 149, 357, patientId);\n\t\t\t} catch {\n\t\t\t\tsetError(\"error building atlas\");\n\t\t\t}\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tupdateAtlas();\n\t}, [patientId]);\n\n\t// sets the current label every time new coords are detected\n\tuseEffect(() => {\n\t\tconst setCurrentLabelHandler = async () => {\n\t\t\t// loading spinner shows while the label is loading\n\t\t\tsetCurrentLabel(null);\n\n\t\t\tconst currentLabel = await histologyLabelParser(\n\t\t\t\thistologyImageCoords!,\n\t\t\t\tshowHiRes,\n\t\t\t\tpatientId\n\t\t\t);\n\n\t\t\tsetCurrentLabel(currentLabel);\n\t\t};\n\n\t\tif (histologyImageCoords != null && mriImageCoords != null) {\n\t\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\t\tconsole.log(histologyImageCoords);\n\t\t\tsetCurrentLabelHandler();\n\t\t}\n\t}, [\n\t\thistologyImageCoords,\n\t\tmriImageCoords,\n\t\tshowHiRes,\n\t\tsetCurrentLabel,\n\t\tpatientId,\n\t]);\n\n\t// sets the mri and histology coords when navigating from the drop-down list\n\tuseEffect(() => {\n\t\tif (navPanelCoords != null) {\n\t\t\tconst resultX = navPanelCoords.resultX;\n\t\t\tconst resultY = navPanelCoords.resultY;\n\t\t\tconst resultZ = navPanelCoords.resultZ;\n\n\t\t\tupdateMriAndHistologyImages(\n\t\t\t\t\"axial\",\n\t\t\t\t+resultZ.toFixed(0),\n\t\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t\t+resultX.toFixed(0),\n\t\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t\t+resultY.toFixed(0),\n\t\t\t\tpatientId\n\t\t\t);\n\t\t}\n\t}, [navPanelCoords, atlasImagesDimensionsKey, patientId]);\n\n\tconst updateMriAndHistologyImages = async (\n\t\tcurrentMriPlane: string,\n\t\tcurrentMriSlice: number,\n\t\tcurrentMriMouseX: number,\n\t\tcurrentMriMouseY: number,\n\t\tpatientId: string\n\t) => {\n\t\t// user is navigating within an mri image\n\t\t// function updates mri image coords and then calculates new histology coords\n\n\t\tconst currentMriCoords = updateMriImagesHandler(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriSlice,\n\t\t\tcurrentMriMouseX,\n\t\t\tcurrentMriMouseY\n\t\t);\n\n\t\tupdateHistologyImagesHandler(currentMriPlane, currentMriCoords!, patientId);\n\t};\n\n\tconst histologyToMri = async (\n\t\tcurrentHistologyMouseX: number,\n\t\tcurrentHistologyMouseY: number\n\t) => {\n\t\t// first we calculate new mri coords based on the current histology coords\n\t\t// then below we set the current histology coords based on the mouseX and mouseY positions\n\t\t// currentHistologyMouseX and Y represent the natural mouse x and y\n\n\t\tconst histologyFolder = showHiRes ? \"histology_hr\" : \"histology\";\n\n\t\tconst matrix = await getMatrix(\n\t\t\thistologyImageCoords!.currentHistologyBlock,\n\t\t\thistologyFolder,\n\t\t\tpatientId\n\t\t);\n\n\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\tcurrentHistologyMouseY,\n\t\t\tcurrentHistologyMouseX,\n\t\t\thistologyImageCoords!.currentHistologySlice,\n\t\t\t1,\n\t\t]);\n\n\t\tconst { resultX, resultY, resultZ } = singleMriCoord;\n\n\t\tupdateMriImagesHandler(\n\t\t\t\"axial\",\n\t\t\t+resultZ.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t+resultX.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t+resultY.toFixed(0)\n\t\t);\n\n\t\t// calculate new histology coords\n\t\tconst newHistologyCoords = { ...histologyImageCoords };\n\n\t\tconst currentHistologyBlock = histologyImageCoords!.currentHistologyBlock;\n\n\t\t// we need to calculate the coords for both hi and low res\n\t\t// when scaling between hi and low res, the result seems to be always about 10px off, why?\n\t\tif (showHiRes) {\n\t\t\t// calculate low-res mouse position from current hi-res mouse coord\n\t\t\tconst { lowResMouseX, lowResMouseY } = convertHistologyMouseCoords(\n\t\t\t\tatlasImagesDimensionsKey,\n\t\t\t\tcurrentHistologyMouseX,\n\t\t\t\tcurrentHistologyMouseY,\n\t\t\t\tcurrentHistologyBlock,\n\t\t\t\tshowHiRes\n\t\t\t);\n\n\t\t\tif (lowResMouseX === -1 && lowResMouseY === -1)\n\t\t\t\tsetError(\n\t\t\t\t\t\"something went wrong, histology mouse coordinates returned -1\"\n\t\t\t\t);\n\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseX = currentHistologyMouseX;\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseY = currentHistologyMouseY;\n\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseX = +lowResMouseX!;\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseY = +lowResMouseY!;\n\t\t} else {\n\t\t\t// calculate hi-res mouse position from current low-res mouse coord\n\t\t\tconst { hiResMouseX, hiResMouseY } = convertHistologyMouseCoords(\n\t\t\t\tatlasImagesDimensionsKey,\n\t\t\t\tcurrentHistologyMouseX,\n\t\t\t\tcurrentHistologyMouseY,\n\t\t\t\tcurrentHistologyBlock,\n\t\t\t\tshowHiRes\n\t\t\t);\n\n\t\t\tif (hiResMouseX === -1 && hiResMouseY === -1)\n\t\t\t\tsetError(\n\t\t\t\t\t\"something went wrong, histology mouse coordinates returned -1\"\n\t\t\t\t);\n\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseX = +hiResMouseX!;\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseY = +hiResMouseY!;\n\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseX = currentHistologyMouseX;\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseY = currentHistologyMouseY;\n\t\t}\n\n\t\tsetHistologyImageCoords(newHistologyCoords as HistologyCoords);\n\t};\n\n\tconst adjustHistologyCoordsFromScrollbar = async (newSliceNumber: number) => {\n\t\tconst matrix = await getMatrix(\n\t\t\thistologyImageCoords!.currentHistologyBlock,\n\t\t\t\"histology\",\n\t\t\tpatientId\n\t\t);\n\n\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\thistologyImageCoords!.coordsLowRes.mouseY,\n\t\t\thistologyImageCoords!.coordsLowRes.mouseX,\n\t\t\t+newSliceNumber.toFixed(0),\n\t\t\t1,\n\t\t]);\n\n\t\tconst { resultX, resultY, resultZ } = singleMriCoord;\n\n\t\tupdateMriImagesHandler(\n\t\t\t\"axial\",\n\t\t\t+resultZ.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t+resultX.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t+resultY.toFixed(0)\n\t\t);\n\n\t\tconst newHistologyCoords = { ...histologyImageCoords };\n\t\tnewHistologyCoords.currentHistologySlice = +newSliceNumber.toFixed(0);\n\n\t\tsetHistologyImageCoords(newHistologyCoords as HistologyCoords);\n\t};\n\n\tconst updateMriImagesHandler = (\n\t\tcurrentMriPlane: string,\n\t\tcurrentMriSlice: number,\n\t\tcurrentMriMouseX: number,\n\t\tcurrentMriMouseY: number\n\t) => {\n\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\tconsole.log(\"BUILDING MRI IMAGES\");\n\n\t\tconst { adjustedMriSlice, adjustedMriMouseX, adjustedMriMouseY } =\n\t\t\tcalculateAdjustedMriCoords(\n\t\t\t\tcurrentMriPlane,\n\t\t\t\tcurrentMriSlice,\n\t\t\t\tcurrentMriMouseX,\n\t\t\t\tcurrentMriMouseY,\n\t\t\t\tatlasImagesDimensionsKey\n\t\t\t);\n\n\t\tprocess.env.NODE_ENV === \"development\" &&\n\t\t\tlogMriCoordsForDebugging(\n\t\t\t\tcurrentMriPlane,\n\t\t\t\tcurrentMriSlice,\n\t\t\t\tcurrentMriMouseX,\n\t\t\t\tcurrentMriMouseY,\n\t\t\t\tadjustedMriSlice!,\n\t\t\t\tadjustedMriMouseX!,\n\t\t\t\tadjustedMriMouseY!\n\t\t\t);\n\n\t\tconst newMriCoords = calculateMriImageCoords(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriSlice,\n\t\t\tcurrentMriMouseX,\n\t\t\tcurrentMriMouseY,\n\t\t\tadjustedMriSlice!,\n\t\t\tadjustedMriMouseX!,\n\t\t\tadjustedMriMouseY!\n\t\t);\n\n\t\tsetMriImageCoords(newMriCoords!); // refactor this to check that the mriImage is valid\n\n\t\treturn newMriCoords;\n\t};\n\n\tconst updateHistologyImagesHandler = async (\n\t\tcurrentMriPlane: string,\n\t\tcurrentMriCoords: MriCoords,\n\t\tpatientId: string\n\t) => {\n\t\tconst newHistologyCoords = await calculateHistologyImageCoords(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriCoords!,\n\t\t\tpatientId,\n\t\t\tatlasImagesDimensionsKey\n\t\t);\n\n\t\tif (newHistologyCoords === \"no block found\") {\n\t\t\tsetError(\"No block found for this coordinate\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (newHistologyCoords === \"no matrix found\") {\n\t\t\tsetError(\"No matrix found for this coordinate\");\n\t\t\treturn;\n\t\t}\n\n\t\tsetHistologyImageCoords(newHistologyCoords);\n\t};\n\n\tif (mriImageCoords == null || histologyImageCoords == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay message={\"Loading...\"} />}\n\t\t\t\t<div>Builing atlas, please wait...</div>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"atlas-imgs-container\">\n\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t{isLoading && <LoadingSpinner asOverlay message={\"Loading...\"} />}\n\n\t\t\t<MriImages\n\t\t\t\tpatientId={patientId}\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tupdateMriAndHistologyImages={updateMriAndHistologyImages}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\n\t\t\t<HistologyImages\n\t\t\t\tpatientId={patientId}\n\t\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\t\tchannel={channel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\thistologyToMri={histologyToMri}\n\t\t\t/>\n\n\t\t\t<Scrollbars\n\t\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\t\tadjustHistologyCoordsFromScrollbar={adjustHistologyCoordsFromScrollbar}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default AtlasImages;\n","import { FC } from \"react\";\n\nimport \"./PatientSelect.css\";\n\ninterface Props {\n\tpatientId: string;\n\tsetPatientId: (patientId: string) => void;\n\tsetInitializeAtlas: (initializeAtlas: boolean) => void;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tsetShowLabels: (showLabels: boolean) => void;\n\tsetChannel: (channel: string) => void;\n}\n\nconst PatientSelect: FC<Props> = (props) => {\n\tconst {\n\t\tpatientId,\n\t\tsetPatientId,\n\t\tsetInitializeAtlas,\n\t\tsetShowHiRes,\n\t\tsetShowLabels,\n\t\tsetChannel,\n\t} = props;\n\n\tconst setPatientIdHandler = (e: React.ChangeEvent<HTMLSelectElement>) => {\n\t\tsetShowHiRes(false);\n\t\tsetShowLabels(false);\n\t\tsetChannel(\"LFB\");\n\t\tsetInitializeAtlas(true); // causes entire application to re-render, prevents memory leaks in unmounted components\n\n\t\tsetPatientId(e.target.value);\n\t};\n\n\treturn (\n\t\t<div className=\"patient-select-container\">\n\t\t\tSelect Case:\n\t\t\t<select\n\t\t\t\tname=\"patient-select\"\n\t\t\t\tid=\"patient-select\"\n\t\t\t\tclassName=\"patient-select-picker\"\n\t\t\t\tvalue={patientId}\n\t\t\t\tonChange={(e) => setPatientIdHandler(e)}\n\t\t\t>\n\t\t\t\t<option value=\"NextBrain-Case-1/main/P57-16\">Case-1</option>\n\t\t\t\t<option value=\"NextBrain-Case-2/main/P41-16\">Case-2</option>\n\t\t\t\t<option value=\"NextBrain-Case-3/main/P58-16\">Case-3</option>\n\t\t\t\t<option value=\"NextBrain-Case-4/main/P85-18\">Case-4</option>\n\t\t\t\t<option value=\"NextBrain-Case-5/main/EX9-19\">Case-5</option>\n\t\t\t</select>\n\t\t</div>\n\t);\n};\n\nexport default PatientSelect;\n","import { FC, memo, useEffect, useState } from \"react\";\nimport DropdownTreeSelect from \"react-dropdown-tree-select\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\n\nimport getMatrix from \"../../utils/getMatrix\";\nimport matrixMultiplier from \"../../utils/matrixMultiplier\";\n\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\nimport { AtlasNavigationData } from \"../../../models/atlasNavigationData.model\";\n\nimport \"react-dropdown-tree-select/dist/styles.css\";\nimport \"./AtlasNavigation.css\";\n\ninterface Props {\n\tpatientId: string;\n\tsetNavPanelCoords: (navPanelCoords: NavPanelCoords) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n}\n\nconst AtlasNavigation: FC<Props> = (props) => {\n\tconst [atlasNavigationData, setAtlasNavigationData] =\n\t\tuseState<AtlasNavigationData | null>(null);\n\n\tconst { patientId, setNavPanelCoords, showHiRes, setShowHiRes } = props;\n\n\tuseEffect(() => {\n\t\tconst getAtlasNavigationData = async () => {\n\t\t\tconst dataUrl = `${ASSETS_URL}${patientId}/image_ontology_hierarchical.json`;\n\n\t\t\tconst file = await fetch(dataUrl);\n\n\t\t\tconst parsedFile = await file.json();\n\n\t\t\tprocess.env.NODE_ENV === \"development\" && console.log(parsedFile);\n\n\t\t\tsetAtlasNavigationData(parsedFile);\n\t\t};\n\n\t\tgetAtlasNavigationData();\n\t}, [patientId]);\n\n\tconst onChange = (currentNode: any, selectedNodes: any) => {\n\t\tif (showHiRes) setShowHiRes(false);\n\n\t\tconst currentNodeData = currentNode.data;\n\n\t\tif (currentNodeData === undefined) {\n\t\t\tconsole.log(\"navigation coords could not be found\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tupdateNavPanelCoordsHandler(currentNodeData);\n\t\t} catch {\n\t\t\tconsole.log(\"error, no valid navigation coords returned\");\n\t\t}\n\t};\n\n\tconst updateNavPanelCoordsHandler = async (\n\t\tnavPanelCoords: NavPanelCoords\n\t) => {\n\t\tconst matrix = await getMatrix(\n\t\t\tnavPanelCoords!.blockNumber,\n\t\t\t\"histology\",\n\t\t\tpatientId\n\t\t);\n\n\t\t// why is the order of params here different compared to the function that handles physical clicks?\n\t\t// the x and y are swapped here compared to the histologyToMri function\n\t\t// there must be some sort of flipping of axes somewhere\n\t\t// regardless, the app seems to work with this configuration\n\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\tnavPanelCoords!.xh,\n\t\t\tnavPanelCoords!.yh,\n\t\t\tnavPanelCoords!.zh,\n\t\t\t1,\n\t\t]);\n\n\t\tsetNavPanelCoords(singleMriCoord);\n\t};\n\n\tif (atlasNavigationData == null) {\n\t\treturn <div>Could not find navigation data</div>;\n\t}\n\n\treturn (\n\t\t<DropdownTreeSelect\n\t\t\tclassName=\"atlas-navigation\"\n\t\t\tdata={atlasNavigationData}\n\t\t\tonChange={onChange}\n\t\t\tkeepTreeOnSearch\n\t\t\tkeepOpenOnSelect\n\t\t\tmode=\"radioSelect\"\n\t\t\tinlineSearchInput\n\t\t\ttexts={{ placeholder: \"Navigate Atlas\" }}\n\t\t/>\n\t);\n};\n\nexport default memo(AtlasNavigation); // memo prevents unnecessary component re-rendering\n","import { FC } from \"react\";\n\nimport \"./ShowLabelsBtn.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tsetShowLabels: (showLabels: boolean) => void;\n}\n\nconst ShowLabelsBtn: FC<Props> = (props) => {\n\tconst { showLabels, setShowLabels } = props;\n\n\treturn (\n\t\t<button\n\t\t\tonClick={() => setShowLabels(!showLabels)}\n\t\t\tclassName={`show-labels-btn ${showLabels && \"hi-res-active\"}`}\n\t\t>\n\t\t\t{showLabels ? \"Hide\" : \"Show\"} labels\n\t\t</button>\n\t);\n};\n\nexport default ShowLabelsBtn;\n","import { FC } from \"react\";\n\nimport \"./TransparencySlider.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tsetLabelsTransparency: (labelsTransparency: string) => void;\n}\n\nconst TransparencySlider: FC<Props> = (props) => {\n\tconst { showLabels, labelsTransparency, setLabelsTransparency } = props;\n\n\tif (!showLabels) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"transparency-slider-container\">\n\t\t\t<span>Adjust label transparency</span>\n\t\t\t<input\n\t\t\t\ttype=\"range\"\n\t\t\t\tname=\"labels-transparency\"\n\t\t\t\tid=\"labels-transparency\"\n\t\t\t\tclassName=\"labels-transparency-slider\"\n\t\t\t\tvalue={labelsTransparency}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tsetLabelsTransparency(e.target.value);\n\t\t\t\t}}\n\t\t\t\tmin=\"0\"\n\t\t\t\tmax=\"1\"\n\t\t\t\tstep=\"0.01\"\n\t\t\t\tdisabled={showLabels ? false : true}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default TransparencySlider;\n","import { FC, useState, useEffect } from \"react\";\n\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\n\nimport \"./Label.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tcurrentLabel: CurrentLabel | null;\n}\n\nconst Label: FC<Props> = (props) => {\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst { showLabels, currentLabel } = props;\n\n\tuseEffect(() => {\n\t\t// show a loading spinner while the label is being fetched\n\t\tcurrentLabel === null ? setIsLoading(true) : setIsLoading(false);\n\t}, [currentLabel]);\n\n\tif (!showLabels) {\n\t\treturn null;\n\t}\n\n\tif (currentLabel === null) {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<LoadingSpinner asOverlay={false} message={\"Fetching label...\"} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (currentLabel === undefined) {\n\t\treturn <div>no label found</div>;\n\t}\n\n\treturn (\n\t\t<div className=\"label-container\">\n\t\t\t{currentLabel != null && (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"label-heading\">Current Label</div>\n\n\t\t\t\t\t<div className=\"label-name\">Label name: {currentLabel.labelName}</div>\n\n\t\t\t\t\t<div className=\"label-color-container\">\n\t\t\t\t\t\t<span> Label color: </span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclassName=\"label-color-box\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tbackgroundColor: `rgba(${currentLabel.r},\n\t\t\t\t\t\t\t\t${currentLabel.g},\n\t\t\t\t\t\t\t\t${currentLabel.b},\n\t\t\t\t\t\t\t\t100\n\t\t\t\t\t\t\t)`,\n\t\t\t\t\t\t\t\tmarginBottom: \"10px\",\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default Label;\n","import { FC } from \"react\";\n\nimport \"./ImageChannelSelect.css\";\n\ninterface Props {\n\tchannel: string;\n\tsetChannel: (channel: string) => void;\n}\n\nconst ImageChannelSelect: FC<Props> = (props) => {\n\tconst { channel, setChannel } = props;\n\n\treturn (\n\t\t<div className=\"image-channels-container\">\n\t\t\tSelect histological stain or MRI:\n\t\t\t<select\n\t\t\t\tname=\"channels\"\n\t\t\t\tid=\"channels\"\n\t\t\t\tclassName=\"image-channel-picker\"\n\t\t\t\tvalue={channel}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tsetChannel(e.target.value);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<option value=\"LFB\">LFB</option>\n\t\t\t\t<option value=\"HE\">HE</option>\n\t\t\t\t<option value=\"MRI\">MRI</option>\n\t\t\t</select>\n\t\t</div>\n\t);\n};\n\nexport default ImageChannelSelect;\n","import { FC } from \"react\";\n\nimport \"./ShowHiResBtn.css\";\n\ninterface Props {\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n}\n\nconst ShowHiResBtn: FC<Props> = (props) => {\n\tconst { showHiRes, setShowHiRes } = props;\n\n\treturn (\n\t\t<div className=\"hi-res-btn-container\">\n\t\t\t<button\n\t\t\t\tclassName={`hi-res btn ${showHiRes && \"hi-res-active\"}`}\n\t\t\t\tonClick={() => setShowHiRes(!showHiRes)}\n\t\t\t>\n\t\t\t\t{showHiRes ? \"Hide\" : \"Show\"} hi-res histology\n\t\t\t</button>\n\t\t</div>\n\t);\n};\n\nexport default ShowHiResBtn;\n","import { FC } from \"react\";\n\nimport PatientSelect from \"./PatientSelect\";\nimport AtlasNavigation from \"./AtlasNavigation\";\nimport ShowLabelsBtn from \"./ShowLabelsBtn\";\nimport TransparencySlider from \"./TransparencySlider\";\nimport Label from \"./Label\";\nimport ImageChannelSelect from \"./ImageChannelSelect\";\nimport ShowHiResBtn from \"./ShowHiResBtn\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\n\nimport \"./AtlasOptions.css\";\n\ninterface Props {\n\tpatientId: string;\n\tsetPatientId: (patientId: string) => void;\n\tchannel: string;\n\tsetChannel: (channel: string) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tshowLabels: boolean;\n\tsetShowLabels: (showLabels: boolean) => void;\n\tlabelsTransparency: string;\n\tsetLabelsTransparency: (labelsTransparency: string) => void;\n\tcurrentLabel: CurrentLabel | null;\n\tsetNavPanelCoords: (navPanelCoords: NavPanelCoords) => void;\n\tsetInitializeAtlas: (initializeAtlas: boolean) => void;\n}\n\nconst AtlasOptions: FC<Props> = (props) => {\n\tconst {\n\t\tpatientId,\n\t\tsetPatientId,\n\t\tchannel,\n\t\tsetChannel,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tshowLabels,\n\t\tsetShowLabels,\n\t\tlabelsTransparency,\n\t\tsetLabelsTransparency,\n\t\tcurrentLabel,\n\t\tsetNavPanelCoords,\n\t\tsetInitializeAtlas,\n\t} = props;\n\n\treturn (\n\t\t<div className=\"options-container\">\n\t\t\t<PatientSelect\n\t\t\t\tpatientId={patientId}\n\t\t\t\tsetPatientId={setPatientId}\n\t\t\t\tsetInitializeAtlas={setInitializeAtlas}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tsetShowLabels={setShowLabels}\n\t\t\t\tsetChannel={setChannel}\n\t\t\t/>\n\n\t\t\t<AtlasNavigation\n\t\t\t\tpatientId={patientId}\n\t\t\t\tsetNavPanelCoords={setNavPanelCoords}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t/>\n\n\t\t\t<ImageChannelSelect channel={channel} setChannel={setChannel} />\n\n\t\t\t<ShowLabelsBtn showLabels={showLabels} setShowLabels={setShowLabels} />\n\n\t\t\t<Label showLabels={showLabels} currentLabel={currentLabel} />\n\n\t\t\t<TransparencySlider\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetLabelsTransparency={setLabelsTransparency}\n\t\t\t/>\n\n\t\t\t<ShowHiResBtn showHiRes={showHiRes} setShowHiRes={setShowHiRes} />\n\t\t</div>\n\t);\n};\n\nexport default AtlasOptions;\n","import { FC, useState, useEffect, useCallback } from \"react\";\n\nimport LoadingSpinner from \"../components/shared/LoadingSpinner\";\nimport { ASSETS_URL } from \"../components/utils/ASSETS_URL\";\nimport AtlasImages from \"../components/atlas/atlasImages/AtlasImages\";\nimport AtlasOptions from \"../components/atlas/atlasOptions/AtlasOptions\";\n//import Scrollbars from \"../components/atlas/scrollbars/Scrollbars\";\n\nimport { CurrentLabel } from \"../models/label.model\";\nimport { AtlasImagesDimensionsKey } from \"../models/atlasImagesDimensionsKey.model\";\nimport { NavPanelCoords } from \"../models/navPanelCoords.model\";\n\nimport \"./Atlas.css\";\n\nconst Atlas: FC = () => {\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [initializeAtlas, setInitializeAtlas] = useState(true);\n\tconst [patientId, setPatientId] = useState(\"NextBrain-Case-1/main/P57-16\");\n\tconst [channel, setChannel] = useState(\"LFB\");\n\tconst [showHiRes, setShowHiRes] = useState(false);\n\tconst [showLabels, setShowLabels] = useState(false);\n\tconst [labelsTransparency, setLabelsTransparency] = useState(\"0.5\");\n\tconst [currentLabel, setCurrentLabel] = useState<CurrentLabel | null>(null);\n\tconst [navPanelCoords, setNavPanelCoords] = useState<NavPanelCoords | null>(\n\t\tnull\n\t);\n\tconst [atlasImagesDimensionsKey, setAtlasImagesDimensionsKey] =\n\t\tuseState<AtlasImagesDimensionsKey | null>(null);\n\n\t// load in some helper files at app start-up\n\tconst getAtlasImageDimensionsFiles = useCallback(async () => {\n\t\tconst mriDimensionsKeyUrl = `${ASSETS_URL}${patientId}/mriDimensionsKey.json`;\n\t\tconst histologyLowResDimensionsKeyUrl = `${ASSETS_URL}${patientId}/histologyDimensionsKey.json`;\n\t\tconst histologyHiResDimensionsKeyUrl = `${ASSETS_URL}${patientId}/histologyHRDimensionsKey.json`;\n\n\t\tlet mriDimensionsKeyFile;\n\t\tlet histologyLowResDimensionsKeyFile;\n\t\tlet histologyHiResDimensionsKeyFile;\n\n\t\ttry {\n\t\t\tmriDimensionsKeyFile = await (await fetch(mriDimensionsKeyUrl)).json();\n\n\t\t\thistologyLowResDimensionsKeyFile = await (\n\t\t\t\tawait fetch(histologyLowResDimensionsKeyUrl)\n\t\t\t).json();\n\n\t\t\thistologyHiResDimensionsKeyFile = await (\n\t\t\t\tawait fetch(histologyHiResDimensionsKeyUrl)\n\t\t\t).json();\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n\n\t\tconst atlasImagesDimensionsKey = {\n\t\t\tmriDimensions: mriDimensionsKeyFile,\n\t\t\thistologyLowResDimensions: histologyLowResDimensionsKeyFile,\n\t\t\thistologyHiResDimensions: histologyHiResDimensionsKeyFile,\n\t\t};\n\n\t\tsetAtlasImagesDimensionsKey(atlasImagesDimensionsKey);\n\t}, [patientId]);\n\n\tuseEffect(() => {\n\t\tconst initializeAtlas = async () => {\n\t\t\tsetIsLoading(true);\n\t\t\tsetInitializeAtlas(true);\n\t\t\tawait getAtlasImageDimensionsFiles();\n\t\t\tsetInitializeAtlas(false);\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tinitializeAtlas();\n\t}, [patientId, getAtlasImageDimensionsFiles]);\n\n\tif (initializeAtlas === true) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<LoadingSpinner\n\t\t\t\t\t\tasOverlay\n\t\t\t\t\t\tmessage={\n\t\t\t\t\t\t\t\"Initializing atlas and loading assets, this might take a few seconds depending on your internet connection...\"\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</>\n\t\t);\n\t}\n\n\tif (atlasImagesDimensionsKey == null) {\n\t\treturn <div>Error: could not load assets from remote storage</div>;\n\t}\n\n\treturn (\n\t\t<main className=\"atlas-container\">\n\t\t\t<AtlasImages\n\t\t\t\tpatientId={patientId}\n\t\t\t\tchannel={channel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetCurrentLabel={setCurrentLabel}\n\t\t\t\tnavPanelCoords={navPanelCoords}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\n\t\t\t<AtlasOptions\n\t\t\t\tpatientId={patientId}\n\t\t\t\tsetPatientId={setPatientId}\n\t\t\t\tchannel={channel}\n\t\t\t\tsetChannel={setChannel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tsetShowLabels={setShowLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetLabelsTransparency={setLabelsTransparency}\n\t\t\t\tcurrentLabel={currentLabel}\n\t\t\t\tsetNavPanelCoords={setNavPanelCoords}\n\t\t\t\tsetInitializeAtlas={setInitializeAtlas}\n\t\t\t/>\n\n\t\t\t{/* ideally, scrollbars should go here */}\n\t\t\t{/* <Scrollbars\n\t\t\t\tscrollbarPos={scrollbarPos}\n\t\t\t\tsetScrollbarPos={setScrollbarPos}\n\t\t\t\thistologyScrollbarPos={histologyScrollbarPos}\n\t\t\t\tsetHistologyScrollbarPos={setHistologyScrollbarPos}\n\t\t\t/> */}\n\t\t</main>\n\t);\n};\n\nexport default Atlas;\n","import { Route, Routes, Navigate } from \"react-router-dom\";\n\nimport Layout from \"./components/layout/Layout\";\nimport NotFound from \"./pages/NotFound\";\nimport Home from \"./pages/Home\";\nimport Atlas from \"./pages/Atlas\";\n\nfunction App() {\n\treturn (\n\t\t<Layout>\n\t\t\t<Routes>\n\t\t\t\t<Route path=\"/\" element={<Navigate replace to=\"/home\" />} />\n\n\t\t\t\t<Route path=\"/home\" element={<Home />} />\n\n\t\t\t\t<Route path=\"/atlas\" element={<Atlas />} />\n\n\t\t\t\t<Route path=\"*\" element={<NotFound />} />\n\t\t\t</Routes>\n\t\t</Layout>\n\t);\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport App from \"./App\";\n\nimport \"./index.css\";\n\n// we use HashRouter to make it compatible with GitHub pages\n// https://medium.com/@bennirus/deploying-a-create-react-app-with-routing-to-github-pages-f386b6ce84c2\nimport { HashRouter } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\")!);\nroot.render(\n\t<React.StrictMode>\n\t\t<HashRouter>\n\t\t\t<App />\n\t\t</HashRouter>\n\t</React.StrictMode>\n);\n"],"sourceRoot":""}