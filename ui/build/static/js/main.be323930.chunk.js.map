{"version":3,"sources":["assets/zip_test/final_test/block_38_slice_04.npz","components/layout/MainNavigation.tsx","components/layout/Layout.tsx","pages/NotFound.tsx","assets/homepage-banner.png","assets/erc-logo.png","assets/eu-logo.png","pages/Home.tsx","assets/ucl-logo.png","components/utils/calculateMriImageCoords.ts","components/utils/ASSETS_URL.ts","components/utils/getMatrix.ts","components/utils/matrixMultiplier.ts","components/utils/calculateHistologyImageCoords.ts","components/utils/calculateAdjustedMriCoords.ts","components/utils/logMriCoordsForDebugging.ts","components/shared/LoadingSpinner.tsx","components/shared/Backdrop.tsx","components/shared/Modal.tsx","components/shared/Button.tsx","components/shared/ErrorModal.tsx","components/shared/MousePointer.tsx","components/atlas/atlasImages/MriImage.tsx","components/utils/getmouseCoords.ts","components/atlas/atlasImages/MriImages.tsx","components/atlas/atlasImages/HistologyLowResImage.tsx","components/atlas/atlasImages/HistologyLabelsImage.tsx","components/atlas/atlasImages/HistologyHiResImage.tsx","components/atlas/atlasImages/HistologyImages.tsx","components/utils/npzAsArrayBuffer.js","components/utils/histologyLabelParser.ts","components/atlas/scrollbars/HistologyScrollbar.tsx","components/atlas/scrollbars/Scrollbars.tsx","components/atlas/atlasImages/AtlasImages.tsx","components/atlas/atlasOptions/PatientSelect.tsx","components/atlas/atlasOptions/AtlasNavigation.tsx","components/atlas/atlasOptions/LabelsBtn.tsx","components/atlas/atlasOptions/TransparencySlider.tsx","components/atlas/atlasOptions/Label.tsx","components/atlas/atlasOptions/ImageChannels.tsx","components/atlas/atlasOptions/HiResBtn.tsx","components/atlas/atlasOptions/AtlasOptions.tsx","pages/Atlas.tsx","pages/Test.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["MainNavigation","className","to","activeClassName","process","Layout","props","children","NotFound","Atlas","src","banner","alt","href","target","rel","ercLogo","euLogo","calculateMriImageCoords","currentMriPlane","currentMriSlice","currentMriMouseX","currentMriMouseY","adjustedMriSlice","adjustedMriMouseX","adjustedMriMouseY","newMriCoords","sagittal","slice","mouseX","mouseY","coronal","axial","undefined","ASSETS_URL","getMatrix","currentBlock","type","patientId","a","readTxt","txtToArray","paddedBlock","toString","padStart","fileUrl","fetch","file","text","txtFile","parse","matrix","removedLineBreaks","replace","split","pop","arrayAsNumbers","map","element","Number","multiplyMatrixAndPoint","point","console","log","c0r0","c1r0","c2r0","c3r0","c0r1","c1r1","c2r1","c3r1","c0r2","c1r2","c2r2","c3r2","c0r3","c1r3","c2r3","c3r3","x","y","z","w","resultX","resultY","resultZ","resultW","calculateHistologyImageCoords","atlasImagesDimensionsKey","getCurrentBlock","matrixLowRes","matrixHiRes","histologyImageCoordsLowRes","getHistologyImageCoords","histologyImageCoordsHiRes","coordsLowRes","coords","coordsHiRes","currentHistologySlice","currentHistologyBlock","matrixMultiplier","validateCoords","toFixed","histologyLowResDimensions","slices","n","npyjs","paddedSlice","npyFile","Error","load","npyArray","ndArray","ndarray","data","shape","transpose","get","mriDimensions","height","calculateAdjustedMriCoords","width","logMriCoordsForDebugging","LoadingSpinner","asOverlay","Backdrop","ReactDOM","createPortal","onClick","document","getElementById","ModalOverlay","content","style","headerClass","header","onSubmit","event","preventDefault","contentClass","footerClass","footer","Modal","show","onCancel","CSSTransition","in","mountOnEnter","unmountOnExit","timeout","classNames","Button","size","inverse","danger","disabled","ErrorModal","onClear","error","MousePointer","top","left","MriImage","useState","setError","isLoading","setIsLoading","mriImage","setMriImage","currentSlice","setCurrentSlice","plane","mriImageCoords","computeMriImagesHandler","useEffect","mriImageUrl","response","blob","imageBlob","imageObjectURL","URL","createObjectURL","ok","getMriImage","e","getMouseCoords","showHiRes","offsetX","nativeEvent","offsetY","MriImages","setShowHiRes","updateMriAndHistologyImages","determineMouseBoundariesMri","HistologyLowResImage","histologyImage","updateHistologyCoordsHandler","onImageLoad","onLoad","HistologyLabelsImage","labelsImage","labelsTransparency","opacity","HistologyHiResImage","showLabels","scaledHistologyMouseCoords","wheel","panning","velocityDisabled","limitToBounds","onPanningStart","ref","maxScale","zoomIn","zoomOut","resetTransform","HistologyImages","setHistologyImage","setLabelsImage","imageDimensions","setImageDimensions","setScaledHistologyMouseCoords","histologyImageCoords","channel","histologyToMri","histologySlice","histologyFolder","histologyFileExtension","labelsFileExtension","histologyImageUrl","labelsImageUrl","histologyImageResponse","histologyImageBlob","histologyImageObjectURL","labelsImageResponse","labelsImageBlob","labelsImageObjectURL","fetchHistologyImage","currentHistologyMouseX","currentHistologyMouseY","calculateScaledHistologyMousePos","naturalHeight","naturalWidth","scaledHeight","scaledWidth","scaledHistologyMouseX","scaledHistologyMouseY","naturalCoordinateX","naturalCoordinateY","getImageDimensions","getHistologyMousePos","calculateNaturalMouseCoordinates","npzAsArrayBuffer","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsArrayBuffer","filename","callback","self","this","then","fh","i","readFileAsync","res","catch","err","histologyLabelParser","getCurrentLabelNumber","currentLabelNumber","require","labelsFile","currentLabel","zip","JSZip","npzFile","npzArrayBuffer","npzUint8Array","Uint8Array","loadAsync","loadedZip","filesData","Object","entries","files","async","unzippedArrayBuffer","headerData","hcontents","TextDecoder","decode","JSON","toLowerCase","npyData","Uint16Array","HistologyScrollbar","scrollbarPos","setScrollbarPos","adjustHistologyCoordsFromScrollbar","currentHistologySliceNumber","newHistologyScrollbarPos","incrementHistologyScrollbarPos","increment","slicesInBlock","newHistologySliceNumber","updateHistologyScrollbarPos","Scrollbars","AtlasImages","setMriImageCoords","setHistologyImageCoords","setCurrentLabel","navPanelCoords","updateMriImagesHandler","updateHistologyImagesHandler","newHistologyCoords","setCurrentLabelHandler","useCallback","buildAtlas","singleMriCoord","newSliceNumber","PatientSelect","setPatientId","name","id","value","onChange","AtlasNavigation","atlasNavigationData","setAtlasNavigationData","getNavPanelCoords","dataUrl","json","parsedFile","getAtlasNavigationData","currentNode","selectedNodes","currentNodeData","onAction","node","action","onNodeToggle","keepTreeOnSearch","keepOpenOnSelect","mode","inlineSearchInput","texts","placeholder","memo","LabelsBtn","setShowLabels","TransparencySlider","setLabelsTransparency","min","max","step","Label","labelName","backgroundColor","r","g","b","marginBottom","ImageChannels","setChannel","HiResBtn","AtlasOptions","setNavPanelCoords","setAtlasImagesDimensionsKey","mriDimensionsKeyUrl","histologyLowResDimensionsKeyUrl","histologyHiResDimensionsKeyUrl","mriDimensionsKeyFile","histologyLowResDimensionsKeyFile","histologyHiResDimensionsKeyFile","histologyHiResDimensions","getAtlasImageDimensionsFiles","blockNumber","xh","yh","zh","default","label","processNpzFile","App","path","exact","Test","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","render","StrictMode"],"mappings":"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","file":"static/js/main.be323930.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/block_38_slice_04.56d18583.npz\";","import { NavLink } from \"react-router-dom\";\n\nimport \"./MainNavigation.css\";\n\nconst MainNavigation = () => {\n\treturn (\n\t\t<header className=\"header\">\n\t\t\t<div className=\"logo\">Brain Atlas</div>\n\t\t\t<nav className=\"nav\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<NavLink to=\"/home\" activeClassName=\"active\">\n\t\t\t\t\t\t\tHome\n\t\t\t\t\t\t</NavLink>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<NavLink to=\"/atlas\" activeClassName=\"active\">\n\t\t\t\t\t\t\tAtlas\n\t\t\t\t\t\t</NavLink>\n\t\t\t\t\t</li>\n\n\t\t\t\t\t{process.env.NODE_ENV === \"development\" && (\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<NavLink to=\"/test\" activeClassName=\"active\">\n\t\t\t\t\t\t\t\tTest\n\t\t\t\t\t\t\t</NavLink>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t)}\n\t\t\t\t</ul>\n\t\t\t</nav>\n\t\t</header>\n\t);\n};\n\nexport default MainNavigation;\n","import MainNavigation from \"./MainNavigation\";\n\nimport \"./Layout.css\";\n\nconst Layout: React.FC = (props) => {\n\treturn (\n\t\t<>\n\t\t\t<MainNavigation />\n\t\t\t<main className=\"main\">{props.children}</main>\n\t\t</>\n\t);\n};\n\nexport default Layout;\n","import { FC } from \"react\";\n\nconst NotFound: FC = () => {\n\treturn <main>Page not found!</main>;\n};\n\nexport default NotFound;\n","export default __webpack_public_path__ + \"static/media/homepage-banner.66523cf7.png\";","export default __webpack_public_path__ + \"static/media/erc-logo.a80f7f04.png\";","export default __webpack_public_path__ + \"static/media/eu-logo.1a7bc00a.png\";","import { FC } from \"react\";\n\nimport banner from \"../assets/homepage-banner.png\";\nimport uclLogo from \"../assets/ucl-logo.png\";\nimport ercLogo from \"../assets/erc-logo.png\";\nimport euLogo from \"../assets/eu-logo.png\";\n\nimport \"./Home.css\";\n\nconst Atlas: FC = () => {\n\treturn (\n\t\t<main className=\"homepage-container\">\n\t\t\t<div className=\"homepage-header\">\n\t\t\t\t<img className=\"header-banner\" src={banner} alt=\"logo\"></img>\n\n\t\t\t\t<h1 className=\"homepage-title\">\n\t\t\t\t\tA 3D histological atlas of the human brain for high-resolution\n\t\t\t\t\tneuroimaging studies\n\t\t\t\t</h1>\n\t\t\t</div>\n\n\t\t\t<div className=\"homepage-body\">\n\t\t\t\t<p>\n\t\t\t\t\tWe are building a new atlas of the human brain using histological\n\t\t\t\t\tsections of five full human hemispheres with manual annotations for\n\t\t\t\t\t~300 structures. This website enables the interactive inspection of\n\t\t\t\t\tone of these cases using a 3D navigation interface and search\n\t\t\t\t\tfunctionality. Further cases will be uploaded soon.\n\t\t\t\t</p>\n\n\t\t\t\t<p>\n\t\t\t\t\tThe histological sections are registered to the coordinate space of an\n\t\t\t\t\tex vivo MRI using a pipeline described in the following publication:\n\t\t\t\t</p>\n\n\t\t\t\t<cite>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://www.nature.com/articles/s41598-020-69163-z\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\tclassName=\"reference\"\n\t\t\t\t\t>\n\t\t\t\t\t\tMancini, Matteo, Adrià Casamitjana, Loic Peter, Eleanor Robinson,\n\t\t\t\t\t\tShauna Crampsie, David L. Thomas, Janice L. Holton, Zane\n\t\t\t\t\t\tJaunmuktane, and Juan Eugenio Iglesias. \"A multimodal computational\n\t\t\t\t\t\tpipeline for 3D histology of the human brain.\" Scientific reports.\n\t\t\t\t\t</a>\n\t\t\t\t</cite>\n\n\t\t\t\t<p>\n\t\t\t\t\tThis research is primarily funded by the European Research Council{\" \"}\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://cordis.europa.eu/project/id/677697\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\tclassName=\"reference\"\n\t\t\t\t\t>\n\t\t\t\t\t\t(Starting Grant 677696, project \"BUNGEE-TOOLS\")\n\t\t\t\t\t</a>\n\t\t\t\t\t.\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div className=\"homepage-footer\">\n\t\t\t\t<img className=\"footer-logo\" src={uclLogo} alt=\"logo\"></img>\n\t\t\t\t<img className=\"footer-logo\" src={ercLogo} alt=\"logo\"></img>\n\t\t\t\t<img className=\"footer-logo\" src={euLogo} alt=\"logo\"></img>\n\t\t\t</div>\n\t\t</main>\n\t);\n};\n\nexport default Atlas;\n","export default \"data:image/png;base64,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\"","// coordinates are calculated specifically for each plane\n// refer to the top level readme for guidance on how the coordinates are calculated\n\nconst calculateMriImageCoords = (\n\tcurrentMriPlane: string,\n\tcurrentMriSlice: number,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tadjustedMriSlice: number,\n\tadjustedMriMouseX: number,\n\tadjustedMriMouseY: number\n) => {\n\tlet newMriCoords;\n\n\tswitch (currentMriPlane) {\n\t\tcase \"sagittal\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: currentMriMouseX,\n\t\t\t\t\tmouseX: adjustedMriSlice,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: adjustedMriSlice,\n\t\t\t\t\tmouseY: adjustedMriMouseX,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tcase \"coronal\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: adjustedMriMouseX,\n\t\t\t\t\tmouseX: currentMriSlice,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tcase \"axial\":\n\t\t\tnewMriCoords = {\n\t\t\t\tsagittal: {\n\t\t\t\t\tslice: adjustedMriMouseX,\n\t\t\t\t\tmouseX: adjustedMriMouseY,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t\tcoronal: {\n\t\t\t\t\tslice: adjustedMriMouseY,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: adjustedMriSlice,\n\t\t\t\t},\n\t\t\t\taxial: {\n\t\t\t\t\tslice: currentMriSlice,\n\t\t\t\t\tmouseX: currentMriMouseX,\n\t\t\t\t\tmouseY: currentMriMouseY,\n\t\t\t\t},\n\t\t\t};\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnewMriCoords = undefined;\n\t}\n\n\treturn newMriCoords;\n};\n\nexport default calculateMriImageCoords;\n","export const ASSETS_URL = \"https://raw.githubusercontent.com/UCL/\";\n","// a helper function that loads in a matrix txt file\n// we multiply the matrix by a vector point (i.e. our image coords) to get a new set of coords\n\nimport { ASSETS_URL } from \"./ASSETS_URL\";\n\nconst getMatrix = async (\n\tcurrentBlock: number,\n\ttype: string,\n\tpatientId: string\n) => {\n\tlet readTxt = new txtToArray();\n\n\tconst paddedBlock = currentBlock.toString().padStart(2, \"0\");\n\n\tlet fileUrl = \"\";\n\tlet txtFile;\n\n\t// fetch the txt file from remote server\n\tif (type === \"mri\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/mri_rotated/matrices/block_${paddedBlock}.txt`;\n\t}\n\n\tif (type === \"mri_hr\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/mri_rotated/matrices_hr/block_${paddedBlock}.txt`;\n\t}\n\n\tif (type === \"histology\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/histology/${paddedBlock}/matrix.txt`;\n\t}\n\n\tif (type === \"histology_hr\") {\n\t\tfileUrl = `${ASSETS_URL}${patientId}/histology_hr/${paddedBlock}/matrix.txt`;\n\t}\n\n\tconst file = await fetch(fileUrl);\n\n\ttxtFile = await file.text();\n\n\tconst matrix = await readTxt.parse(txtFile);\n\n\treturn matrix;\n};\n\n// custom parser to extract matrix txt data into an array\nclass txtToArray {\n\tasync parse(file: string) {\n\t\tlet removedLineBreaks = file.replace(/\\n/g, \" \");\n\n\t\tvar txtToArray = removedLineBreaks.split(\" \");\n\t\ttxtToArray.pop();\n\n\t\t// convert the array of strings to numbers\n\t\tconst arrayAsNumbers = txtToArray.map((element) => {\n\t\t\treturn Number(element);\n\t\t});\n\n\t\treturn arrayAsNumbers;\n\t}\n\n\t// async load(filename: RequestInfo) {\n\t// \treturn fetch(filename)\n\t// \t\t.then((response) => {\n\t// \t\t\treturn response.text();\n\t// \t\t})\n\t// \t\t.then((text) => {\n\t// \t\t\tconst parsedTxt = this.parse(text);\n\t// \t\t\treturn parsedTxt;\n\t// \t\t});\n\t// }\n}\n\nexport default getMatrix;\n","// multiplies a 4x4 matrix by a vector point\n// for a worked example of matrix multiplication see https://matrix.reshish.com/multCalculation.php\n\nconst multiplyMatrixAndPoint = (matrix: number[], point: number[]) => {\n\tconsole.log(point);\n\t// Give a variable name to each part of the matrix, a column and row number\n\tlet c0r0 = matrix[0],\n\t\tc1r0 = matrix[1],\n\t\tc2r0 = matrix[2],\n\t\tc3r0 = matrix[3];\n\tlet c0r1 = matrix[4],\n\t\tc1r1 = matrix[5],\n\t\tc2r1 = matrix[6],\n\t\tc3r1 = matrix[7];\n\tlet c0r2 = matrix[8],\n\t\tc1r2 = matrix[9],\n\t\tc2r2 = matrix[10],\n\t\tc3r2 = matrix[11];\n\tlet c0r3 = matrix[12],\n\t\tc1r3 = matrix[13],\n\t\tc2r3 = matrix[14],\n\t\tc3r3 = matrix[15];\n\n\t// set some names for the point\n\tlet x = point[0];\n\tlet y = point[1];\n\tlet z = point[2];\n\tlet w = point[3];\n\n\t// perform matrix multiplication operations\n\tlet resultX = x * c0r0 + y * c1r0 + z * c2r0 + w * c3r0;\n\tlet resultY = x * c0r1 + y * c1r1 + z * c2r1 + w * c3r1;\n\tlet resultZ = x * c0r2 + y * c1r2 + z * c2r2 + w * c3r2;\n\tlet resultW = x * c0r3 + y * c1r3 + z * c2r3 + w * c3r3;\n\n\t// resultW is not used but is necessary to perform the multiplication\n\tconst matrixResult = { resultX, resultY, resultZ, resultW };\n\n\treturn matrixResult;\n};\n\nexport default multiplyMatrixAndPoint;\n","import npyjs from \"npyjs\";\nimport ndarray from \"ndarray\";\n\nimport getMatrix from \"./getMatrix\";\nimport matrixMultiplier from \"./matrixMultiplier\";\nimport { ASSETS_URL } from \"./ASSETS_URL\";\n\nimport { MriCoords } from \"../../models/mriCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../models/atlasImagesDimensionsKey.model\";\n\nconst calculateHistologyImageCoords = async (\n\tcurrentMriPlane: string,\n\tnewMriCoords: MriCoords,\n\tpatientId: string,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\tconst currentMriMouseX = newMriCoords[currentMriPlane][\"mouseX\"];\n\tconst currentMriMouseY = newMriCoords[currentMriPlane][\"mouseY\"];\n\tconst currentMriSlice = newMriCoords[currentMriPlane][\"slice\"];\n\n\tconst currentBlock = await getCurrentBlock(\n\t\tcurrentMriPlane,\n\t\tcurrentMriMouseX,\n\t\tcurrentMriMouseY,\n\t\tcurrentMriSlice,\n\t\tpatientId,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconsole.log(\"current block: \" + currentBlock);\n\n\tif (currentBlock === 0 || currentBlock === undefined) return \"no block found\";\n\n\tconst matrixLowRes = await getMatrix(currentBlock, \"mri\", patientId);\n\tconst matrixHiRes = await getMatrix(currentBlock, \"mri_hr\", patientId);\n\n\tif (matrixLowRes === undefined || matrixHiRes === undefined)\n\t\treturn \"no matrix found\";\n\n\tconst histologyImageCoordsLowRes = getHistologyImageCoords(\n\t\tnewMriCoords,\n\t\tmatrixLowRes,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconst histologyImageCoordsHiRes = getHistologyImageCoords(\n\t\tnewMriCoords,\n\t\tmatrixHiRes,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\treturn {\n\t\tcoordsLowRes: histologyImageCoordsLowRes.coords,\n\t\tcoordsHiRes: histologyImageCoordsHiRes.coords,\n\t\tcurrentHistologySlice: histologyImageCoordsLowRes.slice, // slice is the same for both hi and low res\n\t\tcurrentHistologyBlock: currentBlock,\n\t};\n};\n\nconst getHistologyImageCoords = (\n\tnewMriCoords: MriCoords,\n\tmatrix: number[],\n\tcurrentBlock: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\tconst coords = matrixMultiplier(matrix, [\n\t\tnewMriCoords.sagittal.slice,\n\t\tnewMriCoords.coronal.slice,\n\t\tnewMriCoords.axial.slice,\n\t\t1,\n\t]);\n\n\tlet { resultX, resultY, resultZ } = validateCoords(\n\t\tcoords,\n\t\tcurrentBlock,\n\t\tatlasImagesDimensionsKey\n\t);\n\n\tconst histologyImageCoords = {\n\t\tmouseX: +resultY.toFixed(0),\n\t\tmouseY: +resultX.toFixed(0),\n\t};\n\n\tconst histologySlice = +resultZ.toFixed(0);\n\n\treturn { coords: histologyImageCoords, slice: histologySlice };\n};\n\nconst validateCoords = (\n\tcoords: { resultX: number; resultY: number; resultZ: number },\n\tcurrentBlock: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\t// we need to convert negative numbers to zero to avoid errors and load the right slice\n\tlet resultX = coords.resultX < 0 ? 0 : coords.resultX;\n\tlet resultY = coords.resultY < 0 ? 0 : coords.resultY;\n\tlet resultZ = coords.resultZ < 0 ? 0 : coords.resultZ;\n\n\t// if returned slice exceeds the number of slices in the block (within +2 slices) then return the maximum slice number\n\t// we make an adjustment to account for the fact that slices start at 0 within a block\n\t// if returned slice exceeds maximum number of slices +2 then its a calcultion bug\n\tif (\n\t\tresultZ >\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices -\n\t\t\t\t1 &&\n\t\tresultZ <\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices +\n\t\t\t\t1\n\t) {\n\t\tresultZ =\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock]\n\t\t\t\t.slices - 1;\n\t}\n\n\treturn { resultX, resultY, resultZ };\n};\n\nconst getCurrentBlock = async (\n\tcurrentMriPlane: string,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tcurrentMriSlice: number,\n\tpatientId: string,\n\tatlasImagesDimensionsKey: any\n) => {\n\tlet currentBlock;\n\tlet n = new npyjs();\n\n\tconsole.log(\"current slice: \" + currentMriSlice);\n\n\tconst paddedSlice = currentMriSlice.toFixed(0).padStart(3, \"0\");\n\n\tlet npyFile;\n\ttry {\n\t\tnpyFile = `${ASSETS_URL}${patientId}/mri_rotated/indices_${currentMriPlane}/slice_${paddedSlice}.npy`;\n\t} catch (e: any) {\n\t\tthrow new Error(e);\n\t}\n\n\tconst npyArray = await n.load(npyFile);\n\n\tlet ndArray = ndarray(npyArray.data, npyArray.shape);\n\n\t// the numpy arrays in the data are the opposite of the image dimensions, so a transposition is needed\n\t// you can alternatively take the dimensions from rotateCoords() below and get the numpy block from xRotated and yRotated\n\tndArray = await ndArray.transpose(1, 0);\n\n\tconsole.log(\"npy shape (after transpose): \" + ndArray.shape);\n\n\t// const { xRotated, yRotated } = rotateCoords(\n\t// \tndArray,\n\t// \tcurrentMriMouseX,\n\t// \tcurrentMriMouseY,\n\t// \tcurrentMriPlane,\n\t// \tadjustedMriSlice,\n\t// \tadjustedMriMouseX,\n\t// \tadjustedMriMouseY\n\t// );\n\n\tif (currentMriPlane === \"sagittal\") {\n\t\t// sagittal has an additional horizontal flip, so we need to account for that here\n\t\t// since its been flipped, we dont need to take the adjustedMriMouseX... we just take the normal currentMriMouseX\n\t\tcurrentBlock = ndArray.get(\n\t\t\tcurrentMriMouseX,\n\t\t\tndArray.shape[1] -\n\t\t\t\t(+atlasImagesDimensionsKey.mriDimensions.sagittal.height -\n\t\t\t\t\tcurrentMriMouseY)\n\t\t);\n\t}\n\n\tif (currentMriPlane === \"coronal\" || currentMriPlane === \"axial\") {\n\t\tcurrentBlock = ndArray.get(currentMriMouseX, currentMriMouseY);\n\t}\n\n\treturn currentBlock;\n};\n\n// const rotateCoords = (\n// \tndArray,\n// \tcurrentMriMouseX,\n// \tcurrentMriMouseY,\n// \tcurrentMriPlane,\n// \tadjustedMriSlice,\n// \tadjustedMriMouseX,\n// \tadjustedMriMouseY\n// ) => {\n// \tconst ndArray0Modified = (ndArray.shape[0] - 1) / 2;\n// \tconst ndArray1Modified = (ndArray.shape[1] - 1) / 2;\n// \t// console.log(ndArray0Modified, ndArray1Modified);\n\n// \t// the x and y have been swapped here compared to Peters python file\n// \tconst xRotated = -adjustedMriMouseX + 2 * ndArray1Modified;\n// \tconst yRotated = 2 * ndArray0Modified - adjustedMriMouseY;\n\n// \tconsole.log(\"rotated mouse x: \" + xRotated);\n// \tconsole.log(\"rotated mouse y: \" + yRotated);\n\n// \treturn { xRotated, yRotated };\n// };\n\nexport default calculateHistologyImageCoords;\n","import { AtlasImagesDimensionsKey } from \"../../models/atlasImagesDimensionsKey.model\";\n\nconst calculateAdjustedMriCoords = (\n\tcurrentMriPlane: string,\n\tcurrentMriSlice: number,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null\n) => {\n\t// adjusting coordinates to account for images not being in the correct orientations\n\t// in other words, I have to account for orientation differences between the web application and ITKSnap\n\t// specifically, ITKSnap has the 0,0 coordinate at the bottom right, whereas the web application has 0,0 at the top left\n\n\tlet adjustedMriSlice;\n\tlet adjustedMriMouseX;\n\tlet adjustedMriMouseY;\n\n\tif (currentMriPlane === \"sagittal\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.slices -\n\t\t\tcurrentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.width -\n\t\t\tcurrentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.sagittal.height -\n\t\t\tcurrentMriMouseY;\n\t}\n\n\tif (currentMriPlane === \"coronal\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.slices - currentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.width - currentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.coronal.height -\n\t\t\tcurrentMriMouseY;\n\t}\n\n\tif (currentMriPlane === \"axial\") {\n\t\tadjustedMriSlice =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.slices - currentMriSlice;\n\t\tadjustedMriMouseX =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width - currentMriMouseX;\n\t\tadjustedMriMouseY =\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height - currentMriMouseY;\n\t}\n\n\treturn { adjustedMriSlice, adjustedMriMouseX, adjustedMriMouseY };\n};\n\nexport default calculateAdjustedMriCoords;\n","// this function is just for debugging purposes\n// it logs the mapping of the physical currentMriMouseX, currentMriMouseY, and slice coordinates in the web app to the x y z coords of ITKSnap\n// I add +1 to each ITKSnap coord because the index for ITKSnap starts at 1\n\nconst logMriCoordsForDebugging = (\n\tcurrentMriPlane: string,\n\tcurrentMriSlice: number,\n\tcurrentMriMouseX: number,\n\tcurrentMriMouseY: number,\n\tadjustedMriSlice: number,\n\tadjustedMriMouseX: number,\n\tadjustedMriMouseY: number\n) => {\n\tconsole.log(`current plane: ${currentMriPlane}`);\n\n\tif (currentMriPlane === \"sagittal\") {\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for sagittal: slice = ${currentMriSlice}, currentMriMouseX = ${currentMriMouseX}, currentMriMouseY = ${currentMriMouseY}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for coronal: slice = ${currentMriMouseX}, currentMriMouseX = ${adjustedMriSlice}, currentMriMouseY = ${currentMriMouseY}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for axial: slice = ${adjustedMriMouseY}, currentMriMouseX = ${adjustedMriSlice}, currentMriMouseY = ${adjustedMriMouseX}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging ITKSnap coords: X = ${currentMriSlice + 1}, Y = ${\n\t\t\t\tcurrentMriMouseX + 1\n\t\t\t}, Z = ${adjustedMriMouseY + 1}`\n\t\t);\n\t}\n\n\tif (currentMriPlane === \"coronal\") {\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for sagittal: slice = ${adjustedMriMouseX}, currentMriMouseX = ${currentMriSlice}, currentMriMouseY = ${currentMriMouseY}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for coronal: slice = ${currentMriSlice}, currentMriMouseX = ${currentMriMouseX}, currentMriMouseY = ${currentMriMouseY}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for axial: slice = ${adjustedMriMouseY}, currentMriMouseX = ${currentMriMouseX}, currentMriMouseY = ${adjustedMriSlice}`\n\t\t);\n\n\t\tconsole.log(\n\t\t\t`logging ITKSnap coords: x = ${adjustedMriMouseX + 1}, y = ${\n\t\t\t\tcurrentMriSlice + 1\n\t\t\t}, z = ${adjustedMriMouseY + 1}`\n\t\t);\n\t}\n\n\tif (currentMriPlane === \"axial\") {\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for sagittal: slice = ${adjustedMriMouseX}, currentMriMouseX = ${adjustedMriMouseY}, currentMriMouseY = ${adjustedMriSlice}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for coronal: slice = ${adjustedMriMouseY}, currentMriMouseX = ${currentMriMouseX}, currentMriMouseY = ${adjustedMriSlice}`\n\t\t);\n\t\tconsole.log(\n\t\t\t`logging chosen web coords for axial: slice = ${currentMriSlice}, currentMriMouseX = ${currentMriMouseX}, currentMriMouseY = ${currentMriMouseY}`\n\t\t);\n\n\t\tconsole.log(\n\t\t\t`logging ITKSnap coords: x = ${adjustedMriMouseX + 1}, y = ${\n\t\t\t\tadjustedMriMouseY + 1\n\t\t\t}, z = ${currentMriSlice + 1}`\n\t\t);\n\t}\n};\n\nexport default logMriCoordsForDebugging;\n","import { FC } from \"react\";\n\nimport \"./LoadingSpinner.css\";\n\ninterface Props {\n\tasOverlay: boolean;\n}\n\nconst LoadingSpinner: FC<Props> = (props) => {\n\treturn (\n\t\t<div className={`${props.asOverlay && \"loading-spinner__overlay\"}`}>\n\t\t\t<div className=\"lds-dual-ring\"></div>\n\t\t\t<div>Loading...</div>\n\t\t</div>\n\t);\n};\n\nexport default LoadingSpinner;\n","import { FC } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport \"./Backdrop.css\";\n\ninterface Props {\n\tonClick: () => void;\n}\n\n// is ! appropriate here?\nconst Backdrop: FC<Props> = (props) => {\n\treturn ReactDOM.createPortal(\n\t\t<div className=\"backdrop\" onClick={props.onClick}></div>,\n\t\tdocument.getElementById(\"backdrop-hook\")!\n\t);\n};\n\nexport default Backdrop;\n","import React, { CSSProperties, FC, ReactElement } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { CSSTransition } from \"react-transition-group\";\n\nimport Backdrop from \"./Backdrop\";\nimport \"./Modal.css\";\n\ninterface ModalOverlayProps {\n\tclassName?: string;\n\tstyle?: CSSProperties | null | undefined; // is this a good solution?\n\theaderClass?: string;\n\theader?: string;\n\tonSubmit?: () => void | undefined;\n\tcontentClass?: string;\n\tfooterClass?: string;\n\tfooter?: ReactElement;\n}\n\ninterface ModalProps extends ModalOverlayProps {\n\tshow: boolean;\n\tonCancel: () => void;\n}\n\nconst ModalOverlay: FC<ModalOverlayProps> = (props) => {\n\tconst content = (\n\t\t<div className={`modal ${props.className}`} style={props.style!}>\n\t\t\t<header className={`modal__header ${props.headerClass}`}>\n\t\t\t\t<h2>{props.header}</h2>\n\t\t\t</header>\n\t\t\t<form\n\t\t\t\tonSubmit={\n\t\t\t\t\tprops.onSubmit ? props.onSubmit : (event) => event.preventDefault()\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t<div className={`modal__content ${props.contentClass}`}>\n\t\t\t\t\t{props.children}\n\t\t\t\t</div>\n\t\t\t\t<footer className={`modal__footer ${props.footerClass}`}>\n\t\t\t\t\t{props.footer}\n\t\t\t\t</footer>\n\t\t\t</form>\n\t\t</div>\n\t);\n\treturn ReactDOM.createPortal(content, document.getElementById(\"modal-hook\")!);\n};\n\nconst Modal: FC<ModalProps> = (props) => {\n\treturn (\n\t\t<>\n\t\t\t{props.show && <Backdrop onClick={props.onCancel} />}\n\t\t\t<CSSTransition\n\t\t\t\tin={props.show}\n\t\t\t\tmountOnEnter\n\t\t\t\tunmountOnExit\n\t\t\t\ttimeout={200}\n\t\t\t\tclassNames=\"modal\"\n\t\t\t>\n\t\t\t\t<ModalOverlay {...props} />\n\t\t\t</CSSTransition>\n\t\t</>\n\t);\n};\n\nexport default Modal;\n","import { FC } from \"react\";\n\nimport \"./Button.css\";\n\ninterface ButtonProps extends React.ComponentProps<\"button\"> {\n\thref?: string;\n\tinverse?: boolean;\n\tdanger?: boolean;\n\tsize?: string;\n\tonClick?: () => void;\n}\n\nconst Button: FC<ButtonProps> = (props) => {\n\tif (props.href) {\n\t\treturn (\n\t\t\t<a\n\t\t\t\tclassName={`button button--${props.size || \"default\"} ${\n\t\t\t\t\tprops.inverse && \"button--inverse\"\n\t\t\t\t} ${props.danger && \"button--danger\"}`}\n\t\t\t\thref={props.href}\n\t\t\t>\n\t\t\t\t{props.children}\n\t\t\t</a>\n\t\t);\n\t}\n\n\treturn (\n\t\t<button\n\t\t\tclassName={`button button--${props.size || \"default\"} ${\n\t\t\t\tprops.inverse && \"button--inverse\"\n\t\t\t} ${props.danger && \"button--danger\"}`}\n\t\t\ttype={props.type}\n\t\t\tonClick={props.onClick}\n\t\t\tdisabled={props.disabled}\n\t\t>\n\t\t\t{props.children}\n\t\t</button>\n\t);\n};\n\nexport default Button;\n","import { FC } from \"react\";\n\nimport Modal from \"./Modal\";\nimport Button from \"./Button\";\n\ninterface Props {\n\tonClear: () => void;\n\terror: string | null;\n}\n\nconst ErrorModal: FC<Props> = (props) => {\n\treturn (\n\t\t<Modal\n\t\t\tonCancel={props.onClear}\n\t\t\theader=\"Oops!\"\n\t\t\tshow={!!props.error}\n\t\t\tfooter={<Button onClick={props.onClear}>Okay</Button>}\n\t\t>\n\t\t\t<p>{props.error}</p>\n\t\t</Modal>\n\t);\n};\n\nexport default ErrorModal;\n","import { FC } from \"react\";\n\nimport \"./MousePointer.css\";\n\ninterface Props {\n\tmouseY: number;\n\tmouseX: number;\n}\n\nconst MousePointer: FC<Props> = (props) => {\n\tconst { mouseY, mouseX } = props;\n\n\t// coordinates recieved by MousePointer are rounded in order to calcuate mri and histology, find a way around this?\n\tif (mouseX && mouseY) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName=\"mouse-pointer\"\n\t\t\t\tstyle={{\n\t\t\t\t\ttop: mouseY,\n\t\t\t\t\tleft: mouseX,\n\t\t\t\t}}\n\t\t\t></div>\n\t\t);\n\t}\n\n\t// shows default coords if none can be found\n\t// show an error instead?\n\treturn (\n\t\t<div\n\t\t\tclassName=\"mouse-pointer\"\n\t\t\tstyle={{\n\t\t\t\ttop: 100,\n\t\t\t\tleft: 100,\n\t\t\t}}\n\t\t></div>\n\t);\n};\n\nexport default MousePointer;\n","import { FC, useEffect, useState } from \"react\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport MousePointer from \"../../shared/MousePointer\";\n\nimport { MriCoords } from \"../../../models/mriCoords.model\";\n\nimport \"./MriImage.css\";\n\ninterface Props {\n\tpatientId: string;\n\tplane: string;\n\tmriImageCoords: MriCoords | null;\n\tcomputeMriImagesHandler: (\n\t\te: React.MouseEvent<Element, MouseEvent>,\n\t\tplane: string\n\t) => void;\n}\n\nconst MriImage: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [mriImage, setMriImage] = useState(\"\");\n\tconst [currentSlice, setCurrentSlice] = useState(\"\");\n\n\tconst { patientId, plane, mriImageCoords, computeMriImagesHandler } = props;\n\n\tuseEffect(() => {\n\t\t// determine the correct mri image based on computed coordinates\n\n\t\tconst paddedSlice = mriImageCoords![plane]?.slice\n\t\t\t.toFixed(0)\n\t\t\t.padStart(3, \"0\");\n\n\t\tsetCurrentSlice(paddedSlice);\n\n\t\tconst getMriImage = async () => {\n\t\t\ttry {\n\t\t\t\tsetIsLoading(true);\n\t\t\t\tconst mriImageUrl = `${ASSETS_URL}${patientId}/mri_rotated/slices_${plane}/slice_${paddedSlice}.png`;\n\n\t\t\t\tconst response = await fetch(mriImageUrl);\n\t\t\t\tconst imageBlob = await response.blob();\n\t\t\t\tconst imageObjectURL = URL.createObjectURL(imageBlob);\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tsetMriImage(imageObjectURL);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsetError(\"Error, could not load mri image\");\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tgetMriImage();\n\t}, [mriImageCoords, plane, patientId]);\n\n\tif (mriImage == null || mriImage === \"\" || currentSlice == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay={false} />}\n\t\t\t\t{!isLoading && <div>Failed to load mri image</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t<div className={`mri-img ${plane}`}>\n\t\t\t\t<div className={`mri-img-container ${plane}`}>\n\t\t\t\t\t<MousePointer\n\t\t\t\t\t\tmouseY={mriImageCoords![plane].mouseY}\n\t\t\t\t\t\tmouseX={mriImageCoords![plane].mouseX}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<img\n\t\t\t\t\t\tonClick={(e) => computeMriImagesHandler(e, plane)}\n\t\t\t\t\t\t// onWheel={(e) => console.log(e)}\n\t\t\t\t\t\tclassName={`${plane}-img`}\n\t\t\t\t\t\tsrc={mriImage}\n\t\t\t\t\t\talt={`${plane}-slice${currentSlice}`}\n\t\t\t\t\t></img>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default MriImage;\n","// the returned mouse coords are relative to the scale of its parent container\n// for instance if the parent container image is 1000 x 1000 but has been scaled with css (e.g. max-height: 500px)\n// then the returned mouse coords will be relative to this new scale\n// for this reason, some components also run additional functions to calculate the natural x and y coords\n\n// not sure why this union type isnt working\n// type MouseCoords = React.MouseEvent | MouseEvent;\n\nconst getMouseCoords = (e: any, showHiRes: boolean) => {\n\tlet mouseX = !showHiRes ? e.nativeEvent.offsetX : e.offsetX;\n\tlet mouseY = !showHiRes ? e.nativeEvent.offsetY : e.offsetY;\n\n\treturn { mouseX, mouseY };\n};\n\nexport default getMouseCoords;\n","import { FC } from \"react\";\n\nimport MriImage from \"./MriImage\";\nimport getMouseCoords from \"../../utils/getmouseCoords\";\n\nimport { MriCoords } from \"../../../models/mriCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\ninterface Props {\n\tpatientId: string;\n\tmriImageCoords: MriCoords | null;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tupdateMriAndHistologyImages: (\n\t\tplane: string,\n\t\tcurrentSlice: number,\n\t\tmouseX: number,\n\t\tmouseY: number,\n\t\tpatientId: string\n\t) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst MriImages: FC<Props> = (props) => {\n\tconst {\n\t\tpatientId,\n\t\tmriImageCoords,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tupdateMriAndHistologyImages,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\tconst computeMriImagesHandler = (\n\t\te: React.MouseEvent<Element, MouseEvent>,\n\t\tplane: string\n\t) => {\n\t\tif (showHiRes) setShowHiRes(false);\n\n\t\tconst tempShowHiRes = false; // avoid errors with application not catching up to latest state\n\n\t\tconst { mouseX, mouseY } = getMouseCoords(e, tempShowHiRes);\n\n\t\tconst mouseIsWithinBounds = determineMouseBoundariesMri(\n\t\t\tmouseX,\n\t\t\tmouseY,\n\t\t\tplane\n\t\t);\n\n\t\tif (!mouseIsWithinBounds) return;\n\n\t\tupdateMriAndHistologyImages(\n\t\t\tplane,\n\t\t\t+mriImageCoords![plane][\"slice\"],\n\t\t\tmouseX,\n\t\t\tmouseY,\n\t\t\tpatientId\n\t\t);\n\t};\n\n\tconst determineMouseBoundariesMri = (\n\t\tmouseX: number,\n\t\tmouseY: number,\n\t\tplane: string\n\t) => {\n\t\tif (mouseX < 0 || mouseY < 0) return false;\n\n\t\tif (plane === \"sagittal\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.sagittal.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.sagittal.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (plane === \"coronal\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.coronal.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.coronal.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (plane === \"axial\") {\n\t\t\tif (\n\t\t\t\tmouseX > +atlasImagesDimensionsKey!.mriDimensions.axial.width - 1 ||\n\t\t\t\tmouseY > +atlasImagesDimensionsKey!.mriDimensions.axial.height - 1\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{/* too much repetition here, use map to loop through components? */}\n\t\t\t<MriImage\n\t\t\t\tplane=\"sagittal\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\n\t\t\t<MriImage\n\t\t\t\tplane=\"coronal\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\n\t\t\t<MriImage\n\t\t\t\tplane=\"axial\"\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tcomputeMriImagesHandler={computeMriImagesHandler}\n\t\t\t\tpatientId={patientId}\n\t\t\t/>\n\t\t</>\n\t);\n};\n\nexport default MriImages;\n","import React, { FC } from \"react\";\n\ninterface Props {\n\thistologyImage: any;\n\tupdateHistologyCoordsHandler: any;\n\tonImageLoad: any;\n}\n\nconst HistologyLowResImage: FC<Props> = (props) => {\n\tconst { histologyImage, updateHistologyCoordsHandler, onImageLoad } = props;\n\n\treturn (\n\t\t<img\n\t\t\tonClick={(e) => {\n\t\t\t\tupdateHistologyCoordsHandler(e, \"lowRes\");\n\t\t\t}}\n\t\t\tclassName=\"histology-img\"\n\t\t\tsrc={histologyImage}\n\t\t\talt=\"histology\"\n\t\t\tonLoad={(e) => onImageLoad(e, \"onLoad\")}\n\t\t></img>\n\t);\n};\n\nexport default HistologyLowResImage;\n","import React, { FC } from \"react\";\n\ninterface Props {\n\tlabelsImage: any;\n\tlabelsTransparency: any;\n}\n\nconst HistologyLabelsImage: FC<Props> = (props) => {\n\tconst { labelsImage, labelsTransparency } = props;\n\n\treturn (\n\t\t<img\n\t\t\tclassName=\"histology-img-labels\"\n\t\t\tsrc={labelsImage}\n\t\t\talt=\"histology-labels\"\n\t\t\t//onLoad={(e) => onImageLoad(e, \"lowRes\")}\n\t\t\tstyle={{ opacity: `${labelsTransparency}` }}\n\t\t></img>\n\t);\n};\n\nexport default HistologyLabelsImage;\n","import React, { FC } from \"react\";\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\n\nimport MousePointer from \"../../shared/MousePointer\";\n\ninterface Props {\n\thistologyImage: any;\n\tlabelsImage: any;\n\tlabelsTransparency: any;\n\tshowHiRes: boolean;\n\tshowLabels: boolean;\n\tupdateHistologyCoordsHandler: any;\n\tonImageLoad: any;\n\tscaledHistologyMouseCoords: any;\n}\n\n// to allow the zooming feature, the hi-res image needs access to both the mouse pointer and labels image\nconst HistologyHiResImage: FC<Props> = (props) => {\n\tconst {\n\t\thistologyImage,\n\t\tlabelsImage,\n\t\tlabelsTransparency,\n\t\tshowHiRes,\n\t\tshowLabels,\n\t\tupdateHistologyCoordsHandler,\n\t\tonImageLoad,\n\t\tscaledHistologyMouseCoords,\n\t} = props;\n\n\tconst onPan = (ref: any, e: Event) => {\n\t\t// console.log(ref);\n\n\t\tupdateHistologyCoordsHandler(e, \"hiRes\");\n\t};\n\n\treturn (\n\t\t<TransformWrapper\n\t\t\twheel={{ disabled: false }}\n\t\t\tpanning={{ velocityDisabled: true }}\n\t\t\tlimitToBounds={true}\n\t\t\tonPanningStart={onPan}\n\t\t\tmaxScale={15}\n\t\t>\n\t\t\t{({ zoomIn, zoomOut, resetTransform, ...rest }) => (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"tools\">\n\t\t\t\t\t\t<button onClick={() => zoomIn()}>+</button>\n\t\t\t\t\t\t<button onClick={() => zoomOut()}>-</button>\n\t\t\t\t\t\t<button onClick={() => resetTransform()}>x</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<TransformComponent>\n\t\t\t\t\t\t{scaledHistologyMouseCoords && (\n\t\t\t\t\t\t\t<MousePointer\n\t\t\t\t\t\t\t\tmouseY={scaledHistologyMouseCoords.mouseY}\n\t\t\t\t\t\t\t\tmouseX={scaledHistologyMouseCoords.mouseX}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{showLabels && (\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName=\"histology-img-labels\"\n\t\t\t\t\t\t\t\tsrc={labelsImage}\n\t\t\t\t\t\t\t\talt=\"histology-labels\"\n\t\t\t\t\t\t\t\tstyle={{ opacity: `${labelsTransparency}` }}\n\t\t\t\t\t\t\t></img>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclassName={`histology-img ${showHiRes && \"hi-res\"}`}\n\t\t\t\t\t\t\tsrc={histologyImage}\n\t\t\t\t\t\t\talt=\"histology\"\n\t\t\t\t\t\t\tonLoad={(e) => onImageLoad(e, \"onLoad\")}\n\t\t\t\t\t\t></img>\n\t\t\t\t\t</TransformComponent>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</TransformWrapper>\n\t);\n};\n\nexport default HistologyHiResImage;\n","import React, { FC, useState, useEffect, SyntheticEvent } from \"react\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport MousePointer from \"../../shared/MousePointer\";\nimport getMouseCoords from \"../../utils/getmouseCoords\";\nimport HistologyLowResImage from \"./HistologyLowResImage\";\nimport HistologyLabelsImage from \"./HistologyLabelsImage\";\nimport HistologyHiResImage from \"./HistologyHiResImage\";\n\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\n\nimport \"./HistologyImages.css\";\n\ninterface Props {\n\tpatientId: string;\n\thistologyImageCoords: HistologyCoords | null;\n\tshowHiRes: boolean;\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tchannel: string;\n\thistologyToMri: (mouseX: number, mouseY: number) => void;\n}\n\nconst HistologyImages: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [histologyImage, setHistologyImage] = useState(\"\");\n\tconst [labelsImage, setLabelsImage] = useState(\"\");\n\tconst [imageDimensions, setImageDimensions] = useState<{\n\t\t[key: string]: number;\n\t} | null>(null);\n\tconst [scaledHistologyMouseCoords, setScaledHistologyMouseCoords] = useState<{\n\t\t[key: string]: number;\n\t} | null>(null);\n\n\tconst {\n\t\tpatientId,\n\t\thistologyImageCoords,\n\t\tshowHiRes,\n\t\tshowLabels,\n\t\tlabelsTransparency,\n\t\tchannel,\n\t\thistologyToMri,\n\t} = props;\n\n\tuseEffect(() => {\n\t\tconst fetchHistologyImage = async () => {\n\t\t\t// determine the correct histology image based on computed coordinates\n\t\t\tif (histologyImageCoords !== null && histologyImageCoords !== undefined) {\n\t\t\t\tconst paddedBlock = histologyImageCoords[\"currentHistologyBlock\"]\n\t\t\t\t\t.toString()\n\t\t\t\t\t.padStart(2, \"0\");\n\n\t\t\t\tconst histologySlice = histologyImageCoords[\"currentHistologySlice\"];\n\t\t\t\tconst paddedSlice = histologySlice.toString().padStart(2, \"0\");\n\n\t\t\t\tconst histologyFolder = showHiRes ? \"histology_hr\" : \"histology\";\n\t\t\t\tconst histologyFileExtension = showHiRes ? \"webp\" : \"jpg\";\n\t\t\t\tconst labelsFileExtension = showHiRes ? \"webp\" : \"png\";\n\n\t\t\t\t// I do this because of a weird behaviour on the dev server causing the loading spinner to reappear\n\t\t\t\t// I dont think this is an issue on the deployed site, so perhaps remove (or only run the logic on dev)\n\t\t\t\t// if (histologyImage !== null) {\n\t\t\t\t// \tsetIsLoading(false);\n\t\t\t\t// }\n\n\t\t\t\ttry {\n\t\t\t\t\t//setIsLoading(true);\n\n\t\t\t\t\tconst histologyImageUrl = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_${channel}/slice_${paddedSlice}.${histologyFileExtension}`;\n\t\t\t\t\tconst labelsImageUrl = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_labels/slice_${paddedSlice}.${labelsFileExtension}`;\n\n\t\t\t\t\tconst histologyImageResponse = await fetch(histologyImageUrl);\n\t\t\t\t\tconst histologyImageBlob = await histologyImageResponse.blob();\n\t\t\t\t\tconst histologyImageObjectURL =\n\t\t\t\t\t\tURL.createObjectURL(histologyImageBlob);\n\n\t\t\t\t\tconst labelsImageResponse = await fetch(labelsImageUrl);\n\t\t\t\t\tconst labelsImageBlob = await labelsImageResponse.blob();\n\t\t\t\t\tconst labelsImageObjectURL = URL.createObjectURL(labelsImageBlob);\n\n\t\t\t\t\tif (histologyImageResponse.ok && labelsImageResponse.ok) {\n\t\t\t\t\t\tsetHistologyImage(histologyImageObjectURL);\n\t\t\t\t\t\tsetLabelsImage(labelsImageObjectURL);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tsetError(\"Error, could not load histology image\");\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\t//setIsLoading(false);\n\t\t\t}\n\t\t};\n\n\t\tfetchHistologyImage();\n\t}, [histologyImageCoords, showHiRes, channel, patientId]);\n\n\t// take the current histology coords and calculate scaled mouseX and mouseY\n\t// this is to account for the fact that we scale the histology image with css using the max-height property\n\tuseEffect(() => {\n\t\tif (imageDimensions !== null) {\n\t\t\tlet currentHistologyMouseX = !showHiRes\n\t\t\t\t? histologyImageCoords!.coordsLowRes.mouseX\n\t\t\t\t: histologyImageCoords!.coordsHiRes.mouseX;\n\n\t\t\tlet currentHistologyMouseY = !showHiRes\n\t\t\t\t? histologyImageCoords!.coordsLowRes.mouseY\n\t\t\t\t: histologyImageCoords!.coordsHiRes.mouseY;\n\n\t\t\tconst { scaledHistologyMouseX, scaledHistologyMouseY } =\n\t\t\t\tcalculateScaledHistologyMousePos(\n\t\t\t\t\tcurrentHistologyMouseX,\n\t\t\t\t\tcurrentHistologyMouseY,\n\t\t\t\t\timageDimensions.naturalHeight,\n\t\t\t\t\timageDimensions.naturalWidth,\n\t\t\t\t\timageDimensions.scaledHeight,\n\t\t\t\t\timageDimensions.scaledWidth\n\t\t\t\t);\n\n\t\t\tsetScaledHistologyMouseCoords({\n\t\t\t\tmouseX: scaledHistologyMouseX,\n\t\t\t\tmouseY: scaledHistologyMouseY,\n\t\t\t});\n\t\t}\n\t}, [histologyImageCoords, imageDimensions, showHiRes]);\n\n\tconst calculateScaledHistologyMousePos = (\n\t\tnaturalCoordinateX: number,\n\t\tnaturalCoordinateY: number,\n\t\tnaturalHeight: number,\n\t\tnaturalWidth: number,\n\t\tscaledHeight: number,\n\t\tscaledWidth: number\n\t) => {\n\t\tconst scaledHistologyMouseX =\n\t\t\t(scaledWidth / naturalWidth) * naturalCoordinateX;\n\n\t\tconst scaledHistologyMouseY =\n\t\t\t(scaledHeight / naturalHeight) * naturalCoordinateY;\n\n\t\tconsole.log(\n\t\t\t`scaled coord x: ${scaledHistologyMouseX}, scaled coord y: ${scaledHistologyMouseY}`\n\t\t);\n\n\t\treturn { scaledHistologyMouseX, scaledHistologyMouseY };\n\t};\n\n\t// we need to store the image dimensions so that we can correctly calculate the mouse coordinates for scaled images\n\t// we store the image dimensions every time a new image gets loaded\n\tconst onImageLoad = (e: SyntheticEvent, type: string) => {\n\t\tsetIsLoading(false);\n\n\t\tconst { naturalHeight, naturalWidth, scaledHeight, scaledWidth } =\n\t\t\tgetImageDimensions(e, type);\n\n\t\tsetImageDimensions({\n\t\t\tnaturalHeight,\n\t\t\tnaturalWidth,\n\t\t\tscaledHeight,\n\t\t\tscaledWidth,\n\t\t});\n\t};\n\n\t// called when user clicks on a lowRes or hiRes histology image\n\tconst updateHistologyCoordsHandler = (\n\t\te: SyntheticEvent | Event,\n\t\ttype: string\n\t) => {\n\t\tconst { naturalCoordinateX, naturalCoordinateY } = getHistologyMousePos(\n\t\t\te,\n\t\t\ttype\n\t\t);\n\n\t\t// update the atlas based on new histology coords\n\t\thistologyToMri(naturalCoordinateX, naturalCoordinateY);\n\t};\n\n\tconst getHistologyMousePos = (e: SyntheticEvent | Event, type: string) => {\n\t\tconst { mouseX, mouseY } = getMouseCoords(e, showHiRes);\n\n\t\tconsole.log(\"offsetX: \" + mouseX, \"offsetY: \" + mouseY);\n\n\t\tconst { naturalCoordinateX, naturalCoordinateY } =\n\t\t\tcalculateNaturalMouseCoordinates(mouseX, mouseY);\n\n\t\treturn { naturalCoordinateX, naturalCoordinateY };\n\t};\n\n\tconst getImageDimensions = (e: any, type: string) => {\n\t\tlet naturalWidth; // the original size of the image\n\t\tlet naturalHeight; // the original size of the image\n\t\tlet scaledWidth; // the scaled size of the image\n\t\tlet scaledHeight; // the scaled size of the image\n\n\t\tif (type === \"onLoad\" || type === \"lowRes\") {\n\t\t\tnaturalWidth = e.target.naturalWidth;\n\t\t\tnaturalHeight = e.target.naturalHeight;\n\t\t\tscaledWidth = e.target.width;\n\t\t\tscaledHeight = e.target.height;\n\t\t}\n\n\t\tconsole.log(\"naturalWidth: \" + naturalWidth);\n\t\tconsole.log(\"naturalHeight: \" + naturalHeight);\n\t\tconsole.log(\"scaledWidth: \" + scaledWidth);\n\t\tconsole.log(\"scaledHeight: \" + scaledHeight);\n\n\t\treturn {\n\t\t\tnaturalHeight,\n\t\t\tnaturalWidth,\n\t\t\tscaledHeight,\n\t\t\tscaledWidth,\n\t\t};\n\t};\n\n\t// this function allows us to extract the natural x an y mouse coordinates\n\t// accounts for the fact that we set max-height css property on the histology image\n\tconst calculateNaturalMouseCoordinates = (\n\t\toffsetX: number,\n\t\toffsetY: number\n\t) => {\n\t\tconst naturalCoordinateX =\n\t\t\t(imageDimensions!.naturalWidth / imageDimensions!.scaledWidth) * offsetX;\n\n\t\tconst naturalCoordinateY =\n\t\t\t(imageDimensions!.naturalHeight / imageDimensions!.scaledHeight) *\n\t\t\toffsetY;\n\n\t\tconsole.log(\n\t\t\t`natural coord x: ${naturalCoordinateX}, natural coord y: ${naturalCoordinateY}`\n\t\t);\n\n\t\treturn {\n\t\t\tnaturalCoordinateX: naturalCoordinateX,\n\t\t\tnaturalCoordinateY: naturalCoordinateY,\n\t\t};\n\t};\n\n\tif (histologyImageCoords == null) {\n\t\treturn <div>Could not find histology image coords</div>;\n\t}\n\n\tif (histologyImage == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay={false} />}\n\t\t\t\t{!isLoading && <div>Failed to load histology image</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\tif (labelsImage == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay={false} />}\n\t\t\t\t{!isLoading && <div>Failed to load labels</div>}\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"histology-container\">\n\t\t\t\t<div className={`histology-img-container`}>\n\t\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t\t{isLoading && <LoadingSpinner asOverlay />}\n\n\t\t\t\t\t{!showHiRes && scaledHistologyMouseCoords && (\n\t\t\t\t\t\t<MousePointer\n\t\t\t\t\t\t\tmouseY={scaledHistologyMouseCoords.mouseY}\n\t\t\t\t\t\t\tmouseX={scaledHistologyMouseCoords.mouseX}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{!showHiRes && showLabels && (\n\t\t\t\t\t\t<HistologyLabelsImage\n\t\t\t\t\t\t\tlabelsImage={labelsImage}\n\t\t\t\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{!showHiRes && (\n\t\t\t\t\t\t<HistologyLowResImage\n\t\t\t\t\t\t\thistologyImage={histologyImage}\n\t\t\t\t\t\t\tupdateHistologyCoordsHandler={updateHistologyCoordsHandler}\n\t\t\t\t\t\t\tonImageLoad={onImageLoad}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{showHiRes && (\n\t\t\t\t\t\t<HistologyHiResImage\n\t\t\t\t\t\t\thistologyImage={histologyImage}\n\t\t\t\t\t\t\tlabelsImage={labelsImage}\n\t\t\t\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\t\t\t\tshowLabels={showLabels}\n\t\t\t\t\t\t\tupdateHistologyCoordsHandler={updateHistologyCoordsHandler}\n\t\t\t\t\t\t\tonImageLoad={onImageLoad}\n\t\t\t\t\t\t\tscaledHistologyMouseCoords={scaledHistologyMouseCoords}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default HistologyImages;\n","export default class npzAsArrayBuffer {\n\tasync readFileAsync(file) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet reader = new FileReader();\n\n\t\t\treader.onload = () => {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\n\t\t\treader.onerror = reject;\n\n\t\t\treader.readAsArrayBuffer(file);\n\t\t});\n\t}\n\n\tasync load(filename, callback) {\n\t\t/*\n        Loads an array from a stream of bytes.\n        */\n\t\tlet self = this;\n\t\treturn fetch(filename)\n\t\t\t.then((fh) => {\n\t\t\t\tif (fh.ok) {\n\t\t\t\t\treturn fh\n\t\t\t\t\t\t.blob()\n\t\t\t\t\t\t.then((i) => {\n\t\t\t\t\t\t\tvar content = i;\n\n\t\t\t\t\t\t\treturn self.readFileAsync(content).then((res) => {\n\t\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => console.error(err));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => console.error(err));\n\t}\n}\n","// import npyjs from \"npyjs\";\nimport ndarray from \"ndarray\";\nimport JSZip from \"jszip\";\n\nimport { ASSETS_URL } from \"./ASSETS_URL\";\nimport npzAsArrayBuffer from \"./npzAsArrayBuffer\";\n\nimport { HistologyCoords } from \"../../models/histologyCoords.model\";\n\nconst histologyLabelParser = async (\n\tmouseX: number,\n\tmouseY: number,\n\thistologyImageCoords: HistologyCoords,\n\ttype: string,\n\tpatientId: string\n) => {\n\tconst currentLabelNumber = await getCurrentLabelNumber(\n\t\tmouseX,\n\t\tmouseY,\n\t\thistologyImageCoords,\n\t\ttype,\n\t\tpatientId\n\t);\n\n\tconst labelsFile = await require(`../../assets/WholeHemisphereFS.json`);\n\n\tconst currentLabel = labelsFile[currentLabelNumber];\n\n\treturn currentLabel;\n};\n\nconst getCurrentLabelNumber = async (\n\tmouseX: number,\n\tmouseY: number,\n\thistologyImageCoords: HistologyCoords,\n\ttype: string,\n\tpatientId: string\n) => {\n\t// label numbers are extracted from multi dimensional numpy arrays (extracted from compressed npz files)\n\t// the numpy array takes in x and y mouse coordinates to point to an index\n\t// the index returns the label number\n\n\tlet n = new npzAsArrayBuffer();\n\tlet zip = new JSZip();\n\n\tconst paddedBlock = histologyImageCoords.currentHistologyBlock\n\t\t.toString()\n\t\t.padStart(2, \"0\");\n\n\tconst paddedSlice = histologyImageCoords.currentHistologySlice\n\t\t.toString()\n\t\t.padStart(2, \"0\");\n\n\tconst histologyFolder = type === \"lowRes\" ? \"histology\" : \"histology_hr\";\n\n\tconst npzFile = `${ASSETS_URL}${patientId}/${histologyFolder}/${paddedBlock}/slices_labels_npz/slice_${paddedSlice}.npz`;\n\n\tconsole.log(npzFile);\n\n\tconst npzArrayBuffer = await n.load(npzFile); // returns raw contents as an unparsed array buffer\n\n\tconst npzUint8Array = new Uint8Array(npzArrayBuffer); // parse the arrayBuffer as a uint8Array\n\n\tconst loadedZip = await zip.loadAsync(npzUint8Array!); // get all files in the zip\n\n\tconst filesData = Object.entries(loadedZip.files)[0][0]; // the name of the file insise the zip file\n\n\t// parse the loaded zip as an arrayBuffer\n\tconst unzippedArrayBuffer = await loadedZip\n\t\t.file(filesData)!\n\t\t.async(\"arraybuffer\");\n\n\t// we need to parse both the uint8array data and the uint16 array data from the zip\n\t// we get the header info from the unit8 data\n\t// and we get the actual npy array data from the uint16 data\n\n\t// create the header data from the uint8Array data\n\tlet headerData = new Uint8Array(unzippedArrayBuffer);\n\tlet hcontents = new TextDecoder(\"utf-8\").decode(\n\t\tnew Uint8Array(headerData.slice(10, 10 + 118))\n\t);\n\tvar header = JSON.parse(\n\t\thcontents\n\t\t\t.toLowerCase() // True -> true\n\t\t\t.replace(/'/g, '\"')\n\t\t\t.replace(\"(\", \"[\")\n\t\t\t.replace(/,*\\),*/g, \"]\")\n\t);\n\tconsole.log(header);\n\n\t// get the npy array data from the uint16array\n\tlet npyData = new Uint16Array(unzippedArrayBuffer.slice(128));\n\n\t// process the array data accordingly\n\tlet ndArray = ndarray(npyData, header.shape);\n\n\tndArray = await ndArray.transpose(1, 0);\n\n\tconsole.log(mouseX, mouseY);\n\n\tconst currentLabelNumber = ndArray.get(mouseX.toFixed(0), mouseY.toFixed(0));\n\n\tconsole.log(currentLabelNumber);\n\n\treturn currentLabelNumber;\n};\n\nexport default histologyLabelParser;\n","import { FC, useEffect, useState } from \"react\";\n\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport getMouseCoords from \"../../utils/getmouseCoords\";\n\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./HistologyScrollbar.css\";\n\ninterface Props {\n\thistologyImageCoords: HistologyCoords | null;\n\tadjustHistologyCoordsFromScrollbar: (newSliceNumber: number) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst HistologyScrollbar: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [scrollbarPos, setScrollbarPos] = useState(0);\n\n\tconst {\n\t\thistologyImageCoords,\n\t\tadjustHistologyCoordsFromScrollbar,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\tuseEffect(() => {\n\t\t// determine the scrollbar position for the current histology slice\n\n\t\tconst scrollbarLength = 824;\n\t\tconst currentHistologySliceNumber =\n\t\t\thistologyImageCoords!.currentHistologySlice;\n\t\tconst currentBlock = histologyImageCoords!.currentHistologyBlock;\n\t\tconst slicesInBlock =\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock][\n\t\t\t\t\"slices\"\n\t\t\t] - 1; // -1 because slices start at 0\n\t\tconst currentSliceAsProportion =\n\t\t\tcurrentHistologySliceNumber / slicesInBlock;\n\n\t\tconst newHistologyScrollbarPos = +(\n\t\t\tscrollbarLength * currentSliceAsProportion\n\t\t).toFixed(0);\n\n\t\tsetScrollbarPos(newHistologyScrollbarPos);\n\t}, [histologyImageCoords, atlasImagesDimensionsKey]);\n\n\tconst updateHistologyScrollbarPos = (e: React.MouseEvent) => {\n\t\tsetShowHiRes(false);\n\n\t\tconst { mouseY } = getMouseCoords(e, showHiRes);\n\n\t\tconst currentBlock = histologyImageCoords!.currentHistologyBlock;\n\n\t\t// -1 to account for the fact that slices start at 0\n\t\tconst slicesInBlock =\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock][\n\t\t\t\t\"slices\"\n\t\t\t] - 1;\n\n\t\t// look into improving this, is it necessary to hard code this value? Same for the mri scrollbars\n\t\tconst scrollbarLength = 824;\n\n\t\t// method for positioning the scrollbar based on the max number of slices in a histology block\n\t\tconst newHistologySliceNumber = (mouseY / scrollbarLength) * slicesInBlock;\n\n\t\t// need to reduce this repetition across the other function\n\t\tif (\n\t\t\tnewHistologySliceNumber < 0 ||\n\t\t\tnewHistologySliceNumber > slicesInBlock\n\t\t) {\n\t\t\tconsole.log(\"cannot increment histology slice\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tadjustHistologyCoordsFromScrollbar(newHistologySliceNumber);\n\t\t} catch {\n\t\t\tconsole.log(\"error found when adjusting histology scrollbar\");\n\t\t}\n\t};\n\n\tconst incrementHistologyScrollbarPos = (increment: number) => {\n\t\tsetShowHiRes(false);\n\n\t\tconst currentBlock = histologyImageCoords!.currentHistologyBlock;\n\t\tconst slicesInBlock =\n\t\t\t+atlasImagesDimensionsKey!.histologyLowResDimensions[currentBlock][\n\t\t\t\t\"slices\"\n\t\t\t] - 1;\n\n\t\tconst currentHistologySliceNumber =\n\t\t\thistologyImageCoords!.currentHistologySlice;\n\t\tconst newHistologySliceNumber = currentHistologySliceNumber + increment;\n\n\t\tif (\n\t\t\tnewHistologySliceNumber < 0 ||\n\t\t\tnewHistologySliceNumber > slicesInBlock\n\t\t) {\n\t\t\tconsole.log(\"cannot increment histology slice\");\n\t\t\treturn;\n\t\t}\n\n\t\tadjustHistologyCoordsFromScrollbar(newHistologySliceNumber);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t<div className=\"histology-scrollbar-container\">\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"histology-scrollbar-increment-btn up\"\n\t\t\t\t\tonClick={() => incrementHistologyScrollbarPos(-1)}\n\t\t\t\t></div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"scrollbar histology-scrollbar\"\n\t\t\t\t\tonClick={(e) => updateHistologyScrollbarPos(e)}\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclassName=\"histology-scrollbar-widget\"\n\t\t\t\t\t\tstyle={{ top: `${scrollbarPos}px` }}\n\t\t\t\t\t></svg>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"histology-scrollbar-increment-btn down\"\n\t\t\t\t\tonClick={() => incrementHistologyScrollbarPos(1)}\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default HistologyScrollbar;\n","import { FC } from \"react\";\n\nimport HistologyScrollbar from \"./HistologyScrollbar\";\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./Scrollbars.css\";\n\ninterface Props {\n\thistologyImageCoords: HistologyCoords | null;\n\tadjustHistologyCoordsFromScrollbar: (newSliceNumber: number) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst Scrollbars: FC<Props> = (props) => {\n\tconst {\n\t\thistologyImageCoords,\n\t\tadjustHistologyCoordsFromScrollbar,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\treturn (\n\t\t<HistologyScrollbar\n\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\tadjustHistologyCoordsFromScrollbar={adjustHistologyCoordsFromScrollbar}\n\t\t\tshowHiRes={showHiRes}\n\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t/>\n\t);\n};\n\nexport default Scrollbars;\n","import { FC, useState, useEffect, useCallback } from \"react\";\n\nimport calculateMriImageCoords from \"../../utils/calculateMriImageCoords\";\nimport calculateHistologyImageCoords from \"../../utils/calculateHistologyImageCoords\";\nimport calculateAdjustedMriCoords from \"../../utils/calculateAdjustedMriCoords\";\nimport logMriCoordsForDebugging from \"../../utils/logMriCoordsForDebugging\";\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\nimport ErrorModal from \"../../shared/ErrorModal\";\nimport MriImages from \"./MriImages\";\nimport HistologyImageContainer from \"./HistologyImages\";\nimport getMatrix from \"../../utils/getMatrix\";\nimport matrixMultiplier from \"../../utils/matrixMultiplier\";\nimport histologyLabelParser from \"../../utils/histologyLabelParser\";\nimport Scrollbars from \"../scrollbars/Scrollbars\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\nimport { MriCoords } from \"../../../models/mriCoords.model\";\nimport { HistologyCoords } from \"../../../models/histologyCoords.model\";\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\nimport { AtlasImagesDimensionsKey } from \"../../../models/atlasImagesDimensionsKey.model\";\n\nimport \"./AtlasImages.css\";\n\ninterface Props {\n\tpatientId: string;\n\tchannel: string;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tsetCurrentLabel: (currentLabel: CurrentLabel | null) => void;\n\tnavPanelCoords: NavPanelCoords | null;\n\tatlasImagesDimensionsKey: AtlasImagesDimensionsKey | null;\n}\n\nconst AtlasImages: FC<Props> = (props) => {\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [mriImageCoords, setMriImageCoords] = useState<MriCoords | null>(null);\n\tconst [histologyImageCoords, setHistologyImageCoords] =\n\t\tuseState<HistologyCoords | null>(null);\n\n\tconsole.log(mriImageCoords);\n\n\tconst {\n\t\tpatientId,\n\t\tchannel,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tshowLabels,\n\t\tlabelsTransparency,\n\t\tsetCurrentLabel,\n\t\tnavPanelCoords,\n\t\tatlasImagesDimensionsKey,\n\t} = props;\n\n\tconst updateMriAndHistologyImages = async (\n\t\tcurrentMriPlane: string,\n\t\tcurrentMriSlice: number,\n\t\tcurrentMriMouseX: number,\n\t\tcurrentMriMouseY: number,\n\t\tpatientId: string\n\t) => {\n\t\t// user is navigating within an mri image\n\t\t// function updates mri image coords and then calculates new histology coords\n\n\t\tconst newMriCoords = updateMriImagesHandler(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriSlice,\n\t\t\tcurrentMriMouseX,\n\t\t\tcurrentMriMouseY\n\t\t);\n\n\t\tupdateHistologyImagesHandler(currentMriPlane, newMriCoords!, patientId);\n\t};\n\n\tconst updateHistologyImagesHandler = async (\n\t\tcurrentMriPlane: string,\n\t\tnewMriCoords: MriCoords,\n\t\tpatientId: string\n\t) => {\n\t\tconst newHistologyCoords = await calculateHistologyImageCoords(\n\t\t\tcurrentMriPlane,\n\t\t\tnewMriCoords!,\n\t\t\tpatientId,\n\t\t\tatlasImagesDimensionsKey\n\t\t);\n\t\tconsole.log(\"histology image coords: \", newHistologyCoords);\n\n\t\tif (newHistologyCoords === \"no block found\") {\n\t\t\tsetError(\"No block found for this coordinate\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (newHistologyCoords === \"no matrix found\") {\n\t\t\tsetError(\"No matrix found for this coordinate\");\n\t\t\treturn;\n\t\t}\n\n\t\tsetHistologyImageCoords(newHistologyCoords);\n\t};\n\n\tconst updateMriImagesHandler = (\n\t\tcurrentMriPlane: string,\n\t\tcurrentMriSlice: number,\n\t\tcurrentMriMouseX: number,\n\t\tcurrentMriMouseY: number\n\t) => {\n\t\tconsole.log(\"BUILDING MRI IMAGES\");\n\n\t\tconst { adjustedMriSlice, adjustedMriMouseX, adjustedMriMouseY } =\n\t\t\tcalculateAdjustedMriCoords(\n\t\t\t\tcurrentMriPlane,\n\t\t\t\tcurrentMriSlice,\n\t\t\t\tcurrentMriMouseX,\n\t\t\t\tcurrentMriMouseY,\n\t\t\t\tatlasImagesDimensionsKey\n\t\t\t);\n\n\t\tlogMriCoordsForDebugging(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriSlice,\n\t\t\tcurrentMriMouseX,\n\t\t\tcurrentMriMouseY,\n\t\t\tadjustedMriSlice!,\n\t\t\tadjustedMriMouseX!,\n\t\t\tadjustedMriMouseY!\n\t\t);\n\n\t\tconst newMriCoords = calculateMriImageCoords(\n\t\t\tcurrentMriPlane,\n\t\t\tcurrentMriSlice,\n\t\t\tcurrentMriMouseX,\n\t\t\tcurrentMriMouseY,\n\t\t\tadjustedMriSlice!,\n\t\t\tadjustedMriMouseX!,\n\t\t\tadjustedMriMouseY!\n\t\t);\n\n\t\tsetMriImageCoords(newMriCoords!); // refactor this to check that the mriImage is valid\n\n\t\treturn newMriCoords;\n\t};\n\n\tconst setCurrentLabelHandler = useCallback(\n\t\tasync (\n\t\t\tcurrentHistologyMouseX: number,\n\t\t\tcurrentHistologyMouseY: number,\n\t\t\thistologyImageCoords: HistologyCoords,\n\t\t\ttype: string\n\t\t) => {\n\t\t\t// loading spinner shows while the label is loading\n\t\t\tsetCurrentLabel(null);\n\n\t\t\tconst currentLabel = await histologyLabelParser(\n\t\t\t\tcurrentHistologyMouseX,\n\t\t\t\tcurrentHistologyMouseY,\n\t\t\t\thistologyImageCoords,\n\t\t\t\ttype,\n\t\t\t\tpatientId\n\t\t\t);\n\n\t\t\tsetCurrentLabel(currentLabel);\n\t\t},\n\t\t[setCurrentLabel, patientId]\n\t);\n\n\t// initialize mri panels based on an arbitrary starting point\n\tuseEffect(() => {\n\t\tconst buildAtlas = async () => {\n\t\t\tsetIsLoading(true);\n\t\t\ttry {\n\t\t\t\t// args: plane, slice, currentMriMouseX, currentMriMouseY\n\t\t\t\t// I should pass the argument as an object to make it more clear\n\t\t\t\tawait updateMriAndHistologyImages(\"axial\", 124, 149, 357, patientId);\n\t\t\t} catch {\n\t\t\t\tsetError(\"error building atlas\");\n\t\t\t}\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tbuildAtlas();\n\t}, [patientId]);\n\n\t// sets the current label every time new coords are detected\n\t// needs refactoring\n\tuseEffect(() => {\n\t\tconst type = showHiRes ? \"hiRes\" : \"lowRes\";\n\n\t\t// why am I passing both histologyImageCoords and the embedded mouseX and mouseY?\n\t\t// I should just pass histologyImageCoords\n\t\tif (histologyImageCoords !== null && mriImageCoords !== null) {\n\t\t\tif (!showHiRes) {\n\t\t\t\tconsole.log(histologyImageCoords);\n\n\t\t\t\tsetCurrentLabelHandler(\n\t\t\t\t\thistologyImageCoords.coordsLowRes.mouseX,\n\t\t\t\t\thistologyImageCoords.coordsLowRes.mouseY,\n\t\t\t\t\thistologyImageCoords,\n\t\t\t\t\ttype\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (showHiRes) {\n\t\t\t\tsetCurrentLabelHandler(\n\t\t\t\t\thistologyImageCoords.coordsHiRes.mouseX,\n\t\t\t\t\thistologyImageCoords.coordsHiRes.mouseY,\n\t\t\t\t\thistologyImageCoords,\n\t\t\t\t\ttype\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}, [histologyImageCoords, mriImageCoords, setCurrentLabelHandler, showHiRes]);\n\n\t// sets the mri and histology coords when navigating from the drop-down list\n\tuseEffect(() => {\n\t\tif (navPanelCoords != null) {\n\t\t\tconst resultX = navPanelCoords.resultX;\n\t\t\tconst resultY = navPanelCoords.resultY;\n\t\t\tconst resultZ = navPanelCoords.resultZ;\n\n\t\t\tupdateMriAndHistologyImages(\n\t\t\t\t\"axial\",\n\t\t\t\t+resultZ.toFixed(0),\n\t\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t\t+resultX.toFixed(0),\n\t\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t\t+resultY.toFixed(0),\n\t\t\t\tpatientId\n\t\t\t);\n\t\t}\n\t}, [navPanelCoords, patientId, atlasImagesDimensionsKey]);\n\n\tconst histologyToMri = async (\n\t\tcurrentHistologyMouseX: number,\n\t\tcurrentHistologyMouseY: number\n\t) => {\n\t\t// first we calculate new mri coords based on the current histology coords\n\t\t// then below we set the current histology coords based on the mouseX and mouseY positions\n\n\t\tconst histologyFolder = showHiRes ? \"histology_hr\" : \"histology\";\n\n\t\tconst matrix = await getMatrix(\n\t\t\thistologyImageCoords!.currentHistologyBlock,\n\t\t\thistologyFolder,\n\t\t\tpatientId\n\t\t);\n\n\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\tcurrentHistologyMouseY,\n\t\t\tcurrentHistologyMouseX,\n\t\t\thistologyImageCoords!.currentHistologySlice,\n\t\t\t1,\n\t\t]);\n\n\t\tconst { resultX, resultY, resultZ } = singleMriCoord;\n\n\t\tconsole.log(resultX, resultY, resultZ);\n\n\t\tupdateMriImagesHandler(\n\t\t\t\"axial\",\n\t\t\t+resultZ.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t+resultX.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t+resultY.toFixed(0)\n\t\t);\n\n\t\t// calculate new histology coords\n\t\tconst newHistologyCoords = { ...histologyImageCoords };\n\n\t\tif (showHiRes) {\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseX = currentHistologyMouseX;\n\t\t\tnewHistologyCoords.coordsHiRes!.mouseY = currentHistologyMouseY;\n\t\t} else {\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseX = currentHistologyMouseX;\n\t\t\tnewHistologyCoords.coordsLowRes!.mouseY = currentHistologyMouseY;\n\t\t}\n\n\t\tsetHistologyImageCoords(newHistologyCoords as HistologyCoords);\n\t};\n\n\tconst adjustHistologyCoordsFromScrollbar = async (newSliceNumber: number) => {\n\t\tconst matrix = await getMatrix(\n\t\t\thistologyImageCoords!.currentHistologyBlock,\n\t\t\t\"histology\",\n\t\t\tpatientId\n\t\t);\n\n\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\thistologyImageCoords!.coordsLowRes.mouseY,\n\t\t\thistologyImageCoords!.coordsLowRes.mouseX,\n\t\t\t+newSliceNumber.toFixed(0),\n\t\t\t1,\n\t\t]);\n\n\t\tconst { resultX, resultY, resultZ } = singleMriCoord;\n\n\t\tupdateMriImagesHandler(\n\t\t\t\"axial\",\n\t\t\t+resultZ.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.width -\n\t\t\t\t+resultX.toFixed(0),\n\t\t\t+atlasImagesDimensionsKey!.mriDimensions.axial.height -\n\t\t\t\t+resultY.toFixed(0)\n\t\t);\n\n\t\tconst newHistologyCoords = { ...histologyImageCoords };\n\t\tnewHistologyCoords.currentHistologySlice = +newSliceNumber.toFixed(0);\n\n\t\tsetHistologyImageCoords(newHistologyCoords as HistologyCoords);\n\t};\n\n\tif (mriImageCoords == null || histologyImageCoords == null) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay />}\n\t\t\t\t<div>Builing atlas, please wait...</div>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"atlas-imgs-container\">\n\t\t\t<ErrorModal error={error} onClear={() => setError(null)} />\n\t\t\t{isLoading && <LoadingSpinner asOverlay />}\n\n\t\t\t<MriImages\n\t\t\t\tpatientId={patientId}\n\t\t\t\tmriImageCoords={mriImageCoords}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tupdateMriAndHistologyImages={updateMriAndHistologyImages}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\n\t\t\t<HistologyImageContainer\n\t\t\t\tpatientId={patientId}\n\t\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\t\tchannel={channel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\thistologyToMri={histologyToMri}\n\t\t\t/>\n\n\t\t\t<Scrollbars\n\t\t\t\thistologyImageCoords={histologyImageCoords}\n\t\t\t\tadjustHistologyCoordsFromScrollbar={adjustHistologyCoordsFromScrollbar}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default AtlasImages;\n","import { FC } from \"react\";\n\nimport \"./PatientSelect.css\";\n\ninterface Props {\n\tpatientId: string;\n\tsetPatientId: (patientId: string) => void;\n}\n\nconst PatientSelect: FC<Props> = (props) => {\n\tconst { patientId, setPatientId } = props;\n\n\treturn (\n\t\t<div className=\"patient-select-container\">\n\t\t\tSelect Case:\n\t\t\t<select\n\t\t\t\tname=\"patient-select\"\n\t\t\t\tid=\"patient-select\"\n\t\t\t\tclassName=\"patient-select-picker\"\n\t\t\t\tvalue={patientId}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tsetPatientId(e.target.value);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<option value=\"BrainAtlas-P57-16/main/P57-16\">P57-16</option>\n\t\t\t\t<option disabled value=\"BrainAtlas-P41-16/main/P41-16\">\n\t\t\t\t\tP41-16\n\t\t\t\t</option>\n\t\t\t\t<option disabled value=\"BrainAtlas-P58-16/main/P58-16\">\n\t\t\t\t\tP58-16\n\t\t\t\t</option>\n\t\t\t\t<option disabled value=\"BrainAtlas-P85-18/main/P85-18\">\n\t\t\t\t\tP85-18\n\t\t\t\t</option>\n\t\t\t\t<option disabled value=\"BrainAtlas-EX-19/main/EX-19\">\n\t\t\t\t\tEX-19\n\t\t\t\t</option>\n\t\t\t</select>\n\t\t</div>\n\t);\n};\n\nexport default PatientSelect;\n","import { FC, memo, useEffect, useState } from \"react\";\nimport DropdownTreeSelect from \"react-dropdown-tree-select\";\n\nimport { ASSETS_URL } from \"../../utils/ASSETS_URL\";\n\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\n\nimport \"react-dropdown-tree-select/dist/styles.css\";\nimport \"./AtlasNavigation.css\";\n\ninterface Props {\n\tpatientId: string;\n\tgetNavPanelCoords: (navPanelCoords: NavPanelCoords) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n}\n\nconst AtlasNavigation: FC<Props> = (props) => {\n\tconst [atlasNavigationData, setAtlasNavigationData] = useState<any>(null);\n\n\tconst { patientId, getNavPanelCoords, showHiRes, setShowHiRes } = props;\n\n\tuseEffect(() => {\n\t\tconst getAtlasNavigationData = async () => {\n\t\t\tconst dataUrl = `${ASSETS_URL}${patientId}/image_ontology_hierarchical.json`;\n\n\t\t\tconst file = await fetch(dataUrl);\n\n\t\t\tconst parsedFile = await file.json();\n\n\t\t\tsetAtlasNavigationData(parsedFile);\n\t\t};\n\n\t\tgetAtlasNavigationData();\n\t}, [patientId]);\n\n\tconst onChange = (currentNode: any, selectedNodes: any) => {\n\t\tif (showHiRes) setShowHiRes(false);\n\n\t\tconst currentNodeData = currentNode.data;\n\n\t\tif (currentNodeData === undefined) {\n\t\t\tconsole.log(\"navigation coords could not be found\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tgetNavPanelCoords(currentNodeData);\n\t\t} catch {\n\t\t\tconsole.log(\"error, no valid navigation coords returned\");\n\t\t}\n\t};\n\n\tconst onAction = (node: any, action: any) => {\n\t\tconsole.log(\"onAction::\", action, node);\n\t};\n\n\tconst onNodeToggle = (currentNode: any) => {\n\t\tconsole.log(\"onNodeToggle::\", currentNode);\n\t};\n\n\tif (atlasNavigationData == null) {\n\t\treturn <div>Could not find navigation data</div>;\n\t}\n\n\treturn (\n\t\t<DropdownTreeSelect\n\t\t\tclassName=\"atlas-navigation\"\n\t\t\tdata={atlasNavigationData}\n\t\t\tonChange={onChange}\n\t\t\tonAction={onAction}\n\t\t\tonNodeToggle={onNodeToggle}\n\t\t\tkeepTreeOnSearch\n\t\t\tkeepOpenOnSelect\n\t\t\tmode=\"radioSelect\"\n\t\t\tinlineSearchInput\n\t\t\ttexts={{ placeholder: \"Navigate Atlas\" }}\n\t\t/>\n\t);\n};\n\nexport default memo(AtlasNavigation);\n","import { FC } from \"react\";\n\nimport \"./LabelsBtn.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tsetShowLabels: (showLabels: boolean) => void;\n}\n\nconst LabelsBtn: FC<Props> = (props) => {\n\tconst { showLabels, setShowLabels } = props;\n\n\treturn (\n\t\t<button\n\t\t\tonClick={() => setShowLabels(!showLabels)}\n\t\t\tclassName=\"show-labels-btn\"\n\t\t>\n\t\t\t{showLabels ? \"Hide\" : \"Show\"} labels\n\t\t</button>\n\t);\n};\n\nexport default LabelsBtn;\n","import { FC } from \"react\";\n\nimport \"./TransparencySlider.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tlabelsTransparency: string;\n\tsetLabelsTransparency: (labelsTransparency: string) => void;\n}\n\nconst TransparencySlider: FC<Props> = (props) => {\n\tconst { showLabels, labelsTransparency, setLabelsTransparency } = props;\n\n\tif (!showLabels) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"transparency-slider-container\">\n\t\t\t<span>Adjust label transparency</span>\n\t\t\t<input\n\t\t\t\ttype=\"range\"\n\t\t\t\tname=\"labels-transparency\"\n\t\t\t\tid=\"labels-transparency\"\n\t\t\t\tclassName=\"labels-transparency-slider\"\n\t\t\t\tvalue={labelsTransparency}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tsetLabelsTransparency(e.target.value);\n\t\t\t\t}}\n\t\t\t\tmin=\"0\"\n\t\t\t\tmax=\"1\"\n\t\t\t\tstep=\"0.01\"\n\t\t\t\tdisabled={showLabels ? false : true}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default TransparencySlider;\n","import { FC, useState, useEffect } from \"react\";\n\nimport LoadingSpinner from \"../../shared/LoadingSpinner\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\n\nimport \"./Label.css\";\n\ninterface Props {\n\tshowLabels: boolean;\n\tcurrentLabel: CurrentLabel | null;\n}\n\nconst Label: FC<Props> = (props) => {\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst { showLabels, currentLabel } = props;\n\n\tuseEffect(() => {\n\t\t// show a loading spinner while the label is being fetched\n\t\tcurrentLabel === null ? setIsLoading(true) : setIsLoading(false);\n\t}, [currentLabel]);\n\n\tif (!showLabels) {\n\t\treturn null;\n\t}\n\n\tif (currentLabel === null) {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{isLoading && <LoadingSpinner asOverlay={false} />}\n\t\t\t\tFetching label\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (currentLabel === undefined) {\n\t\treturn <div>no label found</div>;\n\t}\n\n\t// make the label an object so it is more clear what its contents are\n\treturn (\n\t\t<div className=\"label-container\">\n\t\t\t{currentLabel != null && (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"label-heading\">Current Label</div>\n\n\t\t\t\t\t<div className=\"label-name\">Label name: {currentLabel.labelName}</div>\n\n\t\t\t\t\t<div className=\"label-color-container\">\n\t\t\t\t\t\t<span> Label color: </span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclassName=\"label-color-box\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tbackgroundColor: `rgba(${currentLabel.r},\n\t\t\t\t\t\t\t\t${currentLabel.g},\n\t\t\t\t\t\t\t\t${currentLabel.b},\n\t\t\t\t\t\t\t\t100\n\t\t\t\t\t\t\t)`,\n\t\t\t\t\t\t\t\tmarginBottom: \"10px\",\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default Label;\n","import { FC } from \"react\";\n\nimport \"./ImageChannels.css\";\n\ninterface Props {\n\tchannel: string;\n\tsetChannel: (channel: string) => void; // review this type, is this correct?? check the react course\n\tshowHiRes: boolean;\n}\n\nconst ImageChannels: FC<Props> = (props) => {\n\tconst { channel, setChannel, showHiRes } = props;\n\n\treturn (\n\t\t<div className=\"image-channels-container\">\n\t\t\tSelect histological stain or MRI:\n\t\t\t<select\n\t\t\t\tname=\"channels\"\n\t\t\t\tid=\"channels\"\n\t\t\t\tclassName=\"image-channel-picker\"\n\t\t\t\tvalue={channel}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tsetChannel(e.target.value);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<option value=\"LFB\">LFB</option>\n\t\t\t\t<option value=\"HE\">HE</option>\n\t\t\t\t<option disabled={showHiRes} value=\"MRI\">\n\t\t\t\t\tMRI\n\t\t\t\t</option>\n\t\t\t</select>\n\t\t</div>\n\t);\n};\n\nexport default ImageChannels;\n","import { FC } from \"react\";\n\nimport \"./HiResBtn.css\";\n\ninterface Props {\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tchannel: string;\n}\n\nconst HiResBtn: FC<Props> = (props) => {\n\tconst { showHiRes, setShowHiRes, channel } = props;\n\n\treturn (\n\t\t<div className=\"hi-res-btn-container\">\n\t\t\t<button\n\t\t\t\tclassName=\"hi-res btn\"\n\t\t\t\tonClick={() => setShowHiRes(!showHiRes)}\n\t\t\t\tdisabled={channel === \"MRI\"}\n\t\t\t>\n\t\t\t\t{showHiRes ? \"Hide\" : \"Show\"} hi-res histology\n\t\t\t</button>\n\t\t</div>\n\t);\n};\n\nexport default HiResBtn;\n","import { FC } from \"react\";\n\nimport PatientSelect from \"./PatientSelect\";\nimport AtlasNavigation from \"./AtlasNavigation\";\nimport LabelsBtn from \"./LabelsBtn\";\nimport TransparencySlider from \"./TransparencySlider\";\nimport Label from \"./Label\";\nimport ImageChannels from \"./ImageChannels\";\nimport HiResBtn from \"./HiResBtn\";\n\nimport { CurrentLabel } from \"../../../models/label.model\";\nimport { NavPanelCoords } from \"../../../models/navPanelCoords.model\";\n\nimport \"./AtlasOptions.css\";\n\ninterface Props {\n\tpatientId: string;\n\tsetPatientId: (patientId: string) => void;\n\tchannel: string;\n\tsetChannel: (channel: string) => void;\n\tshowHiRes: boolean;\n\tsetShowHiRes: (showHiRes: boolean) => void;\n\tshowLabels: boolean;\n\tsetShowLabels: (showLabels: boolean) => void;\n\tlabelsTransparency: string;\n\tsetLabelsTransparency: (labelsTransparency: string) => void;\n\tcurrentLabel: CurrentLabel | null;\n\tgetNavPanelCoords: (navPanelCoords: NavPanelCoords) => void;\n}\n\nconst AtlasOptions: FC<Props> = (props) => {\n\tconst {\n\t\tpatientId,\n\t\tsetPatientId,\n\t\tchannel,\n\t\tsetChannel,\n\t\tshowHiRes,\n\t\tsetShowHiRes,\n\t\tshowLabels,\n\t\tsetShowLabels,\n\t\tlabelsTransparency,\n\t\tsetLabelsTransparency,\n\t\tcurrentLabel,\n\t\tgetNavPanelCoords,\n\t} = props;\n\n\treturn (\n\t\t<div className=\"options-container\">\n\t\t\t<PatientSelect patientId={patientId} setPatientId={setPatientId} />\n\n\t\t\t<AtlasNavigation\n\t\t\t\tpatientId={patientId}\n\t\t\t\tgetNavPanelCoords={getNavPanelCoords}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t/>\n\n\t\t\t<ImageChannels\n\t\t\t\tchannel={channel}\n\t\t\t\tsetChannel={setChannel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t/>\n\n\t\t\t<LabelsBtn showLabels={showLabels} setShowLabels={setShowLabels} />\n\n\t\t\t<Label showLabels={showLabels} currentLabel={currentLabel} />\n\n\t\t\t<TransparencySlider\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetLabelsTransparency={setLabelsTransparency}\n\t\t\t/>\n\n\t\t\t<HiResBtn\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tchannel={channel}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default AtlasOptions;\n","import { FC, useState, useCallback, useEffect } from \"react\";\n\nimport AtlasImages from \"../components/atlas/atlasImages/AtlasImages\";\nimport AtlasOptions from \"../components/atlas/atlasOptions/AtlasOptions\";\n//import Scrollbars from \"../components/atlas/scrollbars/Scrollbars\";\nimport getMatrix from \"../components/utils/getMatrix\";\nimport matrixMultiplier from \"../components/utils/matrixMultiplier\";\nimport { ASSETS_URL } from \"../components/utils/ASSETS_URL\";\n\nimport { CurrentLabel } from \"../models/label.model\";\nimport { AtlasImagesDimensionsKey } from \"../models/atlasImagesDimensionsKey.model\";\nimport { NavPanelCoords } from \"../models/navPanelCoords.model\";\n\nimport \"./Atlas.css\";\n\nconst Atlas: FC = () => {\n\tconst [patientId, setPatientId] = useState(\"BrainAtlas-P57-16/main/P57-16\");\n\tconst [channel, setChannel] = useState(\"LFB\");\n\tconst [showHiRes, setShowHiRes] = useState(false);\n\tconst [showLabels, setShowLabels] = useState(false);\n\tconst [labelsTransparency, setLabelsTransparency] = useState(\"0.5\");\n\tconst [currentLabel, setCurrentLabel] = useState<CurrentLabel | null>(null);\n\tconst [navPanelCoords, setNavPanelCoords] = useState<NavPanelCoords | null>(\n\t\tnull\n\t);\n\tconst [atlasImagesDimensionsKey, setAtlasImagesDimensionsKey] =\n\t\tuseState<AtlasImagesDimensionsKey | null>(null);\n\n\t// loads in some helper files at app start-up\n\tuseEffect(() => {\n\t\tconst getAtlasImageDimensionsFiles = async () => {\n\t\t\tconst mriDimensionsKeyUrl = `${ASSETS_URL}${patientId}/mriDimensionsKey.json`;\n\t\t\tconst histologyLowResDimensionsKeyUrl = `${ASSETS_URL}${patientId}/histologyDimensionsKey.json`;\n\t\t\tconst histologyHiResDimensionsKeyUrl = `${ASSETS_URL}${patientId}/histologyHRDimensionsKey.json`;\n\n\t\t\tconst mriDimensionsKeyFile = await (\n\t\t\t\tawait fetch(mriDimensionsKeyUrl)\n\t\t\t).json();\n\n\t\t\tconst histologyLowResDimensionsKeyFile = await (\n\t\t\t\tawait fetch(histologyLowResDimensionsKeyUrl)\n\t\t\t).json();\n\n\t\t\tconst histologyHiResDimensionsKeyFile = await (\n\t\t\t\tawait fetch(histologyHiResDimensionsKeyUrl)\n\t\t\t).json();\n\n\t\t\tconst atlasImagesDimensionsKey = {\n\t\t\t\tmriDimensions: mriDimensionsKeyFile,\n\t\t\t\thistologyLowResDimensions: histologyLowResDimensionsKeyFile,\n\t\t\t\thistologyHiResDimensions: histologyHiResDimensionsKeyFile,\n\t\t\t};\n\n\t\t\tsetAtlasImagesDimensionsKey(atlasImagesDimensionsKey);\n\t\t};\n\n\t\tgetAtlasImageDimensionsFiles();\n\t}, [patientId]);\n\n\t// useCallback prevents unnecessary re-render of child component (AtlasNavigation.tsx)\n\tconst getNavPanelCoords = useCallback(\n\t\tasync (navPanelCoords: NavPanelCoords) => {\n\t\t\tconsole.log(navPanelCoords);\n\n\t\t\tconst matrix = await getMatrix(\n\t\t\t\tnavPanelCoords!.blockNumber,\n\t\t\t\t\"histology\",\n\t\t\t\tpatientId\n\t\t\t);\n\n\t\t\t// why is the order of params here different compared to the function that handles physical clicks?\n\t\t\t// the x and y are swapped here compared to the histologyToMri function\n\t\t\t// there must be some sort of flipping of axes somewhere\n\t\t\t// regardless, the app seems to work with this configuration\n\t\t\tconst singleMriCoord = matrixMultiplier(matrix, [\n\t\t\t\tnavPanelCoords!.xh,\n\t\t\t\tnavPanelCoords!.yh,\n\t\t\t\tnavPanelCoords!.zh,\n\t\t\t\t1,\n\t\t\t]);\n\n\t\t\tsetNavPanelCoords(singleMriCoord);\n\t\t},\n\t\t[patientId]\n\t);\n\n\tif (atlasImagesDimensionsKey == null) {\n\t\treturn <div>Loading atlas assets, this might take a few seconds...</div>;\n\t}\n\n\treturn (\n\t\t<main className=\"atlas-container\">\n\t\t\t<AtlasImages\n\t\t\t\tpatientId={patientId}\n\t\t\t\tchannel={channel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetCurrentLabel={setCurrentLabel}\n\t\t\t\tnavPanelCoords={navPanelCoords}\n\t\t\t\tatlasImagesDimensionsKey={atlasImagesDimensionsKey}\n\t\t\t/>\n\n\t\t\t<AtlasOptions\n\t\t\t\tpatientId={patientId}\n\t\t\t\tsetPatientId={setPatientId}\n\t\t\t\tchannel={channel}\n\t\t\t\tsetChannel={setChannel}\n\t\t\t\tshowHiRes={showHiRes}\n\t\t\t\tsetShowHiRes={setShowHiRes}\n\t\t\t\tshowLabels={showLabels}\n\t\t\t\tsetShowLabels={setShowLabels}\n\t\t\t\tlabelsTransparency={labelsTransparency}\n\t\t\t\tsetLabelsTransparency={setLabelsTransparency}\n\t\t\t\tcurrentLabel={currentLabel}\n\t\t\t\tgetNavPanelCoords={getNavPanelCoords}\n\t\t\t/>\n\n\t\t\t{/* ideally, scrollbars should go here */}\n\t\t\t{/* <Scrollbars\n\t\t\t\tscrollbarPos={scrollbarPos}\n\t\t\t\tsetScrollbarPos={setScrollbarPos}\n\t\t\t\thistologyScrollbarPos={histologyScrollbarPos}\n\t\t\t\tsetHistologyScrollbarPos={setHistologyScrollbarPos}\n\t\t\t/> */}\n\t\t</main>\n\t);\n};\n\nexport default Atlas;\n","import { FC, useEffect } from \"react\";\n\nimport npyjs from \"npyjs\";\nimport ndarray from \"ndarray\";\n\nimport pako from \"pako\";\nimport JSZip from \"jszip\";\n\nimport parseNpy from \"../components/utils/parseNpy\";\nimport npzAsArrayBuffer from \"../components/utils/npzAsArrayBuffer\";\n\nconst Atlas: FC = () => {\n\t// testing out zipping a .npy file\n\t// useEffect(() => {\n\t// \tconst runZipTest = async () => {\n\t// \t\t// this function takes an uncompressed .npy file, zips it, unzips it, and then inspects the contents\n\t// \t\t// this is a proof of concept to show that we can process zipped npy files\n\t// \t\t// as a last resort, all of the .npy files could be zipped by us in node.js\n\n\t// \t\tlet n = new zipTest();\n\n\t// \t\t// load an uncompressed file\n\t// \t\tlet file = await require(`../assets/zip_test/final_test/slice_02_big.npy`)\n\t// \t\t\t.default;\n\n\t// \t\tconst parsedFile = await n.load(file); // returns an unparsed uint8Array (so just the full raw contents)\n\n\t// \t\tconsole.log(parsedFile);\n\n\t// \t\ttry {\n\t// \t\t\t// zip the uncompressed npy file\n\t// \t\t\tconst compressedFile = pako.deflate(parsedFile);\n\t// \t\t\tconsole.log(compressedFile);\n\n\t// \t\t\tlet contents2 = new TextDecoder(\"utf-8\").decode(\n\t// \t\t\t\tnew Uint8Array(compressedFile.slice(0, 100))\n\t// \t\t\t);\n\t// \t\t\tconsole.log(contents2);\n\n\t// \t\t\t// unzip the file\n\t// \t\t\tconst uncompressedFile = pako.inflate(compressedFile);\n\t// \t\t\tconsole.log(uncompressedFile);\n\n\t// \t\t\t// inspect its raw contents\n\t// \t\t\tlet contents = new TextDecoder(\"utf-8\").decode(\n\t// \t\t\t\tnew Uint8Array(uncompressedFile.slice(0, 100))\n\t// \t\t\t);\n\t// \t\t\tconsole.log(contents);\n\t// \t\t} catch (err) {\n\t// \t\t\tconsole.log(err);\n\t// \t\t}\n\t// \t};\n\n\t// \trunZipTest();\n\t// }, []);\n\n\t// useEffect(() => {\n\t// \tconst processNpzFile = async () => {\n\t// \t\tlet n = new zipTest();\n\n\t// \t\tlet file =\n\t// \t\t\tawait require(`../assets/zip_test/final_test/slice_02_big_npz_compressed.zip`)\n\t// \t\t\t\t.default;\n\n\t// \t\tconst parsedFile = await n.load(file); // returns an unparsed uint8Array (so just the full raw contents)\n\n\t// \t\tconsole.log(parsedFile);\n\n\t// \t\tconst slicedFile = new Uint8Array(parsedFile!.slice(52));\n\n\t// \t\tlet contents = new TextDecoder(\"utf-8\").decode(\n\t// \t\t\tnew Uint8Array(parsedFile!.slice(54, 1000))\n\t// \t\t);\n\t// \t\tconsole.log(contents);\n\n\t// \t\ttry {\n\t// \t\t\t// zip the uncompressed npy file\n\t// \t\t\t// const compressedFile = pako.deflate(parsedFile);\n\t// \t\t\t// console.log(compressedFile);\n\n\t// \t\t\t// unzip the file\n\t// \t\t\tconst uncompressedFile = pako.inflateRaw(parsedFile);\n\t// \t\t\tconsole.log(uncompressedFile);\n\n\t// \t\t\t// inspect its raw contents\n\t// \t\t\tlet contents = new TextDecoder(\"utf-8\").decode(\n\t// \t\t\t\tnew Uint8Array(uncompressedFile.slice(0, 1000))\n\t// \t\t\t);\n\t// \t\t\tconsole.log(contents);\n\t// \t\t} catch (err) {\n\t// \t\t\tconsole.log(err);\n\t// \t\t}\n\t// \t};\n\n\t// \tprocessNpzFile();\n\t// }, []);\n\n\t// useEffect(() => {\n\t// \tconst runZipTest = async () => {\n\t// \t\t// this function takes an uncompressed .npy file, zips it, unzips it, and then inspects the contents\n\t// \t\t// this is a proof of concept to show that we can process zipped npy files\n\t// \t\t// as a last resort, all of the .npy files could be zipped by us in node.js\n\n\t// \t\tlet n = new parseNpy();\n\n\t// \t\t// load an uncompressed file\n\t// \t\tlet file = await require(`../assets/zip_test/final_test/slice_02_big.npy`)\n\t// \t\t\t.default;\n\n\t// \t\tconst parsedFile = await n.load(file); // returns an unparsed uint8Array (so just the full raw contents)\n\n\t// \t\tconsole.log(parsedFile);\n\n\t// \t\tlet ndArray = ndarray(parsedFile.data, parsedFile.shape);\n\t// \t\tconst label = ndArray.get(5000, 4000);\n\t// \t\tconsole.log(label);\n\n\t// \t\t// try {\n\t// \t\t// \t// zip the uncompressed npy file\n\t// \t\t// \tconst compressedFile = pako.deflate(parsedFile);\n\t// \t\t// \tconsole.log(compressedFile);\n\n\t// \t\t// \tlet contents2 = new TextDecoder(\"utf-8\").decode(\n\t// \t\t// \t\tnew Uint8Array(compressedFile.slice(0, 100))\n\t// \t\t// \t);\n\t// \t\t// \tconsole.log(contents2);\n\n\t// \t\t// \t// unzip the file\n\t// \t\t// \tconst uncompressedFile = pako.inflate(compressedFile);\n\t// \t\t// \tconsole.log(uncompressedFile);\n\n\t// \t\t// \t// inspect its raw contents\n\t// \t\t// \tlet contents = new TextDecoder(\"utf-8\").decode(\n\t// \t\t// \t\tnew Uint8Array(uncompressedFile.slice(0, 100))\n\t// \t\t// \t);\n\t// \t\t// \tconsole.log(contents);\n\t// \t\t// } catch (err) {\n\t// \t\t// \tconsole.log(err);\n\t// \t\t// }\n\t// \t};\n\n\t// \trunZipTest();\n\t// }, []);\n\n\tuseEffect(() => {\n\t\tconst processNpzFile = async () => {\n\t\t\tlet n = new npzAsArrayBuffer();\n\t\t\tlet zip: any = new JSZip();\n\n\t\t\tlet file =\n\t\t\t\tawait require(`../assets/zip_test/final_test/block_38_slice_04.npz`)\n\t\t\t\t\t.default;\n\n\t\t\tlet npzArrayBuffer: any = await n.load(file); // returns raw contents as an unparsed array buffer\n\t\t\t//console.log(npzArrayBuffer);\n\n\t\t\tlet npzUint8Array: any = new Uint8Array(npzArrayBuffer); // parse the arrayBuffer as a uint8Array\n\t\t\t//console.log(npzUint8Array);\n\n\t\t\tlet loadedZip: any = await zip.loadAsync(npzUint8Array!); // get all files in the zip\n\t\t\t//console.log(loadedZip);\n\n\t\t\t// parse the loaded zip as an arrayBuffer\n\t\t\tlet unzippedArrayBuffer: any = await loadedZip\n\t\t\t\t.file(\"arr_0.npy\")!\n\t\t\t\t.async(\"arraybuffer\");\n\t\t\t//console.log(unzippedArrayBuffer);\n\n\t\t\t// we need to parse both the uint8array data and the uint16 array data from the zip\n\t\t\t// we get the header info from the unit8 data\n\t\t\t// and we get the actual npy array data from the uint16 data\n\t\t\t// although it seems to work, this seems weird, so i'm probably just missing something\n\n\t\t\t// create the header data from the uint8Array data\n\t\t\tlet headerData: any = new Uint8Array(unzippedArrayBuffer);\n\t\t\tlet hcontents = new TextDecoder(\"utf-8\").decode(\n\t\t\t\tnew Uint8Array(headerData.slice(10, 10 + 118))\n\t\t\t);\n\t\t\tvar header = JSON.parse(\n\t\t\t\thcontents\n\t\t\t\t\t.toLowerCase() // True -> true\n\t\t\t\t\t.replace(/'/g, '\"')\n\t\t\t\t\t.replace(\"(\", \"[\")\n\t\t\t\t\t.replace(/,*\\),*/g, \"]\")\n\t\t\t);\n\t\t\tconsole.log(header);\n\n\t\t\t// get the npy array data from the uint16array\n\t\t\tlet npyData: any = new Uint16Array(unzippedArrayBuffer.slice(128));\n\n\t\t\t// process the array data accordingly\n\t\t\tlet ndArray = ndarray(npyData, header.shape);\n\t\t\tconsole.log(ndArray);\n\n\t\t\tconst label = ndArray.get(124, 300);\n\t\t\tconsole.log(label);\n\t\t};\n\n\t\tprocessNpzFile();\n\t}, []);\n\n\t// useEffect(() => {\n\t// \tconst processNpzFile = async () => {\n\t// \t\t// const fileUrlJson =\n\t// \t\t// \t\"https://raw.githubusercontent.com/jhughes982/brainAtlas-P57-16/main/WholeHemisphereFS.json\";\n\n\t// \t\t// const fileJson = await fetch(fileUrlJson);\n\n\t// \t\t// const parsedFile = await fileJson.json();\n\n\t// \t\t// console.log(parsedFile);\n\n\t// \t\t// const fileUrl =\n\t// \t\t// \t\"https://raw.githubusercontent.com/jhughes982/brainAtlas-P57-16/main/slice_000.npy\";\n\t// \t\tconst fileUrl =\n\t// \t\t\t\"https://raw.githubusercontent.com/jhughes982/brainAtlas-P57-16/main/P57-16/mri_rotated/indices_axial/slice_000.npy\";\n\n\t// \t\tconst file = await fetch(fileUrl);\n\n\t// \t\t//const parsedFile = await file.text();\n\n\t// \t\tlet n = new npyjs();\n\n\t// \t\tconst npyArray = await n.load(fileUrl);\n\n\t// \t\tconsole.log(npyArray);\n\t// \t};\n\n\t// \tprocessNpzFile();\n\t// }, []);\n\n\treturn (\n\t\t<div>\n\t\t\t<img\n\t\t\t\tsrc={\"https://github.com/labnol/files/blob/master/trex.jpg?raw=true\"}\n\t\t\t\talt=\"kk\"\n\t\t\t></img>\n\t\t</div>\n\t);\n};\n\nexport default Atlas;\n","import { Route, Switch, Redirect } from \"react-router-dom\";\n\nimport Layout from \"./components/layout/Layout\";\nimport NotFound from \"./pages/NotFound\";\nimport Home from \"./pages/Home\";\nimport Atlas from \"./pages/Atlas\";\nimport Test from \"./pages/Test\";\n\nfunction App() {\n\treturn (\n\t\t<Layout>\n\t\t\t<Switch>\n\t\t\t\t<Route path=\"/\" exact>\n\t\t\t\t\t<Redirect to=\"/atlas\" />\n\t\t\t\t</Route>\n\n\t\t\t\t<Route path=\"/home\" exact>\n\t\t\t\t\t<Home />\n\t\t\t\t</Route>\n\n\t\t\t\t<Route path=\"/atlas\" exact>\n\t\t\t\t\t<Atlas />\n\t\t\t\t</Route>\n\n\t\t\t\t<Route path=\"/test\" exact>\n\t\t\t\t\t<Test />\n\t\t\t\t</Route>\n\n\t\t\t\t<Route path=\"*\">\n\t\t\t\t\t<NotFound />\n\t\t\t\t</Route>\n\t\t\t</Switch>\n\t\t</Layout>\n\t);\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\n// we use HashRouter to make it compatible with GitHub pages\n// https://medium.com/@bennirus/deploying-a-create-react-app-with-routing-to-github-pages-f386b6ce84c2\nimport { HashRouter } from \"react-router-dom\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<HashRouter>\n\t\t\t<App />\n\t\t</HashRouter>\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}